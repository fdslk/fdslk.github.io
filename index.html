<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ğŸª³çš„Daily Blog WebSite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="ğŸª³çš„Daily Blog WebSite">
<meta property="og:url" content="http://fdslk.github.io/index.html">
<meta property="og:site_name" content="ğŸª³çš„Daily Blog WebSite">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zengqiang Fang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ğŸª³çš„Daily Blog WebSite" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ğŸª³çš„Daily Blog WebSite</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://fdslk.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-dotnet-core-related" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/dotnet-core/2023/03/05/dotnet-core-related/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:17:13.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/dotnet-core/">dotnet-core</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/dotnet-core/2023/03/05/dotnet-core-related/">dotnet_core_related</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="dotnet-core-practices"><a href="#dotnet-core-practices" class="headerlink" title="dotnet core practices"></a>dotnet core practices</h1><ul>
<li>è®¾è®¡æ¨¡å¼<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/AbstractTest">æŠ½è±¡æ¨¡å¼</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/SingletonPattern">å•ä¾‹æ¨¡å¼</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/DILifeTime">globalå¼‚å¸¸æ•è·</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/Docker-Compose-Nginx-NetCore-master">docker-composeå¯åŠ¨dotcore-webapplication+nginx</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/EventTest">event handler</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/FilterApiImplement">filter</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/FunctionalPractice">dotnet functional</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/JWTAuthentication">jwt token</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/ReflectionTest">refecltçš„åº”ç”¨</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/SOLIDTEST">SOLID</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/coverage">å¦‚ä½•ä½¿ç”¨coveragereportç”Ÿæˆæµ‹è¯•æŠ¥å‘Š</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/blob/master/customSerialization">å¦‚ä½•ä½¿ç”¨Newtonsoft.Jsonè‡ªå®šä¹‰resovler</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/databaseConnector">ä½¿ç”¨EntityFrameworkCoreè¿æ¥æ•°æ®åº“</a><ul>
<li>å¦‚ä½•ä½¿ç”¨filterç°å®responseçš„globalç®¡ç†</li>
<li>å¦‚ä½• DbContextè¿æ¥æ•°æ®åº“</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/loggingTest">å¦‚ä½•åœ¨pipelineä¸­æ·»åŠ logger</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/mysolution">dotnetcoreåŸºç¡€è¯­æ³•</a><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/mysolution/APP.TEST">List</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/mysolution/AttributePrc">Attribute</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/mysolution/EventHandle">event delegate</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/blob/master/unit-testing-using-dotnet-test/PrimeService.Tests/MockOperationTest.cs">mock test</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/unit-testing-using-dotnet-test/PrimeService">automaaper</a></li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/myCoreApp/tree/master/uploadDemo">upload file</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/dotnet-core/2023/03/05/dotnet-core-related/" data-id="clev2anaw0008j8hsbmupg5qs" data-title="dotnet_core_related" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-gatling-load-test" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/test/gatling/2023/03/05/gatling-load-test/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:13:00.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/test/">test</a>â–º<a class="article-category-link" href="/categories/tech/test/gatling/">gatling</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/test/gatling/2023/03/05/gatling-load-test/">gatling_load_test</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="GatlingRepo"><a href="#GatlingRepo" class="headerlink" title="GatlingRepo"></a>GatlingRepo</h1><pre><code>load test by Gatling in this repo, you will know how to use gatling to do load test
</code></pre>
<ul>
<li>preparation<ul>
<li><p>download gatling</p>
</li>
<li><p>unzip your gatling zip file</p>
</li>
<li><p>use the cmd<br><code>/Users/zengqiangfang/Downloads/software/gatling-charts-highcharts-bundle-3.7.5/bin</code></p>
</li>
<li><p>execute .&#x2F;recorder.sh (in mac) will open the following GUI<br><img src="https://user-images.githubusercontent.com/6279298/155526456-aa122499-b148-4f66-ab8b-56a6be3f898b.jpg" alt="gatling recorder GUI"></p>
</li>
<li><p>then go to a website <a target="_blank" rel="noopener" href="https://computer-database.gatling.io/">computer-database</a>.</p>
<ul>
<li><p>open the developer model of your browser</p>
</li>
<li><p>check the presave-log operation</p>
</li>
<li><p>doing the following operations</p>
<ul>
<li>reload home page</li>
<li>open creating page</li>
<li>create new computer entity</li>
<li>search new computer by its names</li>
</ul>
</li>
<li><p>save HAR file</p>
</li>
<li><p>using Gatling to generate scala file</p>
</li>
<li><p>execute .&#x2F;gatling.sh</p>
</li>
<li><p><img src="https://user-images.githubusercontent.com/6279298/155529006-2848927d-0b5f-49ca-8e4d-28921972e574.png" alt="see new scala file"></p>
</li>
<li><p>generate test report<br><img src="https://user-images.githubusercontent.com/6279298/155529293-a44863d0-eca7-432f-904f-d774159c4789.png" alt="test report"></p>
</li>
<li><p>so far, you might know how to use gatling to do a simple test.</p>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/GatlingRepo/blob/main/MyFirstGatlingSimulation">source code</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/test/gatling/2023/03/05/gatling-load-test/" data-id="clev2anb4000rj8hs31xmfht4" data-title="gatling_load_test" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-gatling-101" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/test/gatling/2023/03/05/gatling-101/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:11:56.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/test/">test</a>â–º<a class="article-category-link" href="/categories/tech/test/gatling/">gatling</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/test/gatling/2023/03/05/gatling-101/">gatling_101</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Gatling-3-Fundamentals"><a href="#Gatling-3-Fundamentals" class="headerlink" title="Gatling 3 Fundamentals"></a>Gatling 3 Fundamentals</h1><ul>
<li>åŸºæœ¬æ­¥éª¤<ul>
<li>åˆ›å»ºhttp clientï¼Œåˆå§‹åŒ–urlï¼Œè¯·æ±‚å¤´éƒ¨æ ¼å¼ç­‰ç­‰<ul>
<li>http.baseUrl</li>
</ul>
</li>
<li>åˆ›å»ºæµ‹è¯•åœºæ™¯<ul>
<li>scenario å®šä¹‰æµ‹è¯•åœºæ™¯</li>
<li>exec å£°æ˜æµ‹è¯•çš„endpoint<ul>
<li>http</li>
<li>get&#x2F;post&#x2F;put â€¦.</li>
<li>check æ£€æŸ¥responseç»“æœ<ul>
<li>eg: check(status.is(200)))</li>
</ul>
</li>
</ul>
</li>
<li>pause è®¾ç½®ç­‰å¾…æ—¶é—´</li>
</ul>
</li>
<li>æ‰§è¡Œæµ‹è¯•<ul>
<li>setUp<ul>
<li>inject æ³¨å…¥<ul>
<li>atOnceUsers æµ‹è¯•å¹¶å‘é‡</li>
</ul>
</li>
<li>è®¾ç½®http configuration<ul>
<li>protocols</li>
</ul>
</li>
<li>è®¾ç½®æµ‹è¯•çš„å¹¶å‘é‡</li>
</ul>
</li>
</ul>
</li>
<li>æ‰§è¡Œæµ‹è¯•é‡‡ç”¨cmdæ¨¡å¼<ul>
<li><code>mvn gatling:test -Dgatling.simulationClass=simulations.RunTimeParameters</code></li>
<li>å‚æ•°å‰é¢åŠ ä¸Š-Dè¡¨ç¤ºè¯»å–å‘½ä»¤è¡Œä¸­çš„å‚æ•°<ul>
<li>eg: <code>mvn gatling:test -Dgatling.simulationClass=simulations.RunTimeParameters -DUSERS=10 -DRAMP_DURATION=5 -DDURATION=30</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/GatlingRepo/blob/main/gatling3-fundamentals">source code</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/test/gatling/2023/03/05/gatling-101/" data-id="clev2anb1000jj8hs32dkatxl" data-title="gatling_101" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-shell-disk-operation" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/shell/2023/03/05/shell-disk-operation/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:08:38.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/shell/">shell</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/shell/2023/03/05/shell-disk-operation/">shell_disk_operation</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Disk-operation"><a href="#Disk-operation" class="headerlink" title="Disk operation"></a>Disk operation</h1><ul>
<li>df<ul>
<li><p>å±•ç¤ºç£ç›˜çš„ä½¿ç”¨æƒ…å†µ<br><img src="https://user-images.githubusercontent.com/6279298/162938999-86d33e54-228f-460b-a874-7068d0d030d6.png" alt="disk usage"></p>
</li>
<li><p>du</p>
<ul>
<li>å½“å‰ç›®å½•ä¸‹çš„æ¯ä¸ªæ–‡ä»¶çš„ä½¿ç”¨æƒ…å†µ</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/shell/2023/03/05/shell-disk-operation/" data-id="clev2anbd001oj8hsfwzt6u3e" data-title="shell_disk_operation" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-shell-file-operation" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/shell/2023/03/05/shell-file-operation/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:08:12.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/shell/">shell</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/shell/2023/03/05/shell-file-operation/">shell_file_operation</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="file-operation"><a href="#file-operation" class="headerlink" title="file operation"></a>file operation</h1><h2 id="definition"><a href="#definition" class="headerlink" title="definition"></a>definition</h2><ul>
<li>ä»€ä¹ˆæ˜¯Linuxçš„æ–‡ä»¶ç³»ç»Ÿï¼Ÿ</li>
<li>cat<ul>
<li>cat<ul>
<li>-n å¯¹è¾“å‡ºçš„å†…å®¹åŠ ä¸Šè¡Œå·</li>
<li>-b å¯¹è¾“å‡ºçš„å†…å®¹ï¼ˆé™¤ç©ºç™½è¡Œå¤–ï¼‰éƒ½åŠ ä¸Šè¡Œå·</li>
<li>&#x2F;dev&#x2F;null &gt; [file name] æ¸…ç©ºå½“å‰fileçš„å†…å®¹</li>
</ul>
</li>
</ul>
</li>
<li>chgrp æ”¹å˜æ–‡ä»¶æˆ–ç›®å½•çš„æ‰€å±ç¾¤ç»„<ul>
<li><p>-v&#x2F;-c æ”¹å˜å½“å‰æ–‡ä»¶çš„ç¾¤ç»„</p>
<ul>
<li><p>egï¼šå¦‚æœæƒ³å°†å½“å‰ç›®å½•ä¸‹çš„READMEæ–‡ä»¶ç§»åŠ¨åˆ°bin groupä¸­</p>
<ul>
<li>chgrp -c bin REMDME.md</li>
<li><img src="https://user-images.githubusercontent.com/6279298/162874839-056be677-25a3-4789-947b-0fc1a96f1865.png" alt="error notification"></li>
<li>æŸ¥çœ‹å½“å‰ç”¨æˆ·çš„æ‰€å±çš„ç”¨æˆ·ç»„ <code>group</code><br><img src="https://user-images.githubusercontent.com/6279298/162874947-1d422664-7729-45e5-8aa5-9e4603b63419.png" alt="å½“å‰ç”¨æˆ·æ‰€å±ç”¨æˆ·ç»„"></li>
<li>è¿è¡Œä¸€ä¸‹å‘½ä»¤å°†ç”¨æˆ·æ·»åŠ è‡³æŒ‡å®šç”¨æˆ·ç»„</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">sudo dseditgroup -o edit -a username -t user groupname</span><br></pre></td></tr></table></figure>

<ul>
<li>ä½¿ç”¨åœºæ™¯<ul>
<li>ç”¨æˆ·æƒé™éš”ç¦»</li>
<li><strong>å’‹å®ç°çš„~å¯ä»¥æ·±ç©¶ä¸€ä¸‹</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>-R å¾ªç¯é€’å½’å¤„ç†ï¼Œå°†å½“å‰ç›®å½•ä¸‹çš„å…¶ä»–çš„æ–‡ä»¶é‡‡ç”¨åŒæ ·çš„å¤„ç†</p>
</li>
</ul>
</li>
<li>chmod <strong>(change mode)</strong><ul>
<li>r - 4, w - 2, x - 1</li>
</ul>
</li>
</ul>
<table>
<thead>
<tr>
<th align="left">user</th>
<th align="center">group</th>
<th align="right">other user</th>
</tr>
</thead>
<tbody><tr>
<td align="left">u</td>
<td align="center">g</td>
<td align="right">o</td>
</tr>
</tbody></table>
<ul>
<li><p>chown <strong>(chanage owner)</strong></p>
<ul>
<li>tip: å¿…é¡»rootç”¨æˆ·æ‰èƒ½æ‰§è¡Œè¯¥å‘½ä»¤</li>
</ul>
</li>
<li><p>æ¯”è¾ƒä¸¤ä¸ªæ–‡ä»¶çš„ä¸åŒ</p>
</li>
<li><p>diff</p>
<ul>
<li>diff<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">diff README.md ../README.md -y -W 50</span><br></pre></td></tr></table></figure></li>
</ul>
<p><img src="https://user-images.githubusercontent.com/6279298/162893983-ea9da932-b846-4b49-bc1c-e3c22d0caf3c.png" alt="å¹¶æ’æ¯”è¾ƒ"></p>
<ul>
<li><p>tipsï¼š**|** è¡¨ç¤ºåŒè¡Œæœ‰ä¸åŒï¼Œ**&lt;** åæ–‡ä»¶æ¯”å‰æ–‡ä»¶å°‘ä¸€è¡Œï¼Œ**&gt;**åæ–‡ä»¶æ¯”å‰æ–‡ä»¶å¤šä¸€è¡Œ</p>
</li>
<li><p>diff file1 file2 | diffstat, ç»Ÿè®¡ä¸¤ä¸ªæ–‡ä»¶çš„å˜åŒ–å­—æ•°</p>
</li>
<li><p>cmp</p>
<ul>
<li>è¾“å‡ºä¸¤ä¸ªæ–‡ä»¶ç¬¬ä¸€å¤„ä¸ç›¸åŒçš„ä½ç½®</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/6279298/162893460-62b9b0be-b466-48b0-833a-c02bd7bca2c1.png" alt="diff"></p>
<ul>
<li><p>file: æ£€ç´¢æ–‡ä»¶ç±»å‹</p>
<ul>
<li>-b åªè¾“å‡ºæ–‡ä»¶ç±»å‹ï¼Œä¸è¾“å‡ºæ–‡ä»¶åç§°</li>
<li>-i è¾“å‡ºæ–‡ä»¶MIME</li>
</ul>
</li>
<li><p>find æŸ¥æ‰¾æ–‡ä»¶ï¼Œå¹¶æ‰§è¡Œbashå‘½ä»¤</p>
<ul>
<li><p>syntax:</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find   path   -option   [   -print ]   [ -exec   -ok   command ]   &#123;&#125; \;</span><br></pre></td></tr></table></figure>
</li>
<li><p>-mindepth 1 -maxdepth 1 æŒ‡å®šæ–‡ä»¶æŸ¥æ‰¾æ·±åº¦</p>
</li>
<li><p>åº”ç”¨</p>
<ul>
<li>åˆ©ç”¨findå‘½ä»¤æ‰§è¡Œå¤šrepositoryçš„git pull<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">find . -mindepth 1 -maxdepth 1 -type d -print -exec git -C &#123;&#125; pull \;</span><br></pre></td></tr></table></figure></li>
<li>å¯»æ‰¾å½“å‰ç›®å½•ä¸‹å­ç›®å½•ï¼ˆæœ€å°ï¼Œæœ€å¤§æ·±åº¦ä¸º1ï¼‰ï¼Œæ–‡ä»¶ç±»å‹ä¸ºdirectoryï¼Œ**{}** ä½œä¸ºfindå‘½ä»¤çš„è¾“å‡ºç›®å½•ï¼Œ**;** ä½œä¸º -execçš„ç»ˆç»“ç¬¦ï¼Œ**&#x2F;** ä½œä¸ºSemicolonçš„è½¬ä¹‰å­—ç¬¦</li>
</ul>
</li>
</ul>
</li>
<li><p>ln <strong>(link file)</strong> ä½¿æ–‡ä»¶å’Œä¸€å›ºå®šçš„æ–‡ä»¶ç›®å½•å»ºç«‹é“¾æ¥ï¼Œç„¶åå°±å¯ä»¥ç›´æ¥ä½¿ç”¨è¯¥æ–‡ä»¶ï¼Œé¿å…äº†æ–‡ä»¶çš„æ‹·è´ï¼Œå‡å°‘é‡å¤çš„ç£ç›˜å ç”¨</p>
<ul>
<li><code>ln -s filename link name</code></li>
</ul>
<p><img src="https://user-images.githubusercontent.com/6279298/162903067-a272cf38-8d12-4a4b-84de-bb17677eaa46.png" alt="soft link"></p>
<ul>
<li>æ€ä¹ˆå®ç°çš„??</li>
</ul>
</li>
<li><p>é˜…è¯»æ–‡ä»¶</p>
<ul>
<li>less</li>
<li>moreï¼ˆåˆ†é¡µè¯»å–æ•°æ®ï¼‰</li>
</ul>
</li>
<li><p>ç¼–è¾‘æ–‡ä»¶</p>
<ul>
<li>sed å¯¹æ–‡ä»¶å†…å®¹åšåŸºç¡€çš„æ›¿æ¢ (linuxä¸macOSä¸Šæœ‰åŒºåˆ«)<ul>
<li>linux:<ul>
<li>sed <strong>-i</strong> sâ€™new&#x2F;originalâ€™ (å°†æ–‡ä»¶å†…å®¹æ›¿æ¢å¹¶ä¿å­˜)</li>
<li>sed <strong>-i_bkp</strong> ~ (å°†æ–‡ä»¶å†…å®¹æ›¿æ¢å¹¶ä¿å­˜ï¼Œå¤‡ä»½)</li>
</ul>
</li>
<li>maxOS<ul>
<li>sed -i â€œâ€ ~</li>
<li>sed -i â€œbkpâ€ ~</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><p>æå–å­—ç¬¦</p>
<ul>
<li>cut è·å–æ–‡ä»¶ä¸­ï¼Œæ¯ä¸€è¡Œçš„æŸä¸ªä½ç½®çš„å€¼</li>
<li>linux<ul>
<li><code>cut -d&#39; &#39; -f1</code></li>
</ul>
</li>
<li>mac<ul>
<li><code>cut -f1 -d &#39; &#39;</code> or <code>cut -d&#39; &#39; -f1</code></li>
</ul>
</li>
</ul>
</li>
<li><p>ç»Ÿè®¡</p>
<ul>
<li>è¯æ•° <code>wc -w</code></li>
<li>è¡Œæ•° <code>wc -l</code></li>
<li><strong>tip</strong>: macä¸­ä½¿ç”¨wcå‘½ä»¤çš„è¾“å‡ºçš„å‰é¢ä¼šæœ‰å¾ˆå¤šçš„ç©ºæ ¼ï¼Œæ‰€ä»¥å¦‚æœä½¿ç”¨ç®¡é“çš„ä¼ é€’ç»“æœçš„è¯ï¼Œä½¿ç”¨å•ä¸ªç©ºæ ¼å¤„ç†çš„è¯è¦æ³¨æ„</li>
</ul>
</li>
<li><p>ç®¡é“ <strong>|</strong></p>
<ul>
<li>å°†ä¸Šä¸€æ­¥æ‰§è¡Œç»“æœçš„å†…å®¹ä½œä¸ºå‚æ•°ä¼ é€’ç»™ä¸‹ä¸€æ­¥æ‰§è¡Œ</li>
<li>eg: <code>wc -l file|cut -d&#39; &#39; -f1</code>,è¾“å‡ºfileçš„è¡Œæ•°ï¼Œç„¶åå†å¯¹è¾“å‡ºç»“æœåšcutå¤„ç†</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/shell/2023/03/05/shell-file-operation/" data-id="clev2anbd001pj8hs7grqdn5y" data-title="shell_file_operation" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ops-log-management" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/ops/log/2023/03/05/ops-log-management/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:04:56.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/ops/">ops</a>â–º<a class="article-category-link" href="/categories/tech/ops/log/">log</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/ops/log/2023/03/05/ops-log-management/">ops_log_management</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="How-to-collect-manage-and-visualize-our-log-data"><a href="#How-to-collect-manage-and-visualize-our-log-data" class="headerlink" title="How to collect, manage and visualize our log data?"></a><strong>How to collect, manage and visualize our log data?</strong></h1><p><em><strong>author: zengqiang fang</strong></em><br><code>log</code>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<code>ELK</code>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<code>EFK</code>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; <code>k8s</code></p>
<h2 id="Background"><a href="#Background" class="headerlink" title="Background"></a><strong>Background</strong></h2><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; During our daily working, application status, the content of http request and response, exception message, etc, which are very useful to us for debugging online issues and monitoring applications. Therefore, it is necessary to collect log data and visualize log records as a chart. In the past, we recorded log information into logs file. Then, we logged to the server to check log information or downloaded log file. According to this way, it is not only very hard to analyze log in real time, but also it is too difficult to search or filter log by key words. Nowadays, more and more services and systems are deployed in k8s clusters. Therefore, itâ€™s no hesitation to find a new way to collect and visualize data. In the article, we will introduce two k8s supported log frameworks, which are <strong>ELK</strong> and <strong>EFK</strong>. <strong>E</strong> has the same meaning for these two frameworks, ElasticSearch engine. <strong>L</strong> means the <strong>logstash</strong>, log agent. <strong>F</strong> is <strong>fluentd</strong>, k8s Nodes level log collecting application. And <strong>K</strong> also points to the same application, Kibana. It is used to visualize log. During the rest of this article, we will have a detailed description about what they are and how to use them.</p>
<h2 id="Logs-management-frameworks"><a href="#Logs-management-frameworks" class="headerlink" title="Logs management frameworks"></a><strong>Logs management frameworks</strong></h2><h3 id="ELK-ElasticSearch-logstash-kibana"><a href="#ELK-ElasticSearch-logstash-kibana" class="headerlink" title="ELK ElasticSearch logstash kibana"></a><strong>ELK ElasticSearch logstash kibana</strong></h3><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<strong>ELK</strong> is a framework which is provided by elastic stack organization. This framework can be divided into three parts. The heart, <strong>ElasticSearch</strong> collects data and is also a data searching engine, which can provide and save data. It can be deployed onto k8s cluster and execute scalation automatically. Then, <strong>logstash</strong> is used to format log and send collecting data to ElasticSearch, like a <strong>pipeline</strong>. In the end, <strong>kibana</strong> is used to visualize the data from ElasticSearch. Whatâ€™s more, a log collecting tool, <strong>beat (Filebeat)</strong> also needs to be set up for a collection application log and send the log to logstash. And the whole workflow can be presented as the Pic1.</p>
<p><img src="https://user-images.githubusercontent.com/6279298/167979333-e95a53ab-c13e-4ceb-bca2-21196a57d3dc.png" alt="Pic1"></p>
<h3 id="EFK-ElasticSearch-fluentd-kibana"><a href="#EFK-ElasticSearch-fluentd-kibana" class="headerlink" title="EFK ElasticSearch fluentd kibana"></a><strong>EFK ElasticSearch fluentd kibana</strong></h3><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<strong>EFK</strong> is another log framework and some features are similar to <strong>ELK</strong>. <strong>EFK</strong> includes a log agent, fluentd for collecting log data and sending log data to ElasticSearch. EFK is supported two endpoints which are <strong>Stackdriver Logging for use with Google Cloud Platform</strong> and <strong>ElasticSearch</strong>. Fluentd is a DeamonSet k8s resource which can be deployed into k8s Nodes as a Deamon Pod. This special pods will collect the log of the pods in the same Nodes. Therefore, <strong>EFK</strong> just needs to deploy ElasticSearch Pods, kibana interface Pods, fleuntd DeamonSet.</p>
<h2 id="How-to-use"><a href="#How-to-use" class="headerlink" title="How to use"></a><strong>How to use</strong></h2><h3 id="ELK"><a href="#ELK" class="headerlink" title="ELK"></a><strong>ELK</strong></h3><h4 id="Deploy-ElasticSearch-engine-in-k8s"><a href="#Deploy-ElasticSearch-engine-in-k8s" class="headerlink" title="Deploy ElasticSearch engine in k8s"></a><strong>Deploy ElasticSearch engine in k8s</strong></h4><ul>
<li>add <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/es-manual.yaml">es-manual.yaml file</a> which includes k8s deployment configuration and service configuration. Service file is used to expose es-manual pod. Then other services can access to ElasticSearch service freely. If you want to run es deployment in your local machine, you might specify the <strong>â€œdiscovery.typeâ€</strong> is equal to <strong>â€œsingle-nodeâ€</strong>. The default discovery.type for ElasticSearch is <strong>multi-node</strong>. If es was set as a multi-node cluster, it would discover other nodes. Therefore, some discovery configurations need to be set up. Otherwise, you will get the following errors.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ERROR: [1] bootstrap checks failed</span><br><span class="line">[1]: the default discovery settings are unsuitable for production use; at least one of [discovery.seed_hosts, discovery.seed_providers, cluster.initial_master_nodes] must be configured</span><br><span class="line">ERROR: ElasticSearch did not exit normally - check the logs at /usr/share/ElasticSearch/logs/docker-cluster.log</span><br></pre></td></tr></table></figure>

<ul>
<li><p>When everything of es is set up correctly, you can input <code>curl http://localhost:&lt;expose port&gt;</code> in your iTerms, the following result you will receive:</p>
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;es-manual-ccd547885-4czd4&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster_name&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker-cluster&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;cluster_uuid&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;WbVh_VIjS42ppWYuGwovog&quot;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;version&quot;</span> <span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;number&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;7.8.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_flavor&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;default&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_type&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;docker&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_hash&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;757314695644ea9a1dc2fecd26d1a43856725e65&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_date&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;2020-06-14T19:35:50.234439Z&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;build_snapshot&quot;</span> <span class="punctuation">:</span> <span class="literal"><span class="keyword">false</span></span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;lucene_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;8.5.1&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minimum_wire_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.8.0&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;minimum_index_compatibility_version&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;6.0.0-beta1&quot;</span></span><br><span class="line">    <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;tagline&quot;</span> <span class="punctuation">:</span> <span class="string">&quot;You Know, for Search&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Deploy-kibana-in-k8s"><a href="#Deploy-kibana-in-k8s" class="headerlink" title="Deploy kibana in k8s"></a><strong>Deploy kibana in k8s</strong></h4><ul>
<li>Add a <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/kibana-elk.yaml">kibana deployment manifest</a> including deployment image and service information. Meanwhile, the ElasticSearch exposed url should be added into the k8s container as an environment variable. Like, <strong>ElasticSearch_HOSTS</strong>. After successfully deploying, command <code>curl http://localhost:32184/status</code> can be used to check if kibana is ready or not. Whatâ€™s more, you also can utilize k8s service name as hostname with target port to communicate with es pods. When kibana runs up, the following pic can be shown after you access to <code>http://localhost:32184</code> on your browse:<br><img src="https://user-images.githubusercontent.com/6279298/168193484-750f822b-fad8-491c-8d64-3125c5190e2c.png" alt="pic2"></li>
</ul>
<h4 id="Deploy-logstash-in-k8s"><a href="#Deploy-logstash-in-k8s" class="headerlink" title="Deploy logstash in k8s"></a><strong>Deploy logstash in k8s</strong></h4><ul>
<li><p>add <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/logstash.yaml">logstash k8s manifest file</a> and <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/logstash.conf">configuration file</a>. Based on the first file, we can deploy logstash service in k8s cluster. In the second file, we will define the input and output of the data. logstash.config will be defined as a k8s configMap resource. Then deployment will volume the configMap into k8s pod, which can be used by logstash service.</p>
<ul>
<li>input the following command to create ConfigMap<br><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl create configmap logstash-config --from-file ./logstash.conf</span><br></pre></td></tr></table></figure></li>
<li>create deployment</li>
<li>after logstash starts up, we can input <code>kubectl logs &lt;pods name&gt; -f</code> for obtaining useful log data.</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">[2022-05-13T08:18:20,309][INFO ][logstash.outputs.ElasticSearch][main] Installing ElasticSearch template to _template/logstash</span><br><span class="line">[2022-05-13T08:18:21,040][INFO ][logstash.inputs.beats    ][main] Beats inputs: Starting input listener &#123;:address=&gt;&quot;0.0.0.0:5044&quot;&#125;</span><br><span class="line">[2022-05-13T08:18:21,057][INFO ][logstash.javapipeline    ][main] Pipeline started &#123;&quot;pipeline.id&quot;=&gt;&quot;main&quot;&#125;</span><br><span class="line">[2022-05-13T08:18:21,150][INFO ][logstash.agent           ] Pipelines running &#123;:count=&gt;1, :running_pipelines=&gt;[:main], :non_running_pipelines=&gt;[]&#125;</span><br><span class="line">[2022-05-13T08:18:21,194][INFO ][org.logstash.beats.Server][main][be216883a18a1108d5ceab3d012b51b20564d3e53d37fdaf62f0441690df42ff] Starting server on port: 5044</span><br><span class="line">[2022-05-13T08:18:21,439][INFO ][logstash.agent           ] Successfully started Logstash API endpoint &#123;:port=&gt;9600&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
<h4 id="Deploy-Filebeat-and-Log-generating-application"><a href="#Deploy-Filebeat-and-Log-generating-application" class="headerlink" title="Deploy Filebeat and Log generating application"></a><strong>Deploy Filebeat and Log generating application</strong></h4><ul>
<li><p>In the end, we will deploy the log collector sidercar, Filebeat. It will collect log data from a sharing log file and send the data to the logstash. At first, we need to define <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/filebeat.yml">filebeat manifest</a>, which will illustrate where the filebeat reads the log and where the log is sended. You can input the command to create configMaps for filebeat configuration <code>kubectl create configmap file-beat-config --from-file ./filebeat.yml</code>. Then this configuration will be volumed into pods. When you deploy the log generator application and filebeat application. Then logstash will receive log data from being listened port. To check if the log system works normally or not. You can open your browser and input <code>http://localhost:32184/</code>, kibana GUI will represent to you as follows <strong>pic3</strong>. In order to see the log information, a <strong>Index Pattern</strong> needs to be created first.</p>
<ul>
<li>how to create â€œIndex Patternâ€<ul>
<li>open kibana dashboard</li>
<li>click stack management</li>
<li>click index pattern</li>
<li>create new index pattern like <strong>filebeat</strong>*, index is defined in the logstash.conf file<br><img src="https://user-images.githubusercontent.com/6279298/168613317-c88bbf58-3af2-4706-8e12-383a321801a5.png" alt="pic3"></li>
</ul>
</li>
</ul>
</li>
<li><p>At here you have learned how to make a ELK log system on your application.</p>
</li>
</ul>
<h3 id="EFK"><a href="#EFK" class="headerlink" title="EFK"></a><strong>EFK</strong></h3><h4 id="Deploy-ElasticSearch"><a href="#Deploy-ElasticSearch" class="headerlink" title="Deploy ElasticSearch"></a><strong>Deploy ElasticSearch</strong></h4><ul>
<li>The same as the former ElasticSearch deployment manifest</li>
</ul>
<h4 id="Deploy-kibana"><a href="#Deploy-kibana" class="headerlink" title="Deploy kibana"></a><strong>Deploy kibana</strong></h4><ul>
<li>The same as the former Kibana deployment manifest</li>
</ul>
<h4 id="Deploy-fluentd"><a href="#Deploy-fluentd" class="headerlink" title="Deploy fluentd"></a><strong>Deploy fluentd</strong></h4><ul>
<li><p>At here, we will define a <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/fluentd-manual.yml">DeamonSet manifest to deploy fluentd</a> which deploy a Pods for collecting the Pods log and docker container log. If everything is set up correctly, you will see the following pic after input KQL <code>kubernetes.namespace_name : &quot;default&quot;</code>.<br><img src="https://user-images.githubusercontent.com/6279298/169063264-d1088d57-00b4-4be7-b168-7597dcf4706c.png" alt="pic4"></p>
</li>
<li><p>Here is some information about the resource DaemonSet from <a target="_blank" rel="noopener" href="https://kubernetes.io/docs/concepts/workloads/controllers/daemonset/">kubernetes official website</a></p>
<ul>
<li>A DaemonSet ensures that all (or some) Nodes run a copy of a Pod. As nodes are added to the cluster, Pods are added to them. As nodes are removed from the cluster, those Pods are garbage collected. Deleting a DaemonSet will clean up the Pods it created.</li>
</ul>
</li>
</ul>
<h4 id="Deploy-business-service-application"><a href="#Deploy-business-service-application" class="headerlink" title="Deploy business service application"></a><strong>Deploy business service application</strong></h4><ul>
<li>In our daily delivery, we always deploy our application in k8s. Take <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/blob/main/ELK/log-application.yaml">log-application.yaml</a> as an example, we use <strong>slf4j.Logger</strong> to print log on the application console. When a request hits the log-application, it will print its stdout on the console, which will be scanned by fluentd and it will send the log data to ElasticSearch. The following picture <strong>pic5</strong> will be represented.<br><img src="https://user-images.githubusercontent.com/6279298/169491169-7d6b4a79-9e18-4116-8be8-03ece9fe25a5.png" alt="pic6"></li>
</ul>
<h2 id="How-difference-between-them"><a href="#How-difference-between-them" class="headerlink" title="How difference between them"></a><strong>How difference between them</strong></h2><ul>
<li><strong>Components</strong><ul>
<li>For this part, it is very obvious that <strong>ELK</strong> is composed of ElasticSearch, Logstash, filebeats and Kibana. However, <strong>EFK</strong> just includes ElasticSearch, fluentd and Kibana.</li>
</ul>
</li>
<li><strong>Mechanism</strong><ul>
<li>In <strong>ELK</strong> framework, the core feature is the logstash used as a log sending agent. Logstash just likes a log transportation center which can re-process the format, filter and enrichment of logs. Itâ€™s very memory-consuming. We canâ€™t deploy a logstash into a container with other logging applications. Therefore, filebeat, a lightweight log collector, works as a log agent to send log to logstash.</li>
<li>In <strong>EFK</strong> framework, fluentd is the core feature. fluentd is deployed on k8s cluster as a DeamonSet resource, which can collect the node metrics and log. And it doesnâ€™t need another log transportation agents. Only if fluentd is set with enough permission, the container and nodes log can be collected directly.</li>
</ul>
</li>
<li><strong>log agent performance</strong><ul>
<li>logstash is written by JRuby and runs on JVM.</li>
<li>fluentd is written by CRuby, which consumes less memory than logstash.</li>
</ul>
</li>
<li><strong>Configuration</strong><ul>
<li>logstash<ul>
<li>You can add your own manifest to set up input and output rules, log format, etc.</li>
</ul>
</li>
<li>fluentd<ul>
<li><a target="_blank" rel="noopener" href="https://docs.fluentd.org/deployment/fluentd-ui">fluentd UI browser</a> (Install, uninstall, and upgrade Fluentd plugins)</li>
<li><a target="_blank" rel="noopener" href="https://github.com/fluent/fluentd-kubernetes-daemonset/blob/master/docker-image/v1.14/debian-ElasticSearch7/Dockerfile">Dockerfile</a></li>
</ul>
</li>
</ul>
</li>
<li><strong>Usage scenarios</strong><ul>
<li>For <strong>ELK</strong>, it needs more memory. Therefore, logstash might not be suitable for the low-memory machine. On the other hand, <strong>EFK</strong> just consumes less memory. In my opinion, EFK might have a wide range of applications.</li>
</ul>
</li>
<li>More information<ul>
<li>If you want to get more comparison information, you can take the following references a look.</li>
<li><a target="_blank" rel="noopener" href="https://www.educba.com/fluentd-vs-logstash/?source=leftnav">Difference Between Fluentd vs Logstash</a></li>
<li><a target="_blank" rel="noopener" href="https://platform9.com/blog/kubernetes-logging-comparing-fluentd-vs-logstash/">Kubernetes Logging: Comparing Fluentd vs. Logstash</a></li>
<li><a target="_blank" rel="noopener" href="https://www.loomsystems.com/blog/single-post/2017/01/30/a-comparison-of-fluentd-vs-logstash-log-collector">Fluentd vs. LogStash: A Feature Comparison</a></li>
</ul>
</li>
</ul>
<h2 id="Conclusions"><a href="#Conclusions" class="headerlink" title="Conclusions"></a><strong>Conclusions</strong></h2><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;According to this article, two popular log frameworks, <strong>ELK</strong>&amp;<strong>EFK</strong> are introduced to you. Nowadays, application system is significant to our daily development, production troubleshooting, and product issue back-track for finding root result. Whatâ€™s more, with the log platform generating, several <strong>advantages</strong> comes up to my mind:</p>
<ul>
<li><strong>log-centralized</strong>, with the above two log frameworks, the log of application, docker container and nodes cluster are gathered into one place. As log centralizes, our debugging becomes more and more easy.</li>
<li><strong>real-time</strong>, log agent, logstash and fluentd will almost send system logs to ES in real-time. Because of their real-time file content and port listening, we can obtain real-time log feedback for online issues troubleshooting.</li>
<li><strong>visualization&amp;analysis</strong>, providing KQL for querying data and drawing charts. Providing lots of categories of charts can help us do some analysis.</li>
<li><strong>open-resource and active communities for supporting unknown issues</strong></li>
</ul>
<p><strong>In the end</strong>, all the manifests are provided in my <a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/tree/main/ELK">github</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/ops/log/2023/03/05/ops-log-management/" data-id="clev2anba001ej8hs5ywshvlx" data-title="ops_log_management" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ops-vanish" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/ops/cache/2023/03/05/ops-vanish/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:04:12.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/ops/">ops</a>â–º<a class="article-category-link" href="/categories/tech/ops/cache/">cache</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/ops/cache/2023/03/05/ops-vanish/">ops_vanish</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Varnish-using-for-new-fresh"><a href="#Varnish-using-for-new-fresh" class="headerlink" title="Varnish using for new fresh"></a>Varnish using for new fresh</h1><ul>
<li><p><strong>What</strong> is varnish</p>
<ul>
<li>Varnish is a http  cache tool for accelerating http request response.</li>
<li>The configuration language of varnish is named as <strong>VCL</strong>, which can handle the incoming requests<ul>
<li>decide what content you want to server</li>
<li>from where you want to get the content</li>
<li>how the request or response should be altered</li>
<li>beef-sandwich<br><img src="https://user-images.githubusercontent.com/6279298/165006846-8501c3a2-e6ea-43c6-81c1-88416128468c.png" alt="varnish in network"></li>
<li>How does it work<ul>
<li>based on VCL program, it can â€˜Which backend has this content, how long time can we cache it, is it accessible for this request, should it be redirected elsewhere and so onâ€™.</li>
<li><strong>VCL</strong> can be compiled into C-program which is complied into a shared lib. <strong>This will happen to varnish loads VCL program.</strong></li>
</ul>
</li>
</ul>
</li>
<li>core features<ul>
<li>caching, using Cache-Control HTTP header</li>
<li>Content Composition</li>
<li>support many different OS platforms</li>
<li>full control of every request</li>
</ul>
</li>
</ul>
</li>
<li><p><strong>How</strong> to install varnish</p>
<ul>
<li><code>brew install varnish</code></li>
<li><code>sudo mv  /usr/local/opt/varnish/sbin/varnishd /usr/local/bin/</code></li>
<li>then varnishd can be executed directly</li>
</ul>
</li>
<li><p><strong>How</strong> to use varnish</p>
<ul>
<li><p>in local</p>
<ul>
<li>add default.vcl file</li>
<li>run the following cmd <code>varnishd -a :6081,HTTP -f default.vcl -F</code><ul>
<li>-a listening port</li>
<li>-f configuration file location</li>
<li>-F run varnish in the front</li>
</ul>
</li>
<li>call the <code>127.0.0.1/api/public</code> for testing</li>
</ul>
</li>
<li><p>by docker</p>
<ul>
<li><p>use docker cmd directly</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">docker run --rm -v $(PWD)/default-docker.vcl:/etc/varnish/default.vcl:ro \  </span><br><span class="line">    --tmpfs /var/lib/varnish/varnishd:exec \</span><br><span class="line">    --name my-varnish-container \</span><br><span class="line">    -p 8081:80 \</span><br><span class="line">    -e VARNISH_SIZE=2G \</span><br><span class="line">    varnish</span><br></pre></td></tr></table></figure>

<ul>
<li>varnish proxy the local machine service, the host of vcl should be set as <strong>â€œdocker.mac.for.localhostâ€</strong>.</li>
<li>tips:<ul>
<li>varnish port in docker is <strong>80</strong></li>
</ul>
</li>
</ul>
</li>
<li><p>use docker file</p>
<ul>
<li><p>create a docker file</p>
</li>
<li><p>mount the vcl file into your custom image</p>
</li>
<li><p>run your custom image</p>
<figure class="highlight cmd"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">docker run -it --tmpfs /var/lib/varnish/varnishd:exec -p <span class="number">8081</span>:<span class="number">80</span> local-varnish</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><p>docker-compose</p>
</li>
</ul>
</li>
<li><p>in local k8s</p>
<ul>
<li>create k8s configMap for mounting default.vcl</li>
</ul>
<p><code>kubectl create configmap varnish-vcl --from-file=default.vcl</code></p>
<ul>
<li>deploy</li>
</ul>
<p><code>kubectl apply -f deployment/deployment.yaml</code></p>
<ul>
<li>call api</li>
</ul>
<p><code>http://localhost:6081/api/public</code></p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;message&quot;</span><span class="punctuation">:</span> <span class="string">&quot;All good. You DO NOT need to be authenticated to call /api/public.&quot;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>

<ul>
<li><p>validate</p>
<ul>
<li><p>step1</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">kubectl exec -it varnish-proxy-5b4844596c-22hsl -c varnish-for-be -- sh</span><br></pre></td></tr></table></figure>
</li>
<li><p>step2<br><code>run varnishlog</code><br><img src="https://user-images.githubusercontent.com/6279298/165884032-802f7273-aa55-4aee-8109-eff0742a445d.png" alt="request detail"></p>
</li>
</ul>
</li>
<li><p>issue:</p>
<ul>
<li>if not define the <strong>Type</strong> in service yaml, it will use the default value <strong>ClusterIP</strong></li>
<li>Solution: add <strong>type: NodePort</strong> under spec section</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/tree/main/varnish">varnish</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/ops/cache/2023/03/05/ops-vanish/" data-id="clev2anbc001lj8hs661u12am" data-title="ops_vanish" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ops-k8s-secret" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/ops/k8s/secret/2023/03/05/ops-k8s-secret/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:03:29.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/ops/">ops</a>â–º<a class="article-category-link" href="/categories/tech/ops/k8s/">k8s</a>â–º<a class="article-category-link" href="/categories/tech/ops/k8s/secret/">secret</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/ops/k8s/secret/2023/03/05/ops-k8s-secret/">ops_k8s_secret</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="how-to-use-secret-in-k8s"><a href="#how-to-use-secret-in-k8s" class="headerlink" title="how to use secret in k8s"></a>how to use secret in k8s</h1><ul>
<li>encryption method</li>
</ul>
<table>
<thead>
<tr>
<th align="left">name</th>
<th align="center">Description</th>
<th align="right">Strength</th>
<th align="right">Key Length</th>
</tr>
</thead>
<tbody><tr>
<td align="left">identity default</td>
<td align="center">None</td>
<td align="right">test</td>
<td align="right">test</td>
</tr>
<tr>
<td align="left">secretbox</td>
<td align="center">XSalsa20 and Poly1305</td>
<td align="right">Strong</td>
<td align="right">32 byte</td>
</tr>
<tr>
<td align="left">aesgcm</td>
<td align="center">AES-GCM with </br> random nonce</td>
<td align="right">Must be rotated </br> every 200k writes</td>
<td align="right">16, 24, </br> 32-byte</td>
</tr>
<tr>
<td align="left">aescbc</td>
<td align="center">AES-CBC with </br> PKCS#7 padding</td>
<td align="right">Weak</td>
<td align="right">32-byte</td>
</tr>
<tr>
<td align="left">kms</td>
<td align="center">very complex</td>
<td align="right">Strongest</td>
<td align="right">32 byte</td>
</tr>
</tbody></table>
<ul>
<li>define access resource<ul>
<li>PodSecurityPolicy</li>
<li>RBAC</li>
<li>Authentication</li>
</ul>
</li>
</ul>
<h2 id="how-to-create-secret-resource"><a href="#how-to-create-secret-resource" class="headerlink" title="how to create secret resource"></a>how to create secret resource</h2><ul>
<li>create secret from kubectl command<ul>
<li>from file<ul>
<li>cmds  <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic db-user-pass \</span><br><span class="line">  --from-file=./username.txt \</span><br><span class="line">  --from-file=./password.txt</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>from command line<ul>
<li> <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">kubectl create secret generic db-user-pass \</span><br><span class="line">--from-literal=username=devuser \</span><br><span class="line">--from-literal=password=&#x27;S!B\*d$zDsb=&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li>check secret<ul>
<li><code>kubectl get secret db-user-pass -o jsonpath=&#39;&#123;.data&#125;&#39;</code></li>
</ul>
</li>
<li>encode secretbox<ul>
<li><code>kubectl delete secret &lt;secret name&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li>create secret from configurationgst<ul>
<li>create secret yaml file</li>
<li>run <code>kubectl apply -f &lt;your secert yaml&gt;</code></li>
</ul>
</li>
</ul>
<h2 id="how-to-use"><a href="#how-to-use" class="headerlink" title="how to use"></a>how to use</h2><ul>
<li>There are three main ways for a Pod to use a Secret:<ul>
<li>As files in a volume mounted on one or more of its containers.<ul>
<li>add a pod yaml to access to secret</li>
<li>tips:<ul>
<li>add spec.volumeMount section to save the secrect</li>
<li>add spec.volume to mount secret from pod and the should be <strong>same</strong> as the secretName</li>
<li>use cmd <code>kubectl exec &lt;pod name&gt; -it bash</code>, get into the pods and cd to <strong>&#x2F;etc&#x2F;podsecret</strong><br><img src="https://user-images.githubusercontent.com/6279298/163657055-a34866d1-dcbf-4906-9e1a-0475821185d0.png" alt="mounted secret"></li>
</ul>
</li>
</ul>
</li>
<li>As container environment variable.<ul>
<li>add env section<br><img src="https://user-images.githubusercontent.com/6279298/163657778-d357e775-7bfc-4c12-a9f2-8f5e7d7d5b28.png" alt="get env"></li>
</ul>
</li>
<li>By the kubelet when pulling images for the Pod.</li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/tree/main/k8secret">secret</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/ops/k8s/secret/2023/03/05/ops-k8s-secret/" data-id="clev2anbb001hj8hs15upb94g" data-title="ops_k8s_secret" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ops-helm" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/ops/package/2023/03/05/ops-helm/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T07:01:29.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/ops/">ops</a>â–º<a class="article-category-link" href="/categories/tech/ops/package/">package</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/ops/package/2023/03/05/ops-helm/">ops_helm</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="helmä¸€ç§CI-x2F-CDå·¥å…·"><a href="#helmä¸€ç§CI-x2F-CDå·¥å…·" class="headerlink" title="helmä¸€ç§CI&#x2F;CDå·¥å…·"></a>helmä¸€ç§CI&#x2F;CDå·¥å…·</h1><ul>
<li><p>definition: helmå¯ä»¥è¢«å½“åšæ˜¯k8sçš„åŒ…ç®¡ç†å·¥å…·ï¼Œåˆ©ç”¨helmå¯ä»¥éƒ¨ç½²è‡ªå·±çš„åº”ç”¨ç¨‹åºä»¥åŠå…¶ä»–ä¾èµ–æœåŠ¡åº”ç”¨ï¼Œå¦‚redisï¼Œmysqlç­‰ç­‰ã€‚</p>
</li>
<li><p>å¦‚ä½•åœ¨æœ¬åœ°çš„k8sé›†ç¾¤ä¸­ä½¿ç”¨helméƒ¨ç½²æœåŠ¡</p>
<ul>
<li><p>preparation</p>
<ul>
<li><p>docker-desktop or minikube</p>
</li>
<li><p>brew install helm</p>
</li>
<li><p>using helm version to check it works</p>
</li>
</ul>
</li>
<li><p>helm create <code>&lt;your chart name&gt;</code></p>
</li>
<li><p>create a folder name webdemo</p>
<ul>
<li><p>folder structure</p>
<ul>
<li><p>template&#x2F; å­˜å‚¨ä¸€äº›åŸºæœ¬çš„k8séƒ¨ç½²æ–‡ä»¶</p>
</li>
<li><p>Chart chartåŒ…çš„åŸºæœ¬ä¿¡æ¯</p>
</li>
<li><p>values.yaml æ¨¡æ¿ä¿¡æ¯ä¸­çš„æ›¿æ¢ä¿¡æ¯</p>
</li>
</ul>
</li>
</ul>
</li>
<li><p>helm packge <code>&lt;you are chart&gt;</code> åˆ›å»ºéƒ¨ç½²tgzåŒ…</p>
</li>
<li><p>helm install <code>&lt;your server name&gt;</code> <code>&lt;your chart tgz package name&gt;</code></p>
</li>
<li><p>helm list åˆ—å‡ºéƒ¨ç½²æˆåŠŸæœåŠ¡</p>
</li>
</ul>
<p><img src="https://user-images.githubusercontent.com/6279298/156680275-7d2c8297-a7bc-4b3c-8b46-591bb20cac90.png" alt="æˆåŠŸæˆªå›¾"></p>
<ul>
<li><p>helm delete åˆ é™¤éƒ¨ç½²ä»¥åŠk8sä¸­çš„éƒ¨ç½²</p>
</li>
<li><p>helm get manifest åˆ—å‡ºéƒ¨ç½²chartçš„k8s manifestæ–‡ä»¶</p>
</li>
</ul>
<p> <img src="https://user-images.githubusercontent.com/6279298/156680958-0fa1870a-21fe-4c75-9741-fd00e12c0082.png" alt="æˆåŠŸæˆªå›¾"></p>
</li>
<li><p>å¦‚ä½•æ·»åŠ è‡ªå·±çš„application</p>
</li>
<li><p>å¦‚ä½•å°†helmæ·»åŠ åˆ°Jenkins</p>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/tree/main/helmDemo">helm</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/ops/package/2023/03/05/ops-helm/" data-id="clev2anb9001aj8hshoml7zsf" data-title="ops_helm" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-ops-skaffold" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/tech/ops/CD/2023/03/05/ops-skaffold/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T06:57:57.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  <div class="article-category">
    <a class="article-category-link" href="/categories/tech/">tech</a>â–º<a class="article-category-link" href="/categories/tech/ops/">ops</a>â–º<a class="article-category-link" href="/categories/tech/ops/CD/">CD</a>
  </div>

  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/tech/ops/CD/2023/03/05/ops-skaffold/">ops_skaffold</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="minimal-CI-x2F-CD-å·¥å…·-skaffold"><a href="#minimal-CI-x2F-CD-å·¥å…·-skaffold" class="headerlink" title="minimal CI&#x2F;CD å·¥å…· skaffold"></a>minimal CI&#x2F;CD å·¥å…· skaffold</h2><p>&amp;nbsp;</p>
<ul>
<li><p>é˜…è¯»æ—¶é•¿ï¼š30min</p>
</li>
<li><p><font color="yellow" size="5"><strong>èƒŒæ™¯</strong></font><br><br /> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp; é¡¹ç›®ä¸Šä½¿ç”¨äº†å¾ˆå¤šçš„opså·¥å…·ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªopsçš„å·¥å…·åˆåªä½¿ç”¨äº†ä¸€éƒ¨åˆ†çš„åŠŸèƒ½ã€‚å…¶ä¸­Jenkinsç”¨æ¥æ„å»ºæˆ‘ä»¬çš„pipelineä¸»ä½“æ¡†æ¶ï¼Œæ‰“åŒ…é•œåƒæ˜¯é‡‡ç”¨çš„<strong>skaffold</strong>ä¸­<strong>jib</strong>æ¨¡å¼ï¼Œé•œåƒçš„æ¨é€é‡‡ç”¨çš„æ˜¯jenkinsXï¼Œéƒ¨ç½²åˆæ˜¯ä½¿ç”¨çš„<strong>helm+argocd</strong>ã€‚å·¥å…·å¤ªå¤šï¼Œçœ‹å¾—äººå¤©èŠ±ä¹±é†‰çš„ã€‚è®©äººè§‰å¾—è¿™ä¸ªé¡¹ç›®å¾ˆé«˜å¤§ä¸Šå“ˆå“ˆå“ˆã€‚ç„¶åæˆ‘ä»¬ä¸æƒ³è®©è¿™ä¸ªé¡¹ç›®åœ¨æˆ‘ä»¬çœ‹èµ·æ¥å¾ˆé«˜å¤§ä¸Šï¼Œæ‰€ä»¥æˆ‘ä»¬å‡†å¤‡ä¸€ä¸ªä¸€ä¸ªçš„æŠŠè¿™äº›opså·¥å…·æ¥å˜lowï¼ˆç†Ÿæ‚‰ï¼‰ã€‚åœ¨è¿™ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘ä¼šç»™å¤§å®¶è®²è®²å¦‚ä½•ä½¿ç”¨<font color="blue" size="5">skaffold</font>ï¼Œ å› ä¸ºskaffoldçš„ä½œç”¨è¿œä¸æ­¢åªæœ‰æ‰“åŒ…é•œåƒã€‚é™¤äº†é¡¹ç›®ä¸­ç”¨åˆ°çš„è¿™ä¸€ä¸ªåŠŸèƒ½ï¼Œskaffoldè¿˜èƒ½å½“åšä¸€ä¸ªå°å‹çš„pipelineã€‚å›Šæ‹¬äº†é•œåƒæ„å»ºï¼Œæµ‹è¯•ä»¥åŠéƒ¨ç½²ã€‚</p>
</li>
<li><p><font color="Green" size="5"><strong>Skaffoldæ˜¯ä»€ä¹ˆ?</strong></font><br>  Skaffoldæ˜¯ä¸€ä¸ªå¯ä»¥è®©kubernetesæœ¬åœ°åº”ç”¨ç¨‹åºçš„æŒç»­å¼€å‘æ›´å®¹æ˜“çš„å‘½ä»¤è¡Œå·¥å…·ï¼Œæ¢å¥è¯æ¥è¯´Skaffoldèƒ½å¤Ÿç”¨å¾ˆä¾¿æ·çš„æ–¹å¼åœ¨æœ¬åœ°k8sé›†ç¾¤ä¸­å¾ˆå¿«éƒ¨ç½²çš„ä¸€ç±»å·¥å…·ã€‚<br>* åˆ©ç”¨dockerfileï¼Œjibï¼ˆMaven&amp;Gradleï¼‰ç­‰å·¥å…·æ‰“åŒ…é•œåƒä»¥åŠæ¨é€é•œåƒ<br>* ä¸kubectlæˆ–è€…helm charté›†æˆï¼Œåœ¨æœ¬åœ°k8sé›†ç¾¤ä¸­éƒ¨ç½²dockeré•œåƒ<br>* åˆ©ç”¨container-structure-testæˆ–è€…test commandæµ‹è¯•é•œåƒæˆ–è€…ä»£ç <br>* çƒ­æ›´æ–°æœåŠ¡<br>* ç«¯å£æš´éœ²</p>
<ul>
<li>Skaffoldçš„ä¸»è¦workflowåŒ…æ‹¬ä»£ç å˜åŠ¨çš„æ£€æŸ¥ï¼Œä»£ç é•œåƒçš„æ„å»ºï¼Œé•œåƒçš„æµ‹è¯•ï¼Œé•œåƒçš„æ¨é€ä»¥åŠé•œåƒçš„éƒ¨ç½²ã€‚æ˜¯ä¸€ä¸ªå¯ä»¥å®ç°ä¸€ä¸ªæœ€å°å•å…ƒçš„minimal pipelineï¼Œå¦‚æ‘˜è‡ªå®˜ç½‘çš„ã€å›¾ä¸€ã€‘æ‰€ç¤ºã€‚</li>
<li>Skaffoldæ˜¯ä¸€ä¸ªåŸºäº<strong>golang</strong>å¼€å‘çš„<strong>cobra.Command</strong> libraryçš„CLIåº”ç”¨å·¥å…·ã€‚ä½¿ç”¨brew install skaffoldå®‰è£…å¥½ä¹‹åï¼Œskaffoldçš„å¯æ‰§è¡Œæ–‡ä»¶è¢«ç§»åŠ¨åˆ°äº†ç³»ç»Ÿçš„ <strong>&#x2F;usr&#x2F;local&#x2F;bin</strong>ç›®å½•ä¸‹ã€‚<br>  <img src="https://user-images.githubusercontent.com/6279298/160609255-b9b1fe0c-853e-467e-9c17-acd31743e29f.png" alt="ã€å›¾ä¸€ã€‘"><p style="text-align:center" > ã€å›¾ä¸€ã€‘ </p></li>
</ul>
</li>
<li><p><font color="pink" size="5"><strong>æ€ä¹ˆç”¨ï¼Ÿ</strong></font><br>  </br> &amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ä¸Šé¢è¯´äº†è¿™ä¹ˆå¤šçš„skaffoldçš„ä»‹ç»ï¼Œé‚£ä¹ˆè¿™ä¸ªå·¥å…·å…·ä½“æ€ä¹ˆç”¨ï¼Ÿæœ¬æ–‡å°†ä»¥<strong>java webflux application</strong>æ¥ä½œä¸ºæˆ‘ä»¬çš„demoã€‚</p>
<ul>
<li>Prerequisite<ul>
<li>ç»Ÿä¸€ç”¨<font color="rgb(249,208,148)" size="10">Homebrew</font>çš„å·¥å…·<ul>
<li>Java 1.8 <code>brew install java</code></li>
<li>Maven <code>brew install maven</code></li>
<li>Skaffold <code>brew install skaffold</code></li>
<li>Minikube <code>brew install minikube</code></li>
<li>Docker <code>brew install docker</code></li>
</ul>
</li>
<li>kubectl<ul>
<li><code>curl -LO https://storage.googleapis.com/kubernetes-release/release/v1.7.0/bin/darwin/amd64/kubectl</code></li>
<li><code>chmod +x ./kubectl</code></li>
<li><code>sudo mv ./kubectl /usr/local/bin/kubectl</code></li>
</ul>
</li>
<li>Jib (åœ¨pomæ–‡ä»¶ä¸­æ’å…¥ä¸€ä¸ªplugin section)</li>
</ul>
</li>
<li>workflow<ul>
<li><p>Skaffoldåˆå§‹åŒ–</p>
<ul>
<li>åœ¨å½“å‰é¡¹ç›®çš„ç›®å½•ä¸‹æ‰§è¡Œ<font style="font-family:courier;" size="4"><em><strong>Skaffold init</strong></em></font>ï¼Œskaffoldä¼šæ ¹æ®é¡¹ç›®æ„å»ºå·¥å…·æ¥è¿›è¡Œæ‰“åŒ…ã€‚å› ä¸ºåœ¨pomæ–‡ä»¶ä¸­æŒ‡å®šäº†jibæ‰“åŒ…ï¼Œå¦‚ã€å›¾äºŒã€‘æ‰€ç¤ºã€‚å½“skaffoldæ£€æµ‹åˆ°é¡¹ç›®ä¸­ä½¿ç”¨çš„jib æ’ä»¶æ‰“åŒ…é¡¹ç›®é•œåƒæ—¶ï¼Œå°†ä¼šå‡ºç°å¦‚ã€å›¾ä¸‰ã€‘æ‰€ç¤ºçš„æç¤ºã€‚<br>  <img src="https://user-images.githubusercontent.com/6279298/160611958-6d8a5056-5cea-4f8b-91a7-735b2f103068.png" alt="ã€å›¾äºŒã€‘">  <p style="text-align:center" > ã€å›¾äºŒã€‘ </p></li>
</ul>
<p>  <img src="https://user-images.githubusercontent.com/6279298/160623736-9666d566-ddc0-49f1-8c39-5c9f8b4c6905.png" alt="ã€å›¾ä¸‰ã€‘"><br>  <p style="text-align:center" > ã€å›¾ä¸‰ã€‘ </p></p>
<ul>
<li>Tipsï¼š    <ul>
<li><p>å¦‚æœä½¿ç”¨skaffoldçš„initå‘½ä»¤æ¥åˆå§‹åŒ–manifestï¼Œé»˜è®¤ä¼šåˆå§‹åŒ–ä½¿ç”¨kubectlçš„æ–¹å¼æ¥éƒ¨ç½²é•œåƒã€‚æ‰€ä»¥ä¼šå‡ºç°å¦‚ã€å›¾å››ã€‘æ‰€ç¤ºçš„é”™è¯¯ã€‚å¤„ç†æ–¹å¼å¾ˆç®€å•ï¼Œåœ¨å½“å‰ç›®å½•ä¸‹æ·»åŠ ä¸Šk8s manifestï¼ˆæœ€ç®€å•å°±æ˜¯ä¸€ä¸ªpods.yamlæ–‡ä»¶ï¼Œå¦‚æœéœ€è¦é…ç½®æ›´å¤šï¼ŒåŠ ä¸Šå¯¹åº”çš„deploymentï¼Œ</p>
</li>
<li><p>å¦‚æœå¯¹äºk8s manifestæ²¡æœ‰ä»€ä¹ˆç‰¹æ®Šçš„è¦æ±‚ï¼ˆåªéœ€è¦è®©å½“å‰é¡¹ç›®èƒ½å¤Ÿåœ¨æœ¬åœ°çš„k8s clusterä¸­runèµ·æ¥ï¼‰</p>
<ul>
<li>ç”Ÿæˆk8s manifest    <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">            kubectl create deployment my-app --image=my-image --dry-run -o yaml &gt; deployment.yaml</span><br><span class="line">            ```   </span><br><span class="line">            * åœ¨run skaffold initç”Ÿæˆå¯¹åº”çš„skaffold</span><br><span class="line">            serviceï¼‰å³å¯ã€‚</span><br><span class="line"></span><br><span class="line">![ã€å›¾å››ã€‘](https://user-images.githubusercontent.com/6279298/160624657-094f90bd-6179-455a-948f-77dac043a3ce.png)</span><br><span class="line">    &lt;p style=&quot;text-align:center&quot; &gt; ã€å›¾å››ã€‘ &lt;/p&gt;</span><br><span class="line"></span><br><span class="line">* æ„å»ºé•œåƒ</span><br><span class="line">    * è¿è¡Œå‘½ä»¤&lt;font style=&quot;font-family:courier;&quot; size=&quot;4&quot;&gt;***skaffold build***&lt;/font&gt;</span><br><span class="line">    * skaffoldæä¾›ç»™äº†å¤šç§æ‰“åŒ…æ–¹å¼ï¼ŒåŒ…æ‹¬Dockerfileï¼Œjib maven&amp;gradleï¼Œbuildpacksï¼ŒBazelï¼ŒKoï¼Œcustom scriptã€‚</span><br><span class="line">    * å½“å‰demoä¸­ä½¿ç”¨äº†jib mavençš„æ–¹å¼æ‰“åŒ…ï¼Œåªéœ€è¦åœ¨skaffoldä¸­æŒ‡å®šbuildçš„æ–¹å¼å¦‚ä¸‹æ‰€ç¤ºçš„é…ç½®ï¼š</span><br><span class="line"></span><br><span class="line">    ```yaml</span><br><span class="line">    build:</span><br><span class="line">        artifacts:</span><br><span class="line">        - image: skaffold-webflux-example</span><br><span class="line">            jib:</span><br><span class="line">            args:</span><br><span class="line">            - -Psync</span><br><span class="line">            sync: </span><br><span class="line">                auto: true</span><br><span class="line">        local: &#123;&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>åœ¨è¿è¡Œ<font style="font-family:courier;" size="4"><em><strong>docker images</strong></em></font>æŸ¥çœ‹é•œåƒæ˜¯å¦ï¼Œæ‰“åŒ…æˆåŠŸï¼Œå¦‚ã€å›¾äº”ã€‘æ‰€ç¤ºï¼š</li>
</ul>
<p>  <img src="https://user-images.githubusercontent.com/6279298/160626812-97cc9ac5-3200-46d9-9268-797b578a3944.png" alt="ã€å›¾äº”ã€‘"><br>  <p style="text-align:center" > ã€å›¾äº”ã€‘ </p>                  </p>
</li>
<li><p>æµ‹è¯•é•œåƒ</p>
<ul>
<li>å½“é•œåƒæ„å»ºæˆåŠŸä¹‹åï¼Œè¿è¡Œ<font style="font-family:courier;" size="4"><em><strong>skaffold test â€“images skaffold-webflux-example</strong></em></font>æµ‹è¯•é•œåƒæ˜¯å¦æ‰“åŒ…æˆåŠŸï¼Œä»¥åŠä½¿ç”¨shellè„šæœ¬è¿è¡Œunit testæˆ–è€…å…¶ä»–æµ‹è¯•å†…å®¹ã€‚</li>
<li>æµ‹è¯•çš„ç§ç±»<ul>
<li>structureTestsï¼ˆé•œåƒçš„ç»“æ„æµ‹è¯•ï¼Œå¦‚commandæµ‹è¯•ï¼ŒfileExistæµ‹è¯•ï¼ŒfileContentæµ‹è¯•ï¼‰</li>
<li>Custom ï¼ˆæŒ‡å®šæµ‹è¯•è„šæœ¬ï¼‰</li>
</ul>
</li>
</ul>
</li>
<li><p>éƒ¨ç½²é•œåƒ</p>
<ul>
<li>éƒ¨ç½²æ–¹å¼çš„æ”¯æŒ<ul>
<li>Kubectl <font color="yellow">*</font> ï¼ˆåœ¨demoä¸­é‡‡ç”¨kubectl applyçš„æ–¹å¼æ¥éƒ¨ç½²é•œåƒï¼‰<ul>
<li><p>è¿è¡Œå‘½ä»¤<font style="font-family:courier;" size="4"><em><strong>Skaffold deploy</strong></em></font>ï¼Œå¹¶åœ¨skaffold.yamlä¸­åŠ å…¥å¦‚ä¸‹çš„é…ç½®ï¼š</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">deploy:</span></span><br><span class="line">    <span class="attr">kubectl:</span></span><br><span class="line">        <span class="attr">manifests:</span></span><br><span class="line">        <span class="bullet">-</span> <span class="string">k8s-web.yaml</span></span><br></pre></td></tr></table></figure></li>
<li><p>ä½¿ç”¨<em><strong>kubectl get pods</strong></em>ï¼ŒæŸ¥çœ‹èŠ‚ç‚¹æ˜¯å¦éƒ¨ç½²æˆåŠŸï¼Œå¦‚ã€å›¾å…­ã€‘æ‰€ç¤ºï¼š<br>  <img src="https://user-images.githubusercontent.com/6279298/160628288-7d5d16a0-77e0-47c9-993c-32fa2823fce1.png" alt="ã€å›¾å…­ã€‘"></p>
</li>
<li><p>ä½¿ç”¨<em><strong>kubectl port-forward ã€pods nameã€‘ 8080:8080</strong></em>, è¿è¡Œ<code>curl --get http://localhost:8080/hello</code>ï¼ŒæŸ¥çœ‹æœåŠ¡æ˜¯å¦èƒ½å¤ŸæˆåŠŸè¢«è®¿é—®ã€‚ï¼ˆéƒ¨ç½²ä¹‹åï¼Œk8sä¸­çš„æœåŠ¡çš„ç«¯å£å¹¶æ²¡æœ‰è¢«æš´éœ²ï¼Œæ‰€ä»¥éœ€è¦æ“ä½œä¸€ä¸‹ç«¯å£æ˜ å°„ï¼‰ã€‚</p>
</li>
</ul>
</li>
<li>Helm</li>
<li>Kustomize</li>
<li>Docker</li>
</ul>
</li>
</ul>
</li>
<li><p>å…¶ä»–åŠŸèƒ½</p>
<ul>
<li><font style="font-family:courier;" size="4"><em><strong>Clean up</strong></em></font>ï¼ˆæ¸…é™¤éƒ¨ç½²ï¼‰<ul>
<li>ctrl+C</li>
<li>Skaffold delete</li>
</ul>
</li>
<li><font style="font-family:courier;" size="4"><em><strong>Tagpolicy</strong></em></font>ï¼ˆé•œåƒç‰ˆæœ¬å·ï¼‰<ul>
<li>Git commitçš„ç´¢å¼•å·</li>
<li>Sha256ç¼–ç </li>
<li>ç¯å¢ƒå˜é‡</li>
<li>æ—¶é—´æˆ³</li>
</ul>
</li>
<li><font style="font-family:courier;" size="4"><em><strong>Port forward</strong></em></font> ï¼ˆç«¯å£æ˜ å°„)  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">portForward:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">resourceType:</span> <span class="string">deployment</span></span><br><span class="line"><span class="attr">resourceName:</span> <span class="string">skaffold-webflux-example-web</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">localPort:</span> <span class="number">8080</span>    </span><br></pre></td></tr></table></figure></li>
<li><font style="font-family:courier;" size="4"><em><strong>File sync</strong></em></font>ï¼ˆçƒ­éƒ¨ç½²ï¼‰<ul>
<li>autoï¼Œä»…é€‚ç”¨äºjibï¼Œbulidpackçš„æ‰“åŒ…æ¨¡å¼ï¼ŒåŠ å…¥ä¸€ä¸‹é…ç½®  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jib:</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-Psync</span></span><br></pre></td></tr></table></figure></li>
<li>infer</li>
<li>manual</li>
</ul>
</li>
</ul>
</li>
<li><p>å®Œæ•´skaffold yaml manifest</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">apiVersion:</span> <span class="string">skaffold/v2beta26</span></span><br><span class="line"><span class="attr">kind:</span> <span class="string">Config</span></span><br><span class="line"><span class="attr">metadata:</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">rxjavademo</span></span><br><span class="line"><span class="attr">build:</span></span><br><span class="line"><span class="attr">tagPolicy:</span></span><br><span class="line">    <span class="attr">envTemplate:</span></span><br><span class="line">    <span class="attr">template:</span> <span class="string">&quot;<span class="template-variable">&#123;&#123;.FOO&#125;&#125;</span>&quot;</span></span><br><span class="line"><span class="attr">artifacts:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">image:</span> <span class="string">skaffold-webflux-example</span></span><br><span class="line">    <span class="attr">jib:</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-Psync</span></span><br><span class="line">    <span class="attr">sync:</span> </span><br><span class="line">    <span class="attr">auto:</span> <span class="literal">true</span></span><br><span class="line"><span class="attr">local:</span> &#123;&#125;</span><br><span class="line">    </span><br><span class="line"><span class="attr">deploy:</span></span><br><span class="line"><span class="attr">kubectl:</span></span><br><span class="line">    <span class="attr">manifests:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">k8s-web.yaml</span></span><br><span class="line"></span><br><span class="line"><span class="attr">test:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">image:</span> <span class="string">skaffold-webflux-example</span></span><br><span class="line">    <span class="attr">structureTests:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">&#x27;./structure-test/*&#x27;</span></span><br><span class="line">    <span class="attr">custom:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="attr">command:</span> <span class="string">./scripts/test.sh</span></span><br><span class="line">        <span class="attr">timeoutSeconds:</span> <span class="number">60</span></span><br><span class="line"></span><br><span class="line"><span class="attr">portForward:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">resourceType:</span> <span class="string">deployment</span></span><br><span class="line"><span class="attr">resourceName:</span> <span class="string">skaffold-webflux-example-web</span></span><br><span class="line"><span class="attr">namespace:</span> <span class="string">default</span></span><br><span class="line"><span class="attr">port:</span> <span class="number">8080</span></span><br><span class="line"><span class="attr">localPort:</span> <span class="number">8080</span>    </span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><p><font color="orange" size="5"><strong>å‘ï¼ï¼ï¼</strong></font></p>
<ul>
<li><p><font color="" size="4"><strong>è¿™ä¸ªæ˜¯åšè¿™ä¸ªåˆ†äº«ä¸­æœ€å‘çš„ä¸€ä¸ªéƒ¨åˆ†ï¼ï¼!</strong></font>æ ¹æ®æ–‡æ¡£ä¸­çš„ä»‹ç»ï¼Œå¦‚æœæ˜¯ä½¿ç”¨jibæ¨¡å¼çš„è¯ï¼Œå¯ä»¥é‡‡ç”¨<code>auto aync</code>çš„æ–¹å¼ã€‚è®¾ç½®ä¹‹åï¼Œå¹¶ä¸ç”Ÿæ•ˆï¼Œåè€Œä¼šæŠ¥é”™ï¼Œ <code>WARN[0044] Skipping deploy due to sync error: copying files: didn&#39;t sync any files</code></p>
</li>
<li><p>åœ¨gitä¸Šé‡è§ç›¸åŒçš„é—®é¢˜<br>  <a target="_blank" rel="noopener" href="https://github.com/GoogleContainerTools/skaffold/issues/4246">Skipping deploy due to sync error: copying files: didnâ€™t sync any files #4246
  </a></p>
</li>
<li><p>å½“æ—¶æˆ‘ä½¿ç”¨çš„ç‰ˆæœ¬æ˜¯<strong>1.35.0</strong>ï¼Œç„¶åæˆ‘å‡çº§åˆ°äº†æœ€æ–°çš„ç‰ˆæœ¬<code>brew ungrade skaffold</code>ï¼Œç„¶ådeployé•œåƒï¼Œæ»¡å¿ƒæ¬¢å–œçš„æƒ³ç€ï¼Œæ”¹å˜ä»£ç ï¼Œèƒ½å¤Ÿçƒ­éƒ¨ç½²ã€‚æ–‡ä»¶ç¡®å®è¢«æ˜¾ç¤ºç”Ÿæ•ˆäº†ï¼Œä½†æ˜¯ï¼Œapplicationçš„å†…å®¹å¹¶æ²¡æœ‰æ›´æ–°ã€‚å¦‚ä¸‹æ‰€ç¤ºï¼š<br>  <img src="https://user-images.githubusercontent.com/6279298/160637419-babb88a1-7190-4076-83fa-6e7b36d2f356.gif" alt="not work"></p>
</li>
<li><p>æ²¡ç”Ÿæ•ˆä¹‹å‰é‡‡ç”¨çš„éƒ¨ç½²æ¨¡å¼æ˜¯<strong>skaffold+helm</strong>çš„æ¨¡å¼ï¼ˆä¸ºå•¥æ²¡æœ‰ç”Ÿæ•ˆå¾—ç»§ç»­è¯»è¯»æºç äº†23333ï¼‰ï¼Œæˆ‘æ¢äº†ä¸€ç§æ¨¡å¼ï¼Œé‡‡ç”¨äº†<strong>skaffold+kubectl</strong>çš„éƒ¨ç½²æ¨¡å¼ã€‚é¦–å…ˆåœ¨é¡¹ç›®çš„pomæ–‡ä»¶ä¸­æ·»åŠ ä¸€ä¸ªidä¸ºsyncçš„Profilesï¼Œè¯¥ä¾èµ–çš„ä½œç”¨æ˜¯ï¼Œåªè¦ç±»è·¯å¾„ä¸Šçš„æ–‡ä»¶å‘ç”Ÿå˜åŒ–ï¼Œä½¿ç”¨<strong>spring-boot-devtools</strong>çš„åº”ç”¨ç¨‹åºå°±ä¼š<a target="_blank" rel="noopener" href="https://docs.spring.io/spring-boot/docs/current/reference/html/using.html#using.devtools.restart">è‡ªåŠ¨é‡å¯</a>ï¼Œå¦‚ä¸‹æ‰€ç¤ºï¼š</p>
  <figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">profiles</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">profile</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">id</span>&gt;</span>sync<span class="tag">&lt;/<span class="name">id</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;<span class="name">dependencies</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.boot<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-boot-devtools<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">                <span class="tag">&lt;<span class="name">optional</span>&gt;</span>true<span class="tag">&lt;/<span class="name">optional</span>&gt;</span></span><br><span class="line">            <span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line">        <span class="tag">&lt;/<span class="name">dependencies</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;/<span class="name">profile</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">profiles</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li><p>ç„¶ååœ¨skaffold.yamlçš„<strong>build</strong>çš„sectionä¸­åŠ äº†ä»¥ä¸‹çš„å†…å®¹ï¼Œè¿™æ ·å¯ä»¥ä¸ºmavenä¼ é€’å‚æ•°ï¼Œä»è€Œæ¿€æ´»profileï¼Œè®©applicationé‡æ–°å¯åŠ¨</p>
  <figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">jib:</span></span><br><span class="line">    <span class="attr">args:</span></span><br><span class="line">    <span class="bullet">-</span> <span class="string">-Psync</span></span><br></pre></td></tr></table></figure></li>
<li><p>ç»ˆäºæˆåŠŸäº†ï¼ï¼ï¼ï¼<br>  <img src="https://user-images.githubusercontent.com/6279298/160638449-ee65fd8b-d833-42b3-a5f6-0ebc0b67e8ae.gif" alt="ok"></p>
</li>
</ul>
</li>
<li><p><font color="RED" size="5"><strong>åº”ç”¨åœºæ™¯</strong></font></p>
<ul>
<li>ä½œä¸ºpipelineä¸­çš„é•œåƒæ‰“åŒ…å’Œä¸Šä¼ å·¥å…·</li>
<li>æœ¬åœ°é•œåƒæ„å»ºå·¥å…·</li>
<li>Minimal pipeline</li>
<li>Demo showcase</li>
</ul>
</li>
<li><p><font color="BROWN" size="5"><strong>æ€»ç»“</strong></font></p>
<ul>
<li>Pros<ul>
<li>Skaffoldå¯ä»¥è®©æœ¬åœ°çš„k8séƒ¨ç½²å˜å¾—æ›´ç®€å•ï¼Œåªéœ€è¦é…ç½®å¥½å¯¹åº”çš„manifest</li>
<li>åŠŸèƒ½å¯ä»¥æ‹†åˆ†ä½¿ç”¨ï¼Œæ¯”è¾ƒçµæ´»</li>
<li>Skaffoldé…ç½®å†…å®¹æ¯”è¾ƒç®€å•</li>
<li>Open-source å·¥å…·ï¼Œæœ‰ç¤¾åŒºåŠ›é‡æ”¯æŒ</li>
</ul>
</li>
<li>Cons<ul>
<li>å¦‚æœè¦äº†è§£æ›´å¤šçš„å†…å®¹å¯èƒ½éœ€è¦ä¸€å®šçš„å­¦ä¹ æˆæœ¬ï¼ŒåŒ…æ‹¬golangçš„åŸºç¡€ï¼Œk8sçš„éƒ¨ç½²åŸºç¡€ã€‚</li>
</ul>
</li>
</ul>
</li>
</ul>
</br>

<ul>
<li><font style="font-family:courier;" size="5" color="yellow">æ„Ÿè°¢å¤§å®¶çœ‹åˆ°æœ€åï¼Œå¦‚æœä¸æ­£ç¡®çš„åœ°æ–¹ï¼Œä¸åèµæ•™</font></li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/ops/tree/main/skaffoldDemo">skaffold</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/tech/ops/CD/2023/03/05/ops-skaffold/" data-id="clev2anbb001jj8hs7jht7bqs" data-title="ops_skaffold" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  


  <nav id="page-nav">
    
    <span class="page-number current">1</span><a class="page-number" href="/page/2/">2</a><a class="page-number" href="/page/3/">3</a><a class="page-number" href="/page/4/">4</a><a class="extend next" rel="next" href="/page/2/">Next &raquo;</a>
  </nav>

</section>
        
          <aside id="sidebar">
  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Categories</h3>
    <div class="widget">
      <ul class="category-list"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/">tech</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/dotnet-core/">dotnet-core</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/design-pattern/">design-pattern</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/lint/">lint</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/spring-boot/">spring-boot</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/spring-boot/101/">101</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/spring-boot/auth0/">auth0</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/spring-boot/jwt/">jwt</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/spring-boot/starter/">starter</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/spring-boot/webflux/">webflux</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/swagger/">swagger</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/java/swagger/open-api/">open-api</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/kotlin/">kotlin</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/kotlin/101/">101</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/kotlin/Android/">Android</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/kotlin/idea-pulgins/">idea pulgins</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/">ops</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/CD/">CD</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/cache/">cache</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/k8s/">k8s</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/k8s/secret/">secret</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/log/">log</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/ops/package/">package</a></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/shell/">shell</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/test/">test</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/test/gatling/">gatling</a></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/test/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/test/java/es/">es</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/tech/video/">video</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/tech/video/ffmpeg/">ffmpeg</a></li></ul></li></ul></li><li class="category-list-item"><a class="category-list-link" href="/categories/techt/">techt</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/techt/java/">java</a><ul class="category-list-child"><li class="category-list-item"><a class="category-list-link" href="/categories/techt/java/java-feature-option-optional/">java feature option-optional</a></li></ul></li></ul></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic-search-java-test/" rel="tag">elastic search, java, test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/es/" rel="tag">es</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/" rel="tag">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg-coverting-format/" rel="tag">ffmpeg, coverting format</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg-media-server/" rel="tag">ffmpeg, media-server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-design-pattern-easy-rule/" rel="tag">java, design-pattern, easy-rule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-lint/" rel="tag">java, lint</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-spring-customer-starter/" rel="tag">java, spring, customer-starter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-spring-boot-auth0/" rel="tag">java, spring-boot, auth0</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/elastic-search-java-test/" style="font-size: 10px;">elastic search, java, test</a> <a href="/tags/es/" style="font-size: 10px;">es</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/ffmpeg-coverting-format/" style="font-size: 10px;">ffmpeg, coverting format</a> <a href="/tags/ffmpeg-media-server/" style="font-size: 10px;">ffmpeg, media-server</a> <a href="/tags/java-design-pattern-easy-rule/" style="font-size: 10px;">java, design-pattern, easy-rule</a> <a href="/tags/java-lint/" style="font-size: 10px;">java, lint</a> <a href="/tags/java-spring-customer-starter/" style="font-size: 10px;">java, spring, customer-starter</a> <a href="/tags/java-spring-boot-auth0/" style="font-size: 10px;">java, spring-boot, auth0</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/tech/dotnet-core/2023/03/05/dotnet-core-related/">dotnet_core_related</a>
          </li>
        
          <li>
            <a href="/tech/test/gatling/2023/03/05/gatling-load-test/">gatling_load_test</a>
          </li>
        
          <li>
            <a href="/tech/test/gatling/2023/03/05/gatling-101/">gatling_101</a>
          </li>
        
          <li>
            <a href="/tech/shell/2023/03/05/shell-disk-operation/">shell_disk_operation</a>
          </li>
        
          <li>
            <a href="/tech/shell/2023/03/05/shell-file-operation/">shell_file_operation</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Zengqiang Fang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>