<!DOCTYPE html>
<html>
<head>
  <meta charset="utf-8">
  
  
  <title>ğŸª³çš„Daily Blog WebSite</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">
  <meta property="og:type" content="website">
<meta property="og:title" content="ğŸª³çš„Daily Blog WebSite">
<meta property="og:url" content="http://fdslk.github.io/index.html">
<meta property="og:site_name" content="ğŸª³çš„Daily Blog WebSite">
<meta property="og:locale" content="en_US">
<meta property="article:author" content="Zengqiang Fang">
<meta name="twitter:card" content="summary">
  
    <link rel="alternate" href="/atom.xml" title="ğŸª³çš„Daily Blog WebSite" type="application/atom+xml">
  
  
    <link rel="shortcut icon" href="/favicon.png">
  
  
    
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/typeface-source-code-pro@0.0.71/index.min.css">

  
  
<link rel="stylesheet" href="/css/style.css">

  
    
<link rel="stylesheet" href="/fancybox/jquery.fancybox.min.css">

  
<meta name="generator" content="Hexo 6.3.0"></head>

<body>
  <div id="container">
    <div id="wrap">
      <header id="header">
  <div id="banner"></div>
  <div id="header-outer" class="outer">
    <div id="header-title" class="inner">
      <h1 id="logo-wrap">
        <a href="/" id="logo">ğŸª³çš„Daily Blog WebSite</a>
      </h1>
      
    </div>
    <div id="header-inner" class="inner">
      <nav id="main-nav">
        <a id="main-nav-toggle" class="nav-icon"></a>
        
          <a class="main-nav-link" href="/">Home</a>
        
          <a class="main-nav-link" href="/archives">Archives</a>
        
      </nav>
      <nav id="sub-nav">
        
          <a id="nav-rss-link" class="nav-icon" href="/atom.xml" title="RSS Feed"></a>
        
        <a id="nav-search-btn" class="nav-icon" title="Search"></a>
      </nav>
      <div id="search-form-wrap">
        <form action="//google.com/search" method="get" accept-charset="UTF-8" class="search-form"><input type="search" name="q" class="search-form-input" placeholder="Search"><button type="submit" class="search-form-submit">&#xF002;</button><input type="hidden" name="sitesearch" value="http://fdslk.github.io"></form>
      </div>
    </div>
  </div>
</header>

      <div class="outer">
        <section id="main">
  
    <article id="post-ffmpeg-simple-convert" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/ffmpeg-simple-convert/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:57:25.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/ffmpeg-simple-convert/">ffmpeg_simple_convert</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="æµ…è°ˆffmpeg"><a href="#æµ…è°ˆffmpeg" class="headerlink" title="æµ…è°ˆffmpeg"></a>æµ…è°ˆffmpeg</h1><h2 id="ä¸ºä»€ä¹ˆè¦åˆ†äº«è¿™ä¸ªç©æ„"><a href="#ä¸ºä»€ä¹ˆè¦åˆ†äº«è¿™ä¸ªç©æ„" class="headerlink" title="ä¸ºä»€ä¹ˆè¦åˆ†äº«è¿™ä¸ªç©æ„"></a>ä¸ºä»€ä¹ˆè¦åˆ†äº«è¿™ä¸ªç©æ„</h2><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<font size=4 color=red><strong>One day,</strong></font> æˆ‘åœ¨Macä¸Šä¸‹è½½äº†ä¸€éƒ¨ç”µå½±ï¼Œç„¶åæƒ³æ‹·è´åˆ°Uç›˜ä¸­ï¼Œç„¶åå†è¿æ¥ç”µè§†ä¸Šçš„æ¥å£ã€‚è¿™æ—¶å€™å‘¢ï¼Œæ­£å½“æˆ‘è¦æ‹·è´ç”µå½±çš„æ—¶å€™ï¼Œé‡åˆ°äº†æˆ‘çš„çŸ¥è¯†ç›²åŒºäº†ï¼Œä¸ºå•¥æˆ‘çš„Uç›˜èƒ½æ£€æµ‹åˆ°ï¼Œä½†æ˜¯ç”µè„‘ä¸Šçš„æ–‡ä»¶æ²¡æ³•å¾€Uç›˜é‡Œå¤´é€ï¼Œä½†æ˜¯Uç›˜é‡Œé¢ä¸œè¥¿åˆå¯ä»¥å¾€å¤–é¢ä¼ å‘¢ï¼Ÿæˆ‘å°è¯•äº†ä¸‹é¢å‡ ç§æ–¹æ³•ï¼š</p>
<ul>
<li>ç¿»ç®±å€’æŸœï¼Œæ‰¾å‡ºå…¶ä»–çš„Uç›˜ï¼Œä¸€ä¸ªä¸ªçš„è¯•&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#10006;</li>
<li>ç»™ç”µè„‘åŠ ä¸€ä¸ªhubï¼Œç„¶åæŠŠUç›˜æ’åˆ°hubä¸Š&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#10006; </li>
<li>å°è¯•ä¸åŒçš„Mac&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;#10006;</li>
</ul>
<p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;æ²¡æ³•å­äº†ï¼Œåªèƒ½Googleä¸€ä¸‹äº†ï¼Œå…¶å®å°±æ˜¯æ ¼å¼çš„é—®é¢˜ï¼ŒUç›˜å’Œç§»åŠ¨ç¡¬ç›˜ä¸€èˆ¬éƒ½æ˜¯NTFSæ ¼å¼çš„ï¼Œè€ŒMacæ˜¯ä¸æ”¯æŒè¿™ä¸ªæ ¼å¼ç£ç›˜çš„å†™å…¥çš„ï¼Œæ‰€ä»¥åœ¨Macä¸Šæ— æ³•æ‹·è´æ–‡ä»¶åˆ°Uç›˜ã€‚æ‰€ä»¥ï¼Œè¦ä¹ˆå°±æ˜¯æ ¼å¼åŒ–Uç›˜ï¼Œç„¶åå†é‡æ–°åˆ·Uç›˜ã€‚<br><img src="https://user-images.githubusercontent.com/6279298/211694505-dac30b23-e055-4201-85c5-54c09544cb95.png" alt="Girl in a jacket" width="60" height="60"></p>
<p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ç®—äº†è¦ä¸æˆ‘ç›´æ¥åœ¨Macä¸Šçœ‹å§ï¼ŒMacä¸Šçš„å”¯ä¸€çš„æ’­æ”¾å™¨åªæœ‰<code>QuickTimer</code>, ä½†æ˜¯æ­¤æ’­æ”¾å™¨èƒ½æ”¯æŒçš„æ ¼å¼åˆæ˜¯æœ‰é™äº†ï¼Œä¸‹è½½çš„ç”µå½±æ ¼å¼ä¸€èˆ¬éƒ½æ˜¯<code>mkv</code>æ ¼å¼ä¸ºä¸»ï¼Œæ‰€ä»¥QuickTimeè‡ªç„¶ä¹Ÿå°±ä¸æ”¯æŒçš„å’¯ã€‚è¿™æ—¶å€™ï¼Œè§£å†³åŠæ³•æƒ³äº†ä¸¤ä¸ªã€‚è¦ä¹ˆä¸‹è½½ä¸€ä¸ªå¯ä»¥æ”¯æŒå…¶ä»–æ ¼å¼çš„æ’­æ”¾å™¨ï¼Œè¦ä¹ˆå°±æ˜¯è½¬æ ¼å¼ã€‚æˆ‘é€‰æ‹©äº†åè€…ï¼Œä½œä¸ºæ–°ç”Ÿä»£å†œæ°‘å·¥çš„æˆ‘å‘¢è¿˜æ˜¯æƒ³è¦ç”¨è‡ªå·±çš„æ‰‹è‰ºæ¥è§£å†³è¿™ä¸ªé—®é¢˜ï¼Œé‚£å°±æ˜¯å†™ä»£ç æå®šï¼Œå…¶å®æ˜¯æ²¡æœ‰æ‰¾åˆ°æ¯”è¾ƒå¥½çš„å·¥å…·ã€‚<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;å¼€å§‹Googleï¼Œ<code>how to convert mkv to mp4 in java</code> <img width="200" alt="how to convert mkv to mp4 in java" src="https://user-images.githubusercontent.com/6279298/211951360-4aa64823-af8b-4005-815e-53942aa3c2e5.png"> ,<br><code>how to convert mkv to mp4 in python</code><img width="200" alt="how to convert mkv to mp4 in python" src="https://user-images.githubusercontent.com/6279298/211951383-352e6dde-5ca9-4615-be68-32ba84f1cf60.png"> ,<br><code>~ in golang</code> <img width="200" alt="how to convert mkv to mp4 in golang" src="https://user-images.githubusercontent.com/6279298/211951464-68d133a1-3748-4d34-a5f3-2f08333f43ed.png"><br>ä»æ¯ä¸ªæœç´¢ç»“æœä¸­éƒ½èƒ½å‘ç°ä¸€ä¸ªç›¸åŒçš„å·¥å…·<font color=red size=3><strong>ffmpeg</strong></font>, å¾ˆå¥½å¥‡è¿™ä¸ªæ˜¯å¹²å˜›çš„çš„ä¸œè¥¿ï¼Œå¤§å®¶å°±æ¥ç€å¾€ä¸‹çœ‹å§</p>
<h2 id="ffmpegæ˜¯ä»€ä¹ˆ"><a href="#ffmpegæ˜¯ä»€ä¹ˆ" class="headerlink" title="ffmpegæ˜¯ä»€ä¹ˆ"></a>ffmpegæ˜¯ä»€ä¹ˆ</h2><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;<font><strong>FFmpeg</strong></font>æ˜¯ä¸€ä¸ªå…è´¹çš„å¼€æºè½¯ä»¶é¡¹ç›®ï¼Œç”±ä¸€å¥—å¤„ç†è§†é¢‘ã€éŸ³é¢‘å’Œå…¶ä»–å¤šåª’ä½“æ–‡ä»¶å’Œæµçš„åº“å’Œç¨‹åºç»„æˆã€‚ffmpegä¸»è¦æ˜¯è¢«å½“åšå‘½ä»¤è¡Œå·¥å…·æ¥ä½¿ç”¨ï¼Œffmpegä¸»è¦ç”¨äºå¤„ç†è§†é¢‘å’ŒéŸ³é¢‘æ–‡ä»¶ã€‚å®ƒè¢«å¹¿æ³›ç”¨äºæ ¼å¼è½¬æ¢ã€åŸºæœ¬ç¼–è¾‘(ä¿®å‰ªå’Œæ‹¼æ¥)ã€è§†é¢‘ç¼©æ”¾ã€è§†é¢‘åæœŸåˆ¶ä½œæ•ˆæœ</p><br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;FFmpegé™¤äº†æœ¬èº«çš„å·¥å…·ä¹‹å¤–ï¼Œå®é™…ä¸Šæ˜¯è¢«åˆ†æˆäº†æ˜¯ä¸‰ä¸ªå·¥å…·<code>ffmpeg</code>ï¼Œ<code>ffprobe</code>ä»¥åŠ<code>ffplay</code>ã€‚<a target="_blank" rel="noopener" href="http://ffmpeg.org/ffprobe.html">ffprobe</a>ä¸»è¦ç”¨äºåˆ†ææµåª’ä½“æ•°æ®ï¼Œæå–æµåª’ä½“ä¸­çš„éŸ³è§†é¢‘ä¿¡æ¯ï¼Œ<a target="_blank" rel="noopener" href="http://ffmpeg.org/ffplay.html">ffplay</a>æ˜¯ffmpegå¼€å‘çš„minimalçš„è§†é¢‘æ’­æ”¾å™¨ï¼Œä½†æ˜¯è¿™ä¸‰ç±»å·¥å…·éƒ½æ˜¯å‘½ä»¤è¡Œå·¥å…·ï¼Œå¯¹äºä¸å¤ªäº†è§£è®¡ç®—æœºçš„åŒå­¦æ¥è¯´ä¸æ˜¯ç‰¹åˆ«çš„å‹å¥½ã€‚<br>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ffmpegæ•´ä½“éƒ½æ˜¯åŸºäº<code>C++</code>å¼€å‘çš„ä¸€å¥—æ¡†æ¶ï¼Œå› ä¸ºæ˜¯å¼€æºé¡¹ç›®ï¼Œæ‰€ä»¥æœ‰å¾ˆå¤§çš„DIYç©ºé—´ã€‚äºæ­¤åŒæ—¶ï¼Œå¯¹äºä¸å¤ªç†Ÿæ‚‰<code>C++</code>çš„åŒå­¦æ¥è¯´ï¼Œå¦‚æœæƒ³ç”¨ffmpegæ¥åšä¸€äº›äºŒæ¬¡å¼€å‘ï¼Œç°åœ¨ä¹Ÿæœ‰å¾ˆå¤šå…¶ä»–è¯­è¨€çš„wrapperåŒ…ï¼Œä»¥ä¸‹è¿™å‡ ä¸ªæ˜¯staræ•°æ¯”è¾ƒå¤šï¼Œè€Œä¸”æäº†issueä½œè€…ä¼šç»™å›ç­”çš„é¡¹ç›®ï¼š</p>
<ul>
<li>java <ul>
<li><a target="_blank" rel="noopener" href="https://github.com/bytedeco/javacpp-presets/tree/master/ffmpeg">javacpp-presets</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/bramp/ffmpeg-cli-wrapper">ffmpeg-cli-wrapper</a></li>
</ul>
</li>
<li>go<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/u2takey/ffmpeg-go">ffmpeg-go</a></li>
</ul>
</li>
</ul>
<p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;è¿™é‡Œè¿˜æœ‰ä¸€ä¸ªå°æé†’ç»™å¤§å®¶ï¼Œffmpegè¿™ä¹ˆå¥½ç”¨ï¼Œå…¶å®å¾ˆå¤šçš„æ’­æ”¾å™¨éƒ½æ˜¯åŸºäºäº†ffmpegåšäº†äºŒæ¬¡å¼€å‘ï¼Œé‚£ä¹ˆå¯¹äºä½¿ç”¨ffmpegçš„å¼€å‘è€…æ¥è¯´ï¼Œå°±æœ‰ä¸€æ¡ä¸æˆæ–‡çš„è§„åˆ™ï¼Œå¦‚æœä½ ä½¿ç”¨äº†è¿™ä¸ªæ¡†æ¶ï¼Œä½ å°±éœ€è¦å¼€æºä½ çš„é¡¹ç›®ï¼Œå¦åˆ™ä½ å¯èƒ½ä¼šè¢«é’‰åœ¨ffmpegçš„<a target="_blank" rel="noopener" href="http://ffmpeg.org/shame.html">Hall of Shame(è€»è¾±æŸ±)</a></p>
<p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ä¸‹é¢ç»™å¤§å®¶é¡ºå¸¦è¯´ä¸€ä¸‹ï¼Œffmpegä¸­ä½¿ç”¨çš„ä¸€äº›é«˜é¢‘ç‡çš„library</p>
<ul>
<li>libavcodec, æä¾›äº†ä¸€ä¸ªé€šç”¨çš„ç¼–ç &#x2F;è§£ç æ¡†æ¶ï¼ŒåŒ…å«éŸ³é¢‘ã€è§†é¢‘å’Œå­—å¹•æµçš„å¤šä¸ªè§£ç å™¨å’Œç¼–ç å™¨</li>
<li>libavformat, ä¸ºéŸ³é¢‘ã€è§†é¢‘å’Œå­—å¹•æµçš„å¤šè·¯å¤ç”¨å’Œè§£å¤ç”¨(muxingå’Œdemuxing)æä¾›äº†ä¸€ä¸ªé€šç”¨æ¡†æ¶</li>
<li>libavfilterï¼ŒéŸ³è§†é¢‘æµçš„å¤„ç†ï¼ŒåŒ…æ‹¬è§†é¢‘çš„æ¯”ç‰¹ç‡ä¿®æ”¹ï¼ŒéŸ³é¢‘çš„é¢‘ç‡çš„ä¿®æ”¹ï¼Œä»¥åŠå¤šä¸ªè§†é¢‘çš„åˆå¹¶ç­‰ç­‰æ“ä½œ</li>
<li>libavdeviceï¼Œæä¾›äº†ä¸€ä¸ªé€šç”¨æ¡†æ¶ï¼Œç”¨äºä»è®¸å¤šå¸¸è§çš„å¤šåª’ä½“è¾“å…¥&#x2F;è¾“å‡ºè®¾å¤‡æŠ“å–å’Œå‘ˆç°ï¼Œå¹¶æ”¯æŒå¤šç§è¾“å…¥å’Œè¾“å‡ºè®¾å¤‡ï¼Œä¾‹å¦‚Video4Linux2ã€VfWã€DShowå’ŒALSA</li>
</ul>
<h2 id="ffmpegçš„ä¸€äº›åŸºç¡€ç”¨æ³•"><a href="#ffmpegçš„ä¸€äº›åŸºç¡€ç”¨æ³•" class="headerlink" title="ffmpegçš„ä¸€äº›åŸºç¡€ç”¨æ³•"></a>ffmpegçš„ä¸€äº›åŸºç¡€ç”¨æ³•</h2><h3 id="å®‰è£…"><a href="#å®‰è£…" class="headerlink" title="å®‰è£…"></a>å®‰è£…</h3><ul>
<li>å¤§å®¶å¯ä»¥æ ¹æ®è‡ªå·±çš„å¹³å°ä¸‹è½½å¯¹åº”çš„å®‰è£…åŒ…ï¼Œåœ¨<a target="_blank" rel="noopener" href="http://ffmpeg.org/download.html#get-sources">ffmpegå®˜ç½‘</a>å¯ä»¥ç›´æ¥ä¸‹è½½</li>
<li>åœ¨Macç”µè„‘ä¸Šè¿˜å¯ä»¥ä½¿ç”¨<code>brew</code>ç›´æ¥å®‰è£…ï¼Œè¿è¡Œä»¥ä¸‹å‘½ä»¤ï¼š<code>brew install ffmpeg</code></li>
</ul>
<h3 id="ä½¿ç”¨"><a href="#ä½¿ç”¨" class="headerlink" title="ä½¿ç”¨"></a>ä½¿ç”¨</h3><h4 id="ffplay"><a href="#ffplay" class="headerlink" title="ffplay"></a>ffplay</h4><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ffplayä½¿ç”¨æ–¹å¼éå¸¸ç®€å•ï¼Œè¿™é‡Œç»™å¤§å®¶ä»‹ç»ä¸€äº›ç®€å•çš„å‘½ä»¤</p>
<ul>
<li><code>ffplay &lt;input source path&gt;</code> è¿™æ ·å°±æ˜¯ä»¥ffplayæä¾›çš„é»˜è®¤è®¾ç½®æ’­æ”¾è§†é¢‘</li>
<li><code>ffplay -x -y &lt;input source path&gt;</code> è¿™æ ·å°±å¯ä»¥æŒ‡å®šè§†é¢‘æ’­æ”¾çª—å£çš„å¤§å°</li>
<li><code>ffplay -fs &lt;input source path&gt;</code> è§†é¢‘å¼€å§‹ä»¥å…¨å±æ¨¡å¼æ’­æ”¾ </p></li>
</ul>
<p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;é™¤æ­¤ä¹‹å¤–ï¼Œffplayè¿˜å¾ˆå¤šå…¶ä»–çš„optionï¼Œå¤§å®¶å¦‚æœæœ‰å…´è¶£å¯ä»¥å‚ç…§å®˜ç½‘çš„<a target="_blank" rel="noopener" href="http://ffmpeg.org/ffplay.html#Main-options">è¯´æ˜</a>å°è¯•</p>
<h4 id="ffprobe"><a href="#ffprobe" class="headerlink" title="ffprobe"></a>ffprobe</h4><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ffprobeä¸»è¦å°±æ˜¯ç”¨äºåˆ†ææµåª’ä½“ä¸­çš„ä¿¡æ¯ï¼Œæ¯”å¦‚è¯´ï¼Œä½ æƒ³çŸ¥é“ï¼Œè¯¥è§†é¢‘ä¸­æœ‰å‡ ä¸ªè§†é¢‘æµï¼Œæœ‰å‡ ä¸ªéŸ³é¢‘æµï¼Œä»¥åŠå„è‡ªçš„ç¼–ç æ–¹å¼æ˜¯ä»€ä¹ˆï¼Œç­‰ç­‰è¯¸å¦‚æ­¤ç±»çš„ä¸œè¥¿ï¼Œå†ç»™å¤§å®¶åˆ†äº«ä¸€äº›ç®€å•çš„å‘½ä»¤</p>
<ul>
<li><code>ffprobe -v error &lt;input source path&gt; -show_format</code>, ç”¨è¿™ä¸ªå‘½ä»¤ä½ å°±å¯ä»¥çœ‹åˆ°ä½ è¿™ä¸ªå®¹å™¨ä¸­çš„æµåª’ä½“çš„ä¸€äº›åŸºæœ¬æ•°æ®ï¼Œå¦‚æœä½ è§‰å¾—ç”¨é»˜è®¤æ ¼å¼è¾“å‡ºä¸å¥½çœ‹çš„è¯ï¼Œè¿˜å¯ä»¥æ·»åŠ ä¸€ä¸ªå‚æ•°ï¼Œ<code>-print_format json</code>ï¼Œå…¶ä¸­çš„å‚æ•°<code>v</code>ä»£è¡¨çš„æ˜¯verbose<ul>
<li>jsonæ–‡ä»¶ä¸­å±•ç°äº†containerçš„ä¿¡æ¯ï¼Œå…¶ä¸­åŒ…æ‹¬äº†containerçš„æ–‡ä»¶åç§°ï¼Œbitrateç­‰ç­‰<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;bullfinch.mov&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;nb_streams&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;nb_programs&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mov,mp4,m4a,3gp,3g2,mj2&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;format_long_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;QuickTime / MOV&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.022000&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;143724856&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;bit_rate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;228952379&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;probe_score&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;major_brand&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qt  &quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;minor_version&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;compatible_brands&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qt  &quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;encoder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lavf58.45.100&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><code>ffprobe -v error &lt;input source path&gt; -show_streams</code> è¿™é‡Œä¼šå±•ç¤ºå‡ºæ‰€æœ‰çš„streamçš„ä¿¡æ¯ï¼Œæ‰€ä»¥ä½¿ç”¨å‚æ•°<code>-select_streams</code>æ¥é€‰æ‹©æŸä¸€ç§æµåª’ä½“ï¼Œå†åœ¨åé¢æ·»åŠ ä¸€ä¸ª<code>v</code>æˆ–è€…<code>a</code>ã€‚å‰è€…ä»£è¡¨æ˜¯videoï¼Œåè€…æ˜¯audio<ul>
<li>è§†é¢‘æµçš„æ•°æ®ï¼Œè¿™é‡Œä¼šåˆ—å‡ºå½“å‰æµåª’ä½“ä¸­è§†é¢‘æµä¸­çš„ç¼–ç æ–¹å¼ç­‰ç­‰æ•°æ®<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;streams&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;index&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prores&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;codec_long_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Apple ProRes (iCodec Pro)&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;profile&quot;</span><span class="punctuation">:</span> <span class="string">&quot;HQ&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;codec_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;video&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;codec_tag_string&quot;</span><span class="punctuation">:</span> <span class="string">&quot;apch&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;codec_tag&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x68637061&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;width&quot;</span><span class="punctuation">:</span> <span class="number">1920</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;height&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;coded_width&quot;</span><span class="punctuation">:</span> <span class="number">1920</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;coded_height&quot;</span><span class="punctuation">:</span> <span class="number">1080</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;closed_captions&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;film_grain&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;has_b_frames&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;sample_aspect_ratio&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1:1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;display_aspect_ratio&quot;</span><span class="punctuation">:</span> <span class="string">&quot;16:9&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;pix_fmt&quot;</span><span class="punctuation">:</span> <span class="string">&quot;yuv422p10le&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;level&quot;</span><span class="punctuation">:</span> <span class="number">-99</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;color_range&quot;</span><span class="punctuation">:</span> <span class="string">&quot;tv&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;field_order&quot;</span><span class="punctuation">:</span> <span class="string">&quot;progressive&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;refs&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0x1&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;r_frame_rate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30000/1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;avg_frame_rate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;30000/1001&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;time_base&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1/30000&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;start_pts&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;duration_ts&quot;</span><span class="punctuation">:</span> <span class="number">150150</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.005000&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;bit_rate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;229589904&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;bits_per_raw_sample&quot;</span><span class="punctuation">:</span> <span class="string">&quot;10&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;nb_frames&quot;</span><span class="punctuation">:</span> <span class="string">&quot;150&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;disposition&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;default&quot;</span><span class="punctuation">:</span> <span class="number">1</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;dub&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;original&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;comment&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;lyrics&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;karaoke&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;forced&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;hearing_impaired&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;visual_impaired&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;clean_effects&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;attached_pic&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;timed_thumbnails&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;captions&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;descriptions&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;metadata&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;dependent&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;still_image&quot;</span><span class="punctuation">:</span> <span class="number">0</span></span><br><span class="line">          <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">              <span class="attr">&quot;language&quot;</span><span class="punctuation">:</span> <span class="string">&quot;eng&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;handler_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;VideoHandler&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;vendor_id&quot;</span><span class="punctuation">:</span> <span class="string">&quot;FFMP&quot;</span><span class="punctuation">,</span></span><br><span class="line">              <span class="attr">&quot;encoder&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lavc58.91.100 prores_ks&quot;</span></span><br><span class="line">          <span class="punctuation">&#125;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
<li>å¦‚æœæˆ‘ä»¬æƒ³è¿‡æ»¤ä¸€äº›åªæœ‰æˆ‘ä»¬å…³å¿ƒçš„æ•°æ®ï¼Œå¯ä»¥ä½¿ç”¨<code>-show_entries stream=codec_name,codec_type,duration</code>ï¼Œæ¥é€‰æ‹©æˆ‘ä»¬æƒ³è¦çš„æ•°æ®ï¼Œè¿™æ ·è¿”å›çš„æ•°æ®å°±ä¼šæ¯”è¾ƒç®€æ´<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;programs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"></span><br><span class="line">  <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;streams&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">      <span class="punctuation">&#123;</span></span><br><span class="line">          <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;prores&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;codec_type&quot;</span><span class="punctuation">:</span> <span class="string">&quot;video&quot;</span><span class="punctuation">,</span></span><br><span class="line">          <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.005000&quot;</span></span><br><span class="line">      <span class="punctuation">&#125;</span></span><br><span class="line">  <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
<h4 id="ffmpeg"><a href="#ffmpeg" class="headerlink" title="ffmpeg"></a>ffmpeg</h4><p>&amp;nbsp;&amp;nbsp;&amp;nbsp;&amp;nbsp;ffmpegåº”è¯¥æ¥è¯´æ˜¯è¿™ä¸ªé‡Œé¢BOSSäº†ï¼Œèƒ½å¹²çš„äº‹æƒ…ç®€ç›´æ˜¯å¤ªå¤šäº†ï¼Œæ¯”å¦‚è¯´è½¬æ¢æ ¼å¼ï¼Œå‰ªè¾‘è§†é¢‘ï¼Œåˆå¹¶è§†é¢‘ï¼Œæ·»åŠ è§†é¢‘çš„overlayï¼Œæ›¿æ¢æµåª’ä½“çš„éŸ³é¢‘ï¼Œæ“ä½œéŸ³é¢‘ï¼ˆåˆå¹¶å£°é“ï¼Œä¿®æ”¹å£°é“ï¼‰ï¼Œç”Ÿæˆplaybackæ–‡ä»¶ç­‰ç­‰</p>
<ul>
<li>è½¬æ¢æ ¼å¼å°±æ˜¯ffmpegéå¸¸åŸºç¡€çš„æŠ€èƒ½äº†ï¼Œ<code>ffmpeg -v error -y -i &lt;input source path&gt; &lt;output file name&gt;.mp4</code>ã€‚ä»¥ä¸‹çš„åœºæ™¯æ˜¯æˆ‘ä»¬åœ¨ç½‘ç»œä¸Šä¸‹è½½äº†ä¸€æ®µè§†é¢‘ï¼Œæ‰©å±•åæ˜¯<code>mkv</code>ã€‚è¿™ä¸ªæ˜¾ç„¶æ˜¯æ— æ³•åœ¨Macç›´æ¥æ’­æ”¾çš„<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">    <span class="attr">&quot;programs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line"></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;streams&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">        <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;h264&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;codec_long_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;H.264 / AVC / MPEG-4 AVC / MPEG-4 part 10&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">    <span class="attr">&quot;format&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">        <span class="attr">&quot;filename&quot;</span><span class="punctuation">:</span> <span class="string">&quot;test.mkv&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nb_streams&quot;</span><span class="punctuation">:</span> <span class="number">2</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;nb_programs&quot;</span><span class="punctuation">:</span> <span class="number">0</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;matroska,webm&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;format_long_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Matroska / WebM&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;start_time&quot;</span><span class="punctuation">:</span> <span class="string">&quot;0.000000&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;duration&quot;</span><span class="punctuation">:</span> <span class="string">&quot;5.016000&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;size&quot;</span><span class="punctuation">:</span> <span class="string">&quot;1941253&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;bit_rate&quot;</span><span class="punctuation">:</span> <span class="string">&quot;3096097&quot;</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;probe_score&quot;</span><span class="punctuation">:</span> <span class="number">100</span><span class="punctuation">,</span></span><br><span class="line">        <span class="attr">&quot;tags&quot;</span><span class="punctuation">:</span> <span class="punctuation">&#123;</span></span><br><span class="line">            <span class="attr">&quot;COMPATIBLE_BRANDS&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qt  &quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MAJOR_BRAND&quot;</span><span class="punctuation">:</span> <span class="string">&quot;qt  &quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;MINOR_VERSION&quot;</span><span class="punctuation">:</span> <span class="string">&quot;512&quot;</span><span class="punctuation">,</span></span><br><span class="line">            <span class="attr">&quot;ENCODER&quot;</span><span class="punctuation">:</span> <span class="string">&quot;Lavf59.16.100&quot;</span></span><br><span class="line">        <span class="punctuation">&#125;</span></span><br><span class="line">    <span class="punctuation">&#125;</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
æˆ‘ä»¬æ¥ä½¿ç”¨ffmpegçš„è½¬æ¢æŠ€èƒ½ï¼ŒæŠŠ<code>mkv</code>æ ¼å¼çš„æ–‡ä»¶è½¬æ¢æˆ<code>mov</code>, <code>ffmpeg -v error -y -i test.mkv  test.mov</code>ï¼Œè¿™é‡Œä¸ç”¨æŒ‡å®šæµçš„ç¼–ç æ–¹å¼ï¼Œå› ä¸ºåœ¨è½¬æ¢çš„è¿‡ç¨‹ä¸­ä¼šè®¾å®šé»˜è®¤çš„åˆé€‚çš„codecæ–¹æ³•ï¼Œç­‰ä¸Šä¸€ä¼šï¼Œè§†é¢‘å°±æ˜¯è½¬å¥½äº†ã€‚å½“æˆ‘ç‚¹å‡»çš„æ—¶å€™ç»™æˆ‘æ¥äº†ä¸ªè¿™ä¸ª<img width="100" alt="image" src="https://user-images.githubusercontent.com/6279298/213137069-6b427048-435f-4f68-a81f-3f2fd6401974.png">ï¼Œæ‰“å¼€æ˜¯èƒ½æ‰“å¼€ï¼Œä½†æ˜¯çœ‹ä¸äº†è§†é¢‘ï¼Œåªé—»å…¶å£°ä¸è§å…¶äººã€‚æˆ‘ç”¨ffprobeåˆ†æäº†ä¸€ä¸‹streamçš„æ•°æ®ï¼Œå‘ç°codecçš„æ–¹å¼h264ï¼Œquicktimeæ˜¯ä¸æ”¯æŒçš„ã€‚<br>è¿™æ—¶æˆ‘æ·»åŠ äº†ä¸€ä¸ªå‚æ•°<code>ffmpeg -v error -y -i test.mkv  -vcodec prores test.mov</code>ã€‚è¿™æ³¢æ“ä½œï¼ŒOKäº†ï¼Œå¯ä»¥æ‰“å¼€äº†</p><br>&amp;#8194;&amp;#8194;&amp;#8194;&amp;#8194;è¿™æ—¶åˆæœ‰ç»†å¿ƒçš„æœ‹å‹å‘ç°äº†äº›å•¥ï¼Œä¸ºå•¥åŒæ ·è§†é¢‘åªæ˜¯ç»è¿‡äº†ä¸€æ¬¡è½¬æ¢ï¼Œå¤§å°ç›¸å·®è¿™ä¹ˆå¤§<img width="200" alt="image" src="https://user-images.githubusercontent.com/6279298/213139598-262c3a73-3881-42a8-92c2-e2a1e0279bda.png">ã€‚å…·ä½“åŸå› æ˜¯å•¥å‘¢ï¼Œæˆ‘å†ç”¨ffprobeåˆ†æä¸€æ³¢ã€‚åŸæ¥æ˜¯å› ä¸º<code>bitrate</code>ç›¸å·®äº†å¾ˆå¤šå“¦ï¼Œè¿™ç©æ„å°±æ˜¯ç”¨æ¥å†³å®šè§†é¢‘çš„æ¸…æ™°åº¦çš„ã€‚æŸ¥äº†ä¸€ä¸‹æ–‡æ¡£ï¼ŒåŸæ¥ffmpegåœ¨ä¸è®¾å®šbitrateçš„æ—¶å€™ï¼Œä¸ºäº†åŠ å¿«è½¬æ¢é€Ÿåº¦è‡ªå·±åˆè‡ªä½œä¸»å¼ çš„åŠ äº†ç‚¹æˆï¼Œå‡å°‘äº†ä¸€äº›bitrateã€‚<img width="1031" alt="image" src="https://user-images.githubusercontent.com/6279298/213140159-19c49e5d-72a3-4b9e-85ca-a1bf2d6bd7c1.png">
&#8194;&#8194;&#8194;&#8194;é‚£å¦‚æœæˆ‘æƒ³ä¿æŒåŸæ¥çš„å¤§å°è¯¥æ€ä¹ˆåŠå‘¢ï¼Ÿè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨`two-pass`çš„æ–¹å¼æ¥è®¾ç½®æƒ³è¦è½¬æ¢çš„è§†é¢‘çš„bitrateçš„å¤§å°
<figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -v error -y -i test.mkv -vcodec prores -b:v 4M -pass 1 -f null /dev/null</span><br><span class="line">&amp;&amp; ffmpeg -v error -y -i test.mkv -vcodec prores -b:v 4M -pass 2 test.mov</span><br></pre></td></tr></table></figure></li>
</ul>
<h2 id="å¿ƒå¾—"><a href="#å¿ƒå¾—" class="headerlink" title="å¿ƒå¾—"></a>å¿ƒå¾—</h2><p>&amp;#8194;&amp;#8194;&amp;#8194;&amp;#8194;æ•…äº‹è®²åˆ°è¿™é‡Œï¼Œç®—æ˜¯å·²ç»éƒ½è®²å®Œäº†ï¼Œä¹Ÿå®ç°äº†åœ¨Macä¸Šç›´æ¥æ’­æ”¾çš„æ„¿æœ›ã€‚å…¶å®åœ¨å­¦ä¹ ffmpegçš„è¿‡ç¨‹ä¸­è¿˜æ˜¯äº†è§£åˆ°äº†å¾ˆå¤šå›¾åƒç›¸å…³çš„æ¦‚å¿µçš„ï¼Œåœ¨è¿™é‡Œæˆ‘åªæ˜¯ä»‹ç»äº†ffmpegå†°å±±ä¸€è§’çš„èƒ½åŠ›ã€‚å½“ç„¶åœ¨å­¦ä¹ çš„è¿‡ç¨‹ä¸­ä¹Ÿè¶Šé‡åˆ°ä¸€äº›è‡ªå·±ä¸€çŸ¥åŠè§£çš„é—®é¢˜ï¼Œå¦‚æœå¤§å®¶æœ‰ç›¸å…³ç»éªŒå¯ä»¥ä¸€å—äº¤æµå•Šã€‚</p>
<p>&amp;#8194;&amp;#8194;&amp;#8194;&amp;#8194;<font size=5><strong>æœ€å</strong></font>é¢„ç¥å¤§å®¶<font size=6 color=red face="å¾®è½¯é›…é»‘"><strong>æ–°</strong></font><font size=4 color=yellow face="å¾®è½¯é›…é»‘"><strong>å¹´</strong></font><font size=5 color=green face="å¾®è½¯é›…é»‘"><strong>å¿«</strong></font><font size=8 color=pink face="å¾®è½¯é›…é»‘"><strong>ä¹</strong></font> <font size=4><strong>!!!</strong></font></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/ffmpeg-simple-convert/" data-id="cleuv5r3p00048whsffyw2c6p" data-title="ffmpeg_simple_convert" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ffmpeg-coverting-format/" rel="tag">ffmpeg, coverting format</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-ffmpeg_basic_concept" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/ffmpeg_basic_concept/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:56:02.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/ffmpeg_basic_concept/">ffmpeg_basic_concept</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ffmpeg-java-demo"><a href="#ffmpeg-java-demo" class="headerlink" title="ffmpeg java demo"></a>ffmpeg java demo</h1><ul>
<li>What is ffmpeg</li>
<li>High frequency using library<ul>
<li>libavcodec, contains all encoders and decoders, which is used to encode or decode the resource you input</li>
<li>libavformat, deal with the <font color=red><strong>muxers</strong></font> or <font color=red><strong>demuxers</strong></font> for various container. container is a file which is used to save your video, audio streams, and anyclose <font color=red size=3 font=black>what is muxer and demuxer in pic?</font></li>
<li>libavfilter, used to modify audio or video</li>
<li>libavdevice, used to support different input and output devices</li>
<li>libavutil,</li>
<li>libwscale,</li>
<li>libswreasample</li>
</ul>
</li>
<li>ffmpeg package tools<ul>
<li>ffmpeg, itself is a command line tool which is used to process the video or audio resource</li>
<li>ffplay, which is a minimal video player, you can use it play a large wide of video format</li>
<li>ffprobe, which is used to extract video or audio information</li>
</ul>
</li>
</ul>
<h2 id="Media-Concepts"><a href="#Media-Concepts" class="headerlink" title="Media Concepts"></a>Media Concepts</h2><ul>
<li>image<ul>
<li>pixel, is a 2D point, has color RGB or YUV, alpha value transparency</li>
<li>resolution, the quality of the image of the number of pixel of the image</li>
<li>Aspect Ratio, the radio of the width and height</li>
</ul>
</li>
<li>Audio<ul>
<li>smallest digital representation of a sound</li>
<li>8&#x2F;16&#x2F;24&#x2F;32 bit value, more bits means high quality video source</li>
<li>audio frequency, how many samples during the per second, the higher, the higher quality</li>
<li>audio channel, which means that several audios will be played together<ul>
<li>for example, one audio channel is named â€˜Monoâ€™, two is named â€˜Stereoâ€™ and both of them are called <code>channel layouts</code></li>
</ul>
</li>
<li>audio track, organize different audio channels<ul>
<li>for example, an audio can obtain multilingual channel, an English channel or a French chanel, and also it can take a background chanel, some of them can be mixed</li>
</ul>
</li>
</ul>
</li>
<li>Video<ul>
<li>sequence of images, has the time duration, Each image is called a frame</li>
<li>Video frame rate(FPS), Frame per second</li>
<li>video compression, not very clear about the concept? remove redundant information, Spatial redundancy (<strong>within frame</strong>), Temporal redundancy (<strong>across frame</strong>). <font color=red><strong>How to make it?</strong></font></li>
</ul>
</li>
<li>Codec &amp; Container<br><img src="https://user-images.githubusercontent.com/96409339/206092175-0a9d1d2c-a173-4407-93a8-7b1e4b306db2.png" alt="the overview of Codec and Container"><ul>
<li>Codec<ul>
<li>encode, because video is a very big file, if we transfer it directly, which is an impractical idea. and decode is used to play the video</li>
<li>some encode algorithm<ul>
<li>video, H.264, H.265, VP9, Prores, DNxHd,</li>
<li>audio, PCM, AAC, MP3</li>
<li>the benefits of different codec algorithm</li>
</ul>
</li>
</ul>
</li>
<li>Container<ul>
<li>use to package or wrapper a media file</li>
<li>format<ul>
<li>video, MP4, MXF, QT&#x2F;MOV, MKV</li>
<li>audio, WAV, M4A</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Transcoding<ul>
<li>transfer one codec to another one</li>
<li>why we need transcode, because it depends on different situation, sometimes, we need take care of quality, being smaller during the transporting in the internet</li>
<li>using scenario<ul>
<li>Transmuxing, From one container to another</li>
<li>thumbnail generation, preview image, search hit, hover-scrubbing on the web page, poster frame</li>
<li>Frame rate conversion<ul>
<li>support different TV standards</li>
<li>higher FPS: preserve slow motion quality for editing</li>
<li>lower FPS: playback or streaming</li>
</ul>
</li>
<li>Bitrate conversion<ul>
<li>quality the higher bitrate the higher quality</li>
<li>smaller storage space</li>
<li>support different network bandwidth</li>
</ul>
</li>
<li>change GOP size<ul>
<li>good for editing based on I-frame (keyframe) only, ä¿æŒä¸€ä¸ªå…³é”®å¸§ï¼Œç„¶åå¯ä»¥ç»§ç»­æ“ä½œï¼Œå°±å¯ä»¥å¾—åˆ°åŠ¨ç”»</li>
<li>good for compression and streaming based on long GOP</li>
</ul>
</li>
<li>overlay<ul>
<li>logo â€¦.</li>
</ul>
</li>
<li>subtitle&#x2F;capture</li>
<li>timecode</li>
<li>covert video resolution</li>
<li>Audio volume adjustment</li>
<li>Audio mixing eg: mix the person speaking voice and the background voice</li>
<li>audio resampling, changing the frequency</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="How-to-setup-it"><a href="#How-to-setup-it" class="headerlink" title="How to setup it?"></a>How to setup it?</h2><ul>
<li>how to get it?<ul>
<li>No official builds</li>
<li>Build from source code, download it from <code>github</code> repo</li>
<li>Download Pre-build packages, Use package management tool, like <code>homebrew</code> and <code>APT</code></li>
</ul>
</li>
<li>support OS<ul>
<li>macOS <code>brew install ffmpeg</code></li>
<li>linux </li>
<li>Windows</li>
</ul>
</li>
</ul>
<h2 id="How-to-use-its-sub-component-tool"><a href="#How-to-use-its-sub-component-tool" class="headerlink" title="How to use its sub-component tool"></a>How to use its sub-component tool</h2><ul>
<li>ffprobe<ul>
<li>When you install the ffmpeg in brew, you can use ffmpeg, ffmprobe or ffmplay directly. For the part, you will use ffmprobe to analyze the video or audio resource.</li>
<li>Input the following command, <code>ffprobe xxxx.mp4</code>, you will get the following result with log.<img width="1293" alt="image" src="https://user-images.githubusercontent.com/96409339/205582566-4f4bdc33-242e-4884-ad27-8b68c20fc433.png">
* If you don't need any log, you can input the following command, `ffprobe -v error bunny_1080p_60fps.mp4 -show_format`, you will retrieve the whole video format details
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line">[FORMAT]</span><br><span class="line">filename=bunny_1080p_60fps.mp4</span><br><span class="line">nb_streams=3</span><br><span class="line">nb_programs=0</span><br><span class="line">format_name=mov,mp4,m4a,3gp,3g2,mj2</span><br><span class="line">format_long_name=QuickTime / MOV</span><br><span class="line">start_time=0.000000</span><br><span class="line">duration=634.533333</span><br><span class="line">size=355856562</span><br><span class="line">bit_rate=4486529</span><br><span class="line">probe_score=100</span><br><span class="line">TAG:major_brand=isom</span><br><span class="line">TAG:minor_version=1</span><br><span class="line">TAG:compatible_brands=isomavc1</span><br><span class="line">TAG:creation_time=2013-12-16T17:59:32.000000Z</span><br><span class="line">TAG:title=Big Buck Bunny, Sunflower version</span><br><span class="line">TAG:artist=Blender Foundation 2008, Janus Bager Kristensen 2013</span><br><span class="line">TAG:comment=Creative Commons Attribution 3.0 - http://bbb3d.renderfarming.net</span><br><span class="line">TAG:genre=Animation</span><br><span class="line">TAG:composer=Sacha Goedegebure</span><br><span class="line">[/FORMAT]</span><br></pre></td></tr></table></figure>
* If you want to know the details of the stream, you can input `ffprobe -v error bunny_1080p_60fps.mp4 -show_format -show_streams`
  * with parameter `-print_format`, you can only <font color=red size=3>**format**</font> output csv or json
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">   <span class="attr">&quot;programs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">   <span class="attr">&quot;streams&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;h264&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;mp3&quot;</span></span><br><span class="line">   <span class="punctuation">&#125;</span><span class="punctuation">,</span></span><br><span class="line">   <span class="punctuation">&#123;</span></span><br><span class="line">      <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;ac3&quot;</span><span class="punctuation">,</span></span><br><span class="line">      <span class="attr">&quot;side_data_list&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line">   <span class="punctuation">&#125;</span></span><br><span class="line"> <span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
  * with parameter  `-show_stream -select-streams v`, only output video stream
  <figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span></span><br><span class="line">  <span class="attr">&quot;programs&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">]</span><span class="punctuation">,</span></span><br><span class="line">  <span class="attr">&quot;streams&quot;</span><span class="punctuation">:</span> <span class="punctuation">[</span><span class="punctuation">&#123;</span></span><br><span class="line">     <span class="attr">&quot;codec_name&quot;</span><span class="punctuation">:</span> <span class="string">&quot;h264&quot;</span><span class="punctuation">&#125;</span><span class="punctuation">]</span></span><br><span class="line"><span class="punctuation">&#125;</span></span><br></pre></td></tr></table></figure>
  * with parameter `-show_entries stream=codec_name`, only output codec name, you might need to remove the other parameters like `-show_stream` or `-show_format`
  * with parameter `-print_format default=noprint_wrappers=1`, remove outside tag
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">codec_name=h264</span><br><span class="line">codec_name=mp3</span><br><span class="line">codec_name=ac3</span><br></pre></td></tr></table></figure>
  * with parameter `-print_format default=noprint_wrappers=1:nokey=1`, you can get the only value without key
  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">h264</span><br><span class="line">mp3</span><br><span class="line">ac3</span><br></pre></td></tr></table></figure>
  * You can analyze the stream information by URL directly without downloading it to loacl machine
  `ffprobe -v error <http url link>`
* [more details, www.ffmpeg.org/ffprobe.html](https://www.ffmpeg.org/ffprobe.html)</li>
</ul>
</li>
<li>ffplay<ul>
<li>with the parameter <code>-x , -y</code>, you can control the size of the video window</li>
<li>with the parameter <code>-noborder</code>, you can remove the border of the video window</li>
<li>with the parameter <code>-top -left</code>, you can control the position of the video window</li>
<li>with the parameter <code>-fs</code>, you can get the full screen video window</li>
<li>with the parameter <code>-an</code>, you can disable the audio</li>
<li>with the parameter <code>vn</code>, you can disable the video<ul>
<li>tips, you can press key <code>W</code> to switch the show-mode</li>
</ul>
</li>
<li>with the parameter <code>-showmode waves</code>, you can get the video wave</li>
<li>with the parameter <code>-loop &lt;times&gt;</code>, you can get looping video</li>
<li>with pressing key <code>S</code>, you can step through the frames of a video one frame at a time</li>
</ul>
</li>
<li>ffmpeg<ul>
<li>overview of how to edit media<br><img src="https://user-images.githubusercontent.com/96409339/206382829-5b872ed9-97a5-4b17-88c6-eae1c76651e4.png" alt="overview"></li>
<li>details<ul>
<li>input &amp; output<ul>
<li><code>ffmpeg -i &lt;protocol&gt;:&lt;device&gt;</code>, file is default, you also can choose the network pattern, like http, ftp, rtp etc.</li>
<li>according to the above processing, you can run the following command like <code>ffmpeg -i input.mov ...add some filter... output.mp4</code></li>
<li>with the parameter, <code>-f extension</code>, you can do the muxing or demux use the command. During the input process, it was used to demux. During the output process, it was used to mux.<ul>
<li><code>ffmpeg -i input.mov ... -f ... output.extension</code></li>
</ul>
</li>
<li>with parameter <code>pipe:0</code>, donâ€™t know very well</li>
<li>capture, I guess this can be used to record screen;<ul>
<li><code>ffmpeg -f avfoundation -list_devices true -i &quot;&quot;</code> list the useful device in the current machine</li>
<li>screen<ul>
<li><code>ffmpeg -f avfoundation -i &quot;:1&quot; ....</code></li>
</ul>
</li>
<li>audio (microphone)<ul>
<li><code>ffmpeg -f avfoundation -i &quot;:2&quot; ....</code></li>
</ul>
</li>
<li>webcam<ul>
<li><code>ffmpeg -f avfoundation -i &quot;default&quot; ....</code></li>
</ul>
</li>
</ul>
</li>
<li>testing<ul>
<li><code>ffmpeg -f lavfi -i color=color=red...</code>, <strong>lavfi</strong> is a virtual space</li>
</ul>
</li>
</ul>
</li>
<li>stream selection<br><img src="https://user-images.githubusercontent.com/96409339/206649881-25b41eed-9089-408e-a477-1daebf2695be.png" alt="the example of streams in container"> <ul>
<li>For one container, generally speaking, it includes one video stream and one more audios streams</li>
<li>how to select a stream, <input-index>:<stream-type>:<stream-index>, these three inputs will control the stream you want to select.</li>
<li><code>ffmpeg -v error -y -i bunny_1080p_60fps.mp4 -to 1 bunny_1080p_60fps-1s.mp4</code>, the command is used to edit a video<ul>
<li><code>-y</code> override the file anyway</li>
<li><code>-to</code> cut the video until 1 second</li>
<li>For default, ffmpeg only picks up one video and one audio<ul>
<li>get all, with parameter <code>-map 0</code></li>
<li>get video, with parameter <code>-map 0:v</code></li>
<li>get audio, with parameter <code>-map 0:a</code></li>
<li>get first audio, with parameter <code>-map 0:a:0</code></li>
</ul>
</li>
</ul>
</li>
<li>You also can process multiple data together, integration some video, layout(logo), audio together<ul>
<li><code>ffmpeg -v error -y -i bunny_1080p_60fps.mp4 -i bullfinch.mov -to 1 -map 0:v:0 -map 1:a:0 bunny_1080p_60fps-1s-mix.mp4</code></li>
</ul>
</li>
</ul>
</li>
<li>filter<ul>
<li>do some change for the media, the common library is <code>libavfilter</code></li>
<li>syntax, filter&#x3D;key1&#x3D;values:key2&#x3D;value2<ul>
<li>eg: scale filter scale&#x3D;width&#x3D;1920:height&#x3D;1080<ul>
<li>different filter labels are used <code>; [semicolon sign]</code> to split each others. <font color=red size=3>In my opinion, I think that semicolon sign is used to do the textual separation, which the filter is more readable.</font></li>
<li>for one filter with multiple options, using <code>: [colon sign]</code> to split each other </li>
<li>using comma <code>,</code> to split the different filter</li>
</ul>
</li>
</ul>
</li>
<li>it can be labeled, which can be referred for later option</li>
<li>filter graph<ul>
<li>with param <code>-vf</code> process graphs with <strong>single</strong> input and output, especially operate video resource</li>
<li>eg: <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -v error -i &lt;medida name with extension&gt; -vf</span><br><span class="line">  &quot;split[bg][ol]; // split the media with the same two parts</span><br><span class="line">  [bg]scale=width=1920:height=1080,format=gray[bg_output];</span><br><span class="line">  [ol]scale=-1:480,hflip[ol_output];</span><br><span class="line">  [bg_output][ol_output]overlay=x=W-w:y=(H-h)/2&quot; &lt;ouput file &gt; // combine two outputs togther.</span><br></pre></td></tr></table></figure></li>
<li>with param <code>-filter-complex</code>, you can manipulate all the streams, like video, audio and picture.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg -v error -y -i bullfinch.mov -i logo.png -filter_complex </span><br><span class="line">&quot;[1:v]scale=-1:200[s_logo];</span><br><span class="line">[0:v][s_logo]overlay=x=W-w-50:y=H-h-50,split=2[sd_in][hd_in];</span><br><span class="line">[sd_in]scale=-2:480[sd];[hd_in]scale=-2:1080[hd]&quot;</span><br><span class="line">-map \[sd\] bully-sd.mp4 -map \[hd\] bully-hd.mp4</span><br></pre></td></tr></table></figure>
<ul>
<li>tips: If you want to use it in <font color=red><strong>zsh</strong></font>, you should add escape symbol before the special character, like <code>&#39;[&#39;, &#39;]&#39;</code></li>
</ul>
</li>
<li>with param <code>-af</code>, you can do some editions on audio stream <strong>only for one</strong> input and output</li>
<li>common filter<ul>
<li>scale, one input and one output</li>
<li>split, one input and multiple output</li>
<li>overlay, multiple input and one output</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>encoding<ul>
<li>what is kind of thing should we take into consideration? <ul>
<li>compression</li>
<li>quality vs size</li>
<li>stream vs <em>post-production</em></li>
<li>target application</li>
<li>compatibility, check the codec is supported by the container</li>
</ul>
</li>
<li>converting<ul>
<li>If you want to transfer one container to another and donâ€™t set the specific codec method, ffmpeg will set a default codec (suitable one).<ul>
<li>eg: <code>ffmpeg -v error -y -i bullfinch.mov transcoded.mxf</code></li>
<li>with parameter, <code>-vcodec &lt;codec name&gt;</code> to set specific video codec method<ul>
<li><code>ffmpeg -encoders</code>, list all the useful codec method</li>
</ul>
</li>
<li>with parameter <code>-avodec</code>, set the specific audio codec method</li>
</ul>
</li>
<li>detail of AVC short for advanced video codec, H.264<ul>
<li>codec library: libx264</li>
<li>profile, baseline, main, high, it is optional</li>
<li>Rate control (edit the bitrate, effect the video quality)<ul>
<li>with parameter <code>-crf</code> </li>
<li>CRF: constant quality, variable bitrate, focus on high quality crf 0-51, the higher, the worse quality </li>
<li>Two-pass ABR, this is a quantitative option, with parameter <code>-b:v 2M</code>, which means that the bitrate is set as 2Mbps<ul>
<li>tips, it cannot give you very accurate bitrate, therefore you can use two pass method. like <code>-b:v 2M -pass 1 -f null /dev/null</code>, then <code>-b:v 2M -pass 2 filename</code>. The result of the first step will be saved into the statics</li>
</ul>
</li>
<li>preset, which is used to control the speed of compression, the quicker, the bigger compression file you get</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Streaming<ul>
<li>Basic Concept<ul>
<li>The device connect to the internet, then you can get the media resource from the internet transportation, rather than download the media directly. This process can be called as streaming.</li>
<li>And the streaming can be consumed without any waiting just watch it directly when your device connects to the internet<br><img src="https://user-images.githubusercontent.com/6279298/207742871-faf39080-f180-445b-b10d-eb4f73df3f54.png" alt="overview of the streaming get or provide"></li>
<li>Streaming playback, it is a mechanism for keep a comfortable watching experience.<ul>
<li>Playable instantly, without downloading the whole media files</li>
<li>Seekable, when you choose the different timeline, the media can be played based on the correct timeline rather than play it from the start</li>
<li>Adaptive, based on different network situation (<font size=3 color=red>adaptive streaming bitrate, how to make it? not only the network situation, but also the player window size</font>)<ul>
<li>In my opinion, it will start with a file extended with <code>m3u8</code>. Actually, the following playable videos are separated very small parts whose format is <code>ts</code>. When the network becomes worse, it will retrieve some low bitrate media resource until the network turn to the good situation.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Streaming protocol<ul>
<li>different protocol is suitable to different situations, some are applicable to ingest, some are for distribution.<ul>
<li>RTMP<ul>
<li>real-time-messaging protocol</li>
<li>based on TCP</li>
<li>low latency</li>
<li>stop updating, so not support to latest codec method</li>
<li>required flash plugin</li>
<li>is popular to live-streaming ingest</li>
</ul>
</li>
<li>HTTP<ul>
<li>widest reach</li>
<li>TCP based</li>
<li>unlikely to be blocked anywhere</li>
<li>support its native player <code>HTML5 video</code>, no need to add extra plugin, like flash</li>
<li>native support HLS and MPEG-DASH adaptive method</li>
<li>good at distribution, not widely used to ingest</li>
</ul>
</li>
<li>SRT<ul>
<li>secure reliable transport</li>
<li>based on UDP based</li>
<li>faster than RTMP</li>
<li>cannot support any browsers, because its based on UDP, but itâ€™s extremely applicable to ingest streaming</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Progressive Download<ul>
<li>The progressive download method downloads and caches video on the viewerâ€™s device. A short period of time is required to buffer and cache the beginning of the media file before it starts playing</li>
<li>single-file media<ul>
<li>advantage<ul>
<li>Not segmented</li>
<li>Easier to handle</li>
<li>native browser support</li>
<li>copy and download easily, you can send the whole file to other services</li>
</ul>
</li>
</ul>
</li>
<li>container formats<ul>
<li>MP4, WebM, Ogg, these formats are supported by native browser</li>
</ul>
</li>
<li>The index<ul>
<li>Itâ€™s used to look up the media data of a time aor frame, just like a table or a map to save the media information</li>
<li>It will be written into the end of the mp4 file</li>
<li>Similar to Apple player format (QuickTime, MOV)</li>
<li>the data will get some hierarchical sections, the section are atom&#x2F;box, atom will be set into the stream during the codec period<br><img src="https://user-images.githubusercontent.com/6279298/208073595-5d752c26-a57a-4b2c-a9f0-1f691431aff9.png" alt="what is the atom"><br><img src="https://user-images.githubusercontent.com/6279298/208075202-567b91f5-7b32-4472-b825-e8e89446d1b5.png" alt="the category of atoms"></li>
</ul>
</li>
<li>fast-started<ul>
<li><img src="https://user-images.githubusercontent.com/6279298/208084190-41a02855-edb8-4644-b2af-4399edb8563f.png" alt="fast-started structure"></li>
<li>This will let the video be played gradually rather than download the whole file once time</li>
<li>with command <code>ffmpeg -v trace -i &lt;video name&gt;</code>, you can get the verbose information</li>
<li>pick atom <code>ffmpeg -v trace -i fast-start.mp4 2&gt;&amp;1 | grep -e type:\&#39;mdat\&#39; -e type:\&#39;moov\&#39;</code></li>
<li>convert to a fast-started media <code> ffmpeg -i fast-start.mp4 -movflags +faststart -c copy test-fast-started.mp4</code><ul>
<li>option <code>-movflag</code></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Adaptive Streaming<ul>
<li>Sometime, the outside condition is changeable, for single-quality media, it just only has one quality, single resolution, bitrate choice</li>
<li>adaptive resolution, different screen size the stream will choose some related stream. But if the screen resolution is greater than the low standard resolution and less than the high standard resolution, it will still use the higher one, take the 560p as an example, the play will still play the 720p media.</li>
<li><font color=red>ffmpeg can do it?</font></li>
<li>how it work<ul>
<li>adaptive streaming solution<ul>
<li>HLS, http live streaming<ul>
<li>codec (H.264 avc H.265 havc) </li>
<li>container (TS, fMP4, Fragmented MP4)</li>
<li>manifest<ul>
<li>m3u8 <ul>
<li>master playlist is used to point the media playlist</li>
<li>media playlist list the individual the segments of ts file in sequence</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>DASH, dynamic adaptive streaming over http<ul>
<li>MPEG-DASH (mp4) </li>
<li>codec freedom, H.264, H.265, VP9, etc. </li>
<li>container only fMP4</li>
<li>manifest (mdp, media presentation description, format is <code>xml</code>)</li>
</ul>
</li>
<li>common characteristics<ul>
<li>both can split media into several small segments</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>the facts need to consider when encoding the media to adaptive streaming <ul>
<li>frame type</li>
<li><img src="https://user-images.githubusercontent.com/6279298/209314973-8a7aa325-a305-42de-957a-ef14fd9966fe.png" alt="concept of frame"></li>
<li>What is the self-contained in GOPs</li>
</ul>
</li>
<li>how to use ffmpeg to convert the media into HLS or DASH<ul>
<li>HLS, TS, A+V, the format of playlist is <code>m3u8</code> and the segment is <code>ts</code><ul>
<li>&#96;&#96;&#96;yaml<br>  ffmpeg -y -i bunny_1080p_60fps.mp4 -to 10 <br>  -filter_complex â€œ[0:v]fps&#x3D;30,split&#x3D;3[720_in][480_in][240_in];[720_in]scale&#x3D;-2:720[720_out];[480_in]scale&#x3D;-2:480[480_out];[240_in]scale&#x3D;-2:240[240_out]â€ <br>  -map [720_out] -map [480_out] -map [240_out] -map 0:a -map 0:a -map 0:a <br>  -b:v:0 3500k -maxrate:v:0 3500k -bufsize:v:0 3500k <br>  -b:v:1 1690k -maxrate:v:1 1690k -bufsize:v:1 1690k <br>  -b:v:2 326k -maxrate:v:2 326k -bufsize:v:2 326k <br>  -b:a:0 128k <br>  -b:a:1 96k <br>  -b:a:2 64k <br>  -x264-params â€œkeyint&#x3D;60:min-keyint&#x3D;60:scenecut&#x3D;0â€ <br>  -var_stream_map â€œv:0,a:0,name:720-4M v:1,a:1,name:480-2M v:2,a:2,name:240p-500kâ€ <br>  -hls_time 2 <br>  -hls_list_size 0 <br>  -hls_segment_filename adaptive-%v-%03d.ts <br>  -master_pl_name adaptive.m3u8 <br>  adaptive-%v.m3u8 <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><span class="line">          * `-b:v:0` is used to select the video stream and set the average bitrate, like `-b:v:0 128k`;</span><br><span class="line">          * `-bufsize` is used to check the average bitrate in this set value. eg: `-bufsize 128k`, During each 128k media transmission, ffmpeg will calculate the current average bitrate</span><br><span class="line">            * if the smaller value is set, the frequency of checking bitrate will be too high. Otherwise, it will take a long duration</span><br><span class="line">            * Generally speaking, it can set the same as the video average bitrate or even the half of it</span><br><span class="line">          * `-maxrate` is used to limit the max transmission bitrate. eg: Your max bandwidth is **1024kb/s**, and assuming you can totally use this bandwidth, audio will use 128k/s (this audio is stereo, 64k per channel), therefore, only 896k/s you can use, so you should set this value as your **maxrate**</span><br><span class="line">          * references</span><br><span class="line">            * [What does -bufsize do?](https://trac.ffmpeg.org/wiki/Limiting%20the%20output%20bitrate)</span><br><span class="line">            * [Encoding for streaming sites](https://trac.ffmpeg.org/wiki/EncodingForStreamingSites)</span><br><span class="line">        * HLS, TS separate the audio and video, only single audio stream, will have itself playlist manifest</span><br><span class="line">        * HLS, fMP4</span><br><span class="line">        * DASH, fMP4</span><br><span class="line">        * HLS+DASH, fMP4</span><br><span class="line">          * ![HLS DASH mixed pattern](https://user-images.githubusercontent.com/6279298/210923276-23ba054e-eec4-4120-9ac0-403ee39494b7.png) </span><br><span class="line">          * ```yaml</span><br><span class="line">            ffmpeg -y -i bullfinch.mov -to 10 \                                </span><br><span class="line">             -filter_complex &quot;[0:v]fps=30,split=3[720_in][480_in][240_in];[720_in]scale=-2:720[720_out];[480_in]scale=-2:480[480_out];[240_in]scale=-2:240[240_out]&quot; \</span><br><span class="line">             -map \[720_out\] -map \[480_out\] -map \[240_out\] -map 0:a \</span><br><span class="line">             -b:v:0 3500k -maxrate:v:0 3500k -bufsize:v:0 3500k \</span><br><span class="line">             -b:v:1 1690k -maxrate:v:1 1690k -bufsize:v:1 1690k \</span><br><span class="line">             -b:v:2 326k -maxrate:v:2 326k -bufsize:v:2 326k \</span><br><span class="line">             -b:a:2 128k \</span><br><span class="line">             -x264-params &quot;keyint=60:min-keyint=60:scenecut=0&quot; \</span><br><span class="line">             -hls_playlist 1 \</span><br><span class="line">             -hls_master_name adaptive.m3u8 \</span><br><span class="line">             -seg_duration 2 \</span><br><span class="line">             adaptive.mpd  </span><br><span class="line">            ```     </span><br><span class="line">* example of manipulate video</span><br><span class="line">  * Trimming</span><br><span class="line">    * `ffmpeg -y -v error -i nature.mp4 -ss 00:03:55 -to 240 bear.mp4`</span><br><span class="line">      * `-v [flags+]loglevel` set the processing log error verbose</span><br><span class="line">      * `-ss` set up the start second</span><br><span class="line">      * `-to` set up the total duration</span><br><span class="line">      * `-t` set up the segment duration, take the above command as an example, if you want to achieve the same behavior, you can use `-ss 00:03:55 -t 5`</span><br><span class="line">  * Merge</span><br><span class="line">    * define a list file</span><br><span class="line">      * ```text</span><br><span class="line">        file &#x27;bear.mp4&#x27;</span><br><span class="line">        file &#x27;flower.mp4&#x27;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li><code>ffmpeg -y -v error -f concat -i list.txt merge.mp4</code></li>
</ul>
</li>
<li>Thumbnail<ul>
<li><code>ffmpeg -v error -i bullfinch.mov -vframes 1 bullfinch-poster-image.jpg</code><ul>
<li><code>-vframes</code> set up the number of frames</li>
<li>You also can use filter during this processing, by the following command<ul>
<li><code>ffmpeg -v error -i bullfinch.mov -vframes 1 -vf scale=320:180 bullfinch-poster-image-thumbnail.jpg</code></li>
</ul>
</li>
<li>if you donâ€™t want to output the first frame as the thumbnail, you can add the <code>-ss</code> before the <code>-vframes</code></li>
<li>If you want to output multiple frame pictures, you can run the following command<ul>
<li><code>ffmpeg -v error -i bullfinch.mov  -vf fps=1,scale=320:180 bullfinch-thumbnail-%02d.jpg</code></li>
<li><code>-%02d</code> is a template syntax, which can be used to generate multiple file</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>Scaling<ul>
<li>resize the media or photo resource<ul>
<li><code>-vf scale=-2:480</code>, <strong>minus two</strong> means we want to keep the aspect ratio</li>
<li>force original aspect ratio option, <code>force_original_aspect_ratio</code></li>
<li>If you can want to keep the desired window size, you can add the <a target="_blank" rel="noopener" href="https://ffmpeg.org/ffmpeg-all.html#Examples-140">pad option</a>: <code>pad=640:480:(ow-iw)/2:(oh-oh)/2</code>, with this option, you can output the video in the desired bound box.</li>
</ul>
</li>
</ul>
</li>
<li><a target="_blank" rel="noopener" href="https://ffmpeg.org/ffmpeg-all.html#Examples-139">Overlay</a><ul>
<li><code>ffmpeg -v error -y -i (video) -i (pic) -filter_complex &quot;overlay&quot; output_file.extension</code></li>
<li>adjust the transparency of the overlay <code>-filter_complex &quot;[1:v]colorchannelmixer=aa=0.4[transparent_log];[0:v][transparent_log]overlay&quot;</code><ul>
<li><code>aa</code> Adjust contribution of input red, green, blue and alpha channels for output alpha channel. Default is 1 for aa, and 0 for ar, ag and ab.</li>
</ul>
</li>
<li>multiple overlay, overlay the video with logo at first, then set a label to them. Overlaying the previous output and the third input video</li>
</ul>
</li>
<li>Drawing text and or timeCode<ul>
<li>fixed text when play<ul>
<li><code>ffplay bullfinch.mov -v error -an -vf &quot;drawtext=text=Bird&quot;</code><ul>
<li><img src="https://user-images.githubusercontent.com/6279298/211193197-b5472769-c6da-4b7a-8758-a0c4ca25849e.png" alt="fixed draw text"></li>
</ul>
</li>
<li>with parameter <code>x</code> and <code>y</code>, you can adjust its position, like <code>ffplay bullfinch.mov -v error -an -vf &quot;drawtext=fontfile=Example.ttf:text=Bird:x=(w-text_w)/2:y=(h-text_h)/2:fontsize=60&quot;</code><ul>
<li><img src="https://user-images.githubusercontent.com/6279298/211193438-39bdde10-ab6f-45d9-85ba-a531bc880a8a.png" alt="Screen Shot 2023-01-08 at 7 22 05 PM"></li>
</ul>
</li>
</ul>
</li>
<li>moving text when play<ul>
<li>with parameter <code>t</code> which represents the time, if you want the text from the top to the center you can use the following command:<ul>
<li><code>y=t*50</code></li>
<li>Generally speaking, If you want to move the text from the right to the left, you can add the parameter <code>x=(w-text_w)/2-100*t</code></li>
</ul>
</li>
</ul>
</li>
<li>add time code<ul>
<li>default<ul>
<li><code>ffplay bullfinch.mov -v error -an -vf &quot;drawtext=fontfile=Example.ttf:text=Bird:x=(w-text_w)/2:y=(h-text_h)/2:fontsize=60:timecode=&#39;00\:00\:00\:00&#39;:rate=&#39;24000/1001&#39;</code></li>
</ul>
</li>
<li>with boxColor<ul>
<li><code>:box=1: boxcolor=red@0.2</code></li>
<li><img src="https://user-images.githubusercontent.com/6279298/211194118-45ede122-c2b4-49c7-92e7-28342c21644b.png" alt="time code with color box"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>example of manipulation audio<ul>
<li>extract channels<ul>
<li>some channels play the voice, and some channels play the background music<ul>
<li>with filter <code>amerge=inputs=2</code>, you can merge the whole stream to a one stream with multiple channels</li>
<li>with the following command you can split the whole stream into different files <code>ffmpeg -v error -y -i two-stereo-tracks.m4a -filter_complex &quot;amerge=inputs=2,asplit=4[all0][all1][all2][all3];[all0]pan=mono|c0=c0[ch0];[all1]pan=mono|c0=c1[ch1];[all2]pan=mono|c0=c2[ch2];[all3]pan=mono|c0=c3[ch3]&quot; -map \[ch0\] ch0.m4a -map \[ch1\] ch1.m4a -map \[ch2\] ch2.m4a -map \[ch3\] ch3.m4a</code><ul>
<li>with the filter <code>asplit</code> like <code>[in] asplit=&lt;output number&gt; [out0][out1][out2]</code>, you can get number of output</li>
<li>with the filter <a target="_blank" rel="noopener" href="https://www.ffmpeg.org/ffmpeg-all.html#pan-1"><code>pan</code></a>, you can manipulate the audio</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>mix channels<ul>
<li>with <code>ffmpeg -v error -y -i ch0.m4a -i ch1.m4a -i ch2.m4a -i ch3.m4a -filter_complex &quot;amerge=inputs=4&quot; mix_four_in_one_channel.m4a</code></li>
<li>with the filter <code>amix=inputs=&lt;number of input&gt;</code>, it can work, but the mixed audio will drop down the volume</li>
<li>with <code>&quot;amerge=inputs=4,pan=mono|c0=c0+c1+c2+c3&quot;</code>, you can avoid this issue</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/ffmpeg_basic_concept/" data-id="cleuv5r3p00058whsfmh6a7fr" data-title="ffmpeg_basic_concept" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ffmpeg/" rel="tag">ffmpeg</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-es-local-tests" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/es-local-tests/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:53:56.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/es-local-tests/">es_local_tests</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Elastic-Search-Integration-test"><a href="#Elastic-Search-Integration-test" class="headerlink" title="Elastic Search Integration test"></a>Elastic Search Integration test</h1><ul>
<li>What is the Elastic Search Engine<br><img src="https://user-images.githubusercontent.com/6279298/195224811-1137dceb-8857-4d3f-87fc-27cbb5768299.png" alt="some core definition of ES"></li>
<li>How to run local elastic search<ul>
<li>run docker cmd <figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9200:9200 \</span><br><span class="line">-e &quot;discovery.type=single-node&quot; \</span><br><span class="line">docker.elastic.co/elasticsearch/elasticsearch:7.8.0</span><br></pre></td></tr></table></figure></li>
<li>check es healthy status <code>http://localhost:9200</code></li>
</ul>
</li>
<li>How to integrate ES in spring boot project<ul>
<li>add maven dependency<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.springframework.data<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>spring-data-elasticsearch<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.0.0.RELEASE<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>query methods<ul>
<li>ElasticSearchRestTemplate<ul>
<li>add <strong>ES</strong> configuration class, add a java bean to instantiate an <code>ElasticsearchRestTemplate</code></li>
<li>autoWire <code>ElasticsearchRestTemplate</code></li>
<li>add <code>NativeSearchQueryBuilder</code> to build query conditions</li>
</ul>
</li>
<li>repository<ul>
<li>add new interface to implement <code>ElasticsearchRepository</code></li>
<li>add new index method to insert data into es, <strong>tip:</strong> search key-word should be included in the searched object</li>
<li>add <code>Document</code> annotation in operating object, which can wrapped the wanted mapping object</li>
</ul>
</li>
<li>high-level REST client<ul>
<li>add pom dependency<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&lt;dependency&gt;</span><br><span class="line">  &lt;groupId&gt;org.elasticsearch.client&lt;/groupId&gt;</span><br><span class="line">  &lt;artifactId&gt;elasticsearch-rest-high-level-client&lt;/artifactId&gt;</span><br><span class="line">  &lt;version&gt;7.17.6&lt;/version&gt;</span><br><span class="line">&lt;/dependency&gt;</span><br></pre></td></tr></table></figure></li>
<li>initialize rest high level client</li>
<li>use IndexRequest to build saving data<ul>
<li>types<ul>
<li>Json string directly, if you define an object at first, you can use <code>ObjectMapper</code> to execute mapper operation. </li>
<li><code>Map</code> document definition then framework will convert it to <code>Json format</code></li>
</ul>
</li>
<li>tips: If the id is fixed, the newly indexRequest will override the previous one.</li>
</ul>
</li>
<li>how to search data<ul>
<li>using <code>SearchRequest</code>, define index name, document type</li>
<li>build <code>SearchSourceBuilder</code>, set query item. </li>
<li>set the source of searchRequest by SearchSourceBuilder</li>
<li>using the following cmd to verify all data<figure class="highlight kotlin"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">curl -X GET <span class="string">&quot;localhost:9200/&lt;your index&gt;/_search?pretty&quot;</span> -H <span class="string">&#x27;Content-Type: application/json&#x27;</span> -d</span><br><span class="line">   <span class="string">&#x27;&#123;</span></span><br><span class="line"><span class="string">     &quot;query&quot;: &#123;</span></span><br><span class="line"><span class="string">        &quot;match_all&quot;: &#123;&#125;</span></span><br><span class="line"><span class="string">      &#125;</span></span><br><span class="line"><span class="string">    &#125;&#x27;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>migrate <code>HLRC</code> to <code>co.elastic.clients</code></li>
<li>Tips:<ul>
<li>Actually, if you donâ€™t set up configurations for connecting es, like port number, <code>ElasticsearchRestTemplate</code> has provided the DEFAULT value <strong>9200</strong></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>How to mock ES in spring boot integration test<ul>
<li>using docker to set up a real elastic search<ul>
<li>if you take the <code>ElasticsearchRepository</code> as your ES connector, you will start real elastic search in your local machine for test</li>
<li>step:<ul>
<li>step1: set up an es by docker<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">docker run -p 9200:9200 \</span><br><span class="line">-e &quot;discovery.type=single-node&quot; \</span><br><span class="line">docker.elastic.co/elasticsearch/elasticsearch:7.8.0</span><br></pre></td></tr></table></figure></li>
<li>instantiate <code>RestHighLevelClient</code> by annotation <code>@BeforeAll</code></li>
<li>set up <code>restTemplate</code></li>
<li>functional test class extends <code>BaseTestClass</code></li>
<li>write test in the specific test class and make assertions</li>
</ul>
</li>
</ul>
</li>
<li>using embedded elastic-search,<ul>
<li>embedded es cluster build flow<br>  <img src="https://user-images.githubusercontent.com/6279298/196337361-6cf41144-96d2-4667-a23e-2ce19a7d5818.png" alt="embedded-es-cluster"> </li>
<li>add dependency<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.codelibs<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-cluster-runner<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">version</span>&gt;</span>6.6.0.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line">      <span class="tag">&lt;<span class="name">scope</span>&gt;</span>test<span class="tag">&lt;/<span class="name">scope</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>build default JVM ES cluster by defining a static <code>ElasticsearchClusterRunner</code></li>
<li>define default <code>RestHighLevelClient</code> and set port number as <strong>9201</strong></li>
<li>tips: If you want update the version of <code>elasticsearch-cluster-runner</code>, you must take care of the rest-high-level-client using elasticsearch version.<br> <img src="https://user-images.githubusercontent.com/6279298/193168951-9144cee0-f9d5-4c98-bc20-9fd6a6f4328a.png" alt="keep the version elasticsearch version be same"></li>
</ul>
</li>
<li>using stub to mock elastic search server</li>
<li>using ESIntegTestCase<ul>
<li>Not good choiceâ€¦.</li>
</ul>
</li>
</ul>
</li>
<li>migration <code>rest-high-level-client</code> to <code>java-client</code><ul>
<li>motivation<ul>
<li>rest-high-level-client is deprecated since version 7.15.0, which means if you would want to use high level ES, the <code>rhlc</code> might take some incompatible problems.</li>
<li><code>rhlc</code> used http to transport data, while elastic-search-java-api used transport protocol to transport data.</li>
</ul>
</li>
<li>distinguish between the <code>rhlc</code> and <code>elasitc search java api</code></li>
<li>how to<ul>
<li>add new dependency<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>co.elastic.clients<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>elasticsearch-java<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>8.4.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>com.fasterxml.jackson.core<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jackson-databind<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.12.3<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>use the same rest client</li>
<li>set up compatibility mode by <code>.setApiCompatibilityMode(true)</code> for rest-high-level-client</li>
<li><strong>tips</strong><ul>
<li>if this <code>NoClassDefFoundError: jakarta/json/spi/JsonProvider</code> happens to application<br>you can add the following dependency<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>jakarta.json<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>jakarta.json-api<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">  <span class="tag">&lt;<span class="name">version</span>&gt;</span>2.0.1<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>if this <code>&#123; &quot;error&quot; : &quot;Content-Type header [application/x-www-form-urlencoded] is not supported&quot;, &quot;status&quot; : 406 &#125;</code> happens to application<br>you can add a default header<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">RestClient.builder(</span><br><span class="line">      <span class="keyword">new</span> <span class="title class_">HttpHost</span>(<span class="string">&quot;127.0.0.1&quot;</span>, <span class="number">9201</span>))</span><br><span class="line">      .setDefaultHeaders(<span class="keyword">new</span> <span class="title class_">Header</span>[]&#123;</span><br><span class="line">              <span class="keyword">new</span> <span class="title class_">BasicHeader</span>(<span class="string">&quot;Content-type&quot;</span>, <span class="string">&quot;application/json&quot;</span>)</span><br><span class="line">      &#125;)</span><br><span class="line">      .build();</span><br></pre></td></tr></table></figure></li>
<li>if you use the latest version elastic search, you might find out the following error:<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">[2022-02-18T15:50:30,235][WARN ][o.e.x.s.t.n.SecurityNetty4HttpServerTransport] [Yusufs-MBP.home] received plaintext http traffic on an https channel, closing connection Netty4HttpChannel&#123;localAddress=/127.0.0.1:9200, remoteAddress=/127.0.0.1:52260&#125;</span><br></pre></td></tr></table></figure>
you can define a custom elastic search docker image using custom <code>elasticsearch.yml</code> and close <code>xpack.security.enabled</code> and <code>xpack.security.http.ssl.enabled</code>.</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/es-local-tests/" data-id="cleuv5r3o00038whs2ixlg4x2" data-title="es_local_tests" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/elastic-search-java-test/" rel="tag">elastic search, java, test</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-easy-rule-demo" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/easy-rule-demo/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:50:50.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/easy-rule-demo/">easy_rule_demo</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="ä¼˜é›…çš„å®ç°ç­–ç•¥"><a href="#ä¼˜é›…çš„å®ç°ç­–ç•¥" class="headerlink" title="ä¼˜é›…çš„å®ç°ç­–ç•¥"></a>ä¼˜é›…çš„å®ç°ç­–ç•¥</h1><p><a href="#">é˜…è¯»æœ¬æ–‡å¤§çº¦10min</a></p>
<h2 id="ä»€ä¹ˆæ˜¯easy-rule"><a href="#ä»€ä¹ˆæ˜¯easy-rule" class="headerlink" title="ä»€ä¹ˆæ˜¯easy rule"></a>ä»€ä¹ˆæ˜¯easy rule</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/j-easy/easy-rules">easy rule</a> æ˜¯ä¸€ä¸ªrule engineå·¥å…·ï¼Œç”¨æ¥ä»£æ›¿å¤æ‚çš„<code>if</code> <code>else</code> blockï¼Œåœ¨ä»£ç ä¸­ä½¿å¾—ä¸šåŠ¡èƒ½å¤Ÿå¾—åˆ°æ›´å¥½çš„åˆ†ç¦»ï¼Œä»è€Œè®©ä»£ç èƒ½å¤Ÿæ›´å¥½çš„ä½¿ç”¨ç­–ç•¥æ¨¡å¼æ¥åˆ†ç¦»ä¸šåŠ¡</li>
<li><code>easy rule</code>é™¤äº†æ”¯æŒjavaä»¥å¤–è¿˜æ”¯æŒï¼Œ<code>Go</code>ï¼Œ<code>Groovy</code>ï¼Œ<code>C#</code> </li>
<li>æ›´å¤šå…³äºrule engineçš„detailsï¼Œç»™å¤§å®¶æ¨èä¸€ç¯‡è€é©¬çš„æ–‡ç« <a target="_blank" rel="noopener" href="https://martinfowler.com/bliki/RulesEngine.html">RulesEngine</a></li>
<li>ä¸ä¹‹ç›¸åŒçš„è¿˜æœ‰å¾ˆå¤šå…¶ä»–çš„java languageçš„rule engine<ul>
<li><a target="_blank" rel="noopener" href="https://www.drools.org/">Drool</a></li>
<li><a target="_blank" rel="noopener" href="https://openl-tablets.org/">OpenL Tablets</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/deliveredtechnologies/rulebook">RuleBook</a></li>
</ul>
</li>
</ul>
<h2 id="å¦‚ä½•ä½¿ç”¨easy-rule"><a href="#å¦‚ä½•ä½¿ç”¨easy-rule" class="headerlink" title="å¦‚ä½•ä½¿ç”¨easy rule"></a>å¦‚ä½•ä½¿ç”¨easy rule</h2><ul>
<li><font size=4><strong>å¦‚ä½•ç”¨ä¸åŒçš„æ–¹å¼åˆ›å»ºrule</strong></font><ul>
<li><font size=3><strong>ä»¥é¢å‘å¯¹è±¡çš„å½¢å¼(</strong><em>OO</em><strong>)</strong></font><ul>
<li>æ·»åŠ ä¾èµ–ï¼Œæ ¹æ®é¡¹ç›®è€Œå®šï¼Œ<code>maven</code>å’Œ<code>gradle</code>éƒ½æ”¯æŒï¼Œåœ¨æœ¬æ–‡ä¸­ä½¿ç”¨maven<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jeasy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easy-rules-core<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">    <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>åˆ›å»ºæŠ½è±¡ç±»<code>BasicTestRule</code>ç»§æ‰¿easyRuleä¸­çš„<code>BasicRule</code>, é‡è½½<code>evaluate()</code> &amp; <code>execute()</code>æ–¹æ³•ï¼Œå‰è€…ä¸ºäº†æ‰§è¡Œä¸åŒçš„ruleåŒ¹é…è§„åˆ™ï¼Œåè€…ä¸ºäº†è‡ªå®šä¹‰æ‰§è¡Œæ»¡è¶³æ¡ä»¶ä¹‹åçš„æ“ä½œï¼ŒğŸŒ° ï¼šæ‰“å°æŸäº›æ—¥å¿—ï¼Œæˆ–è€…æ”¹å˜åŸå…ˆçš„factsçš„å€¼ï¼›åœ¨ä»¥ä¸‹çš„ä¾‹å­ä¸­ï¼Œå°†å¯¹ä¼ å…¥çš„factsä¸è§„åˆ™åŒ¹é…ä¸Šçš„æ—¶å€™åœ¨é‡è½½çš„<code>execute()</code>æ–¹æ³•ä¸­æ‰§è¡Œäº†<code>setter</code><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">public</span> <span class="keyword">abstract</span> <span class="keyword">class</span> <span class="title class_">BasicTestRule</span> <span class="keyword">extends</span> <span class="title class_">BasicRule</span> &#123;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">public</span> <span class="title function_">BasicTestRule</span><span class="params">(<span class="keyword">final</span> String name, <span class="keyword">final</span> <span class="type">int</span> priority)</span> &#123;</span><br><span class="line">       <span class="built_in">super</span>(name, DEFAULT_DESCRIPTION, priority);</span><br><span class="line">   &#125;</span><br><span class="line">    </span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">abstract</span> <span class="type">boolean</span> <span class="title function_">hitCondition</span><span class="params">(<span class="keyword">final</span> RuleResult creatureFacts)</span>;</span><br><span class="line">   <span class="keyword">protected</span> <span class="keyword">abstract</span> String <span class="title function_">getType</span><span class="params">()</span>;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="type">boolean</span> <span class="title function_">evaluate</span><span class="params">(<span class="keyword">final</span> Facts facts)</span> &#123;</span><br><span class="line">       <span class="keyword">return</span> hitCondition(facts.get(FACTS));</span><br><span class="line">   &#125;</span><br><span class="line">   </span><br><span class="line">   <span class="meta">@Override</span></span><br><span class="line">   <span class="keyword">public</span> <span class="keyword">final</span> <span class="keyword">void</span> <span class="title function_">execute</span><span class="params">(<span class="keyword">final</span> Facts facts)</span> &#123;</span><br><span class="line">       <span class="type">RuleResult</span> <span class="variable">ruleResult</span> <span class="operator">=</span> facts.get(FACTS);</span><br><span class="line">       ruleResult.setResultType(String.format(<span class="string">&quot;The class is %s&quot;</span>, getType()));</span><br><span class="line">   &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>åœ¨ä»¥ä¸Šçš„ä¾‹å­ä¸­ï¼Œ<code>evaluate</code>å‡½æ•°æ˜¯æ”¾ç½®äº†ä¸€ä¸ª<strong>Condition</strong>å‡½æ•°<code>hitCondition()</code>ï¼Œä¸€æ—¦æ¡ä»¶ç¬¦åˆå°±ä¼šè¿”å›<code>TRUE</code>ï¼Œè¡¨æ˜è¯¥ruleè¢«åŒ¹é…</li>
</ul>
</li>
<li>å®šä¹‰æ»¡è¶³æ¡ä»¶çš„æŠ½è±¡å‡½æ•°<code>hitCondition</code>ï¼Œæ¯ä¸ªruleç»§æ‰¿Basicæ–¹æ³•çš„ä¹‹åï¼Œå®ç°<code>hitCondition</code>æ–¹æ³•ï¼Œä»¥demoä¸­çš„<code>PersonTestRule</code>ä¸­è¢«é‡è½½çš„å‡½æ•°ä¸ºä¾‹ï¼š <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> <span class="type">boolean</span> <span class="title function_">hitCondition</span><span class="params">(RuleResult creatureFacts)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Objects.equals(creatureFacts.getClassType(), <span class="built_in">this</span>.getClass().getSimpleName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<ul>
<li>å½“ä¼ å…¥çš„ factsçš„typeå’Œå½“å‰ç±»åä¸€è‡´æ—¶ï¼Œå°†ä¼šè¢«åŒ¹é…ä¸Šï¼Œå¹¶ä¸”åœ¨<code>BasicTestRule</code>ä¸­ï¼ŒåŒæ ·é‡è½½äº†easyRuleæä¾›çš„<code>execute()</code>ï¼Œå½“ruleè¢«åŒ¹é…ä¹‹åï¼Œå°†ä¼šæ‰§è¡Œè¯¥å‡½æ•°ã€‚åœ¨çˆ¶ç±»<code>BasicTestRule</code>ä¸­ï¼Œæä¾›äº†æŠ½è±¡æ–¹æ³•<code>getType()</code>ï¼Œåœ¨ä¸åŒçš„å­ç±»å‹ä¸­ä¼šè¿”å›è‡ªå·±ç±»çš„å…¨ç§°ï¼Œç„¶åè¢«çˆ¶ç±»ä¸­<code>execute()</code>è°ƒç”¨<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Override</span></span><br><span class="line"><span class="keyword">protected</span> String <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">    <span class="keyword">return</span> PersonTestRule.class.toString();</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><font size=3><strong>annotationçš„å½¢å¼</strong></font><ul>
<li>ç»™ç±»å®šä¹‰Ruleåç§°ï¼Œè¯¥æ³¨è§£å°†ä¼šæŠŠè¯¥ç±»æ ‡è®°æˆä¸€ä¸ªruleï¼Œæ ‡è®°ä¹‹åå¯ä»¥ç”¨ä¸Šè¿°æ­¥éª¤åœ¨Rulesä¸­æ³¨å†Œ</li>
</ul>
<p><code>@Rule(name = &quot;AnnotationTestRule&quot;, description = &quot;using annotation to match rule&quot;)</code></p>
<ul>
<li>å®šä¹‰ä¸€ä¸ª<code>Condition</code>æ³¨è§£çš„æ–¹æ³•ï¼Œè¿™é‡Œå®šä¹‰æ»¡è¶³æ¡ä»¶çš„æ ‡å‡†<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Condition</span></span><br><span class="line"> <span class="keyword">public</span> <span class="type">boolean</span> <span class="title function_">hitCondition</span><span class="params">(<span class="meta">@Fact(&quot;facts&quot;)</span> RuleResult ruleResult)</span> &#123;</span><br><span class="line">  <span class="keyword">return</span> Objects.equals(ruleResult.getClassType(), <span class="built_in">this</span>.getClass().getSimpleName());</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>å®šä¹‰ä¸€ä¸ª<code>Action</code>æ³¨è§£çš„æ–¹æ³•ï¼Œè¿™é‡Œå®šä¹‰å½“æ¡ä»¶æ»¡è¶³æ—¶çš„è¦åšçš„ä¸šåŠ¡<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"> <span class="meta">@Action</span></span><br><span class="line"> <span class="keyword">public</span> <span class="keyword">void</span> <span class="title function_">getType</span><span class="params">()</span> &#123;</span><br><span class="line">  System.out.println(AnnotationTestRule.class);</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
<li><font size=3><strong>Expressionçš„å½¢å¼å®šä¹‰rule</strong></font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Rule</span> <span class="variable">testRule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MVELRule</span>()</span><br><span class="line">            .name(<span class="string">&quot;Test Rule&quot;</span>)</span><br><span class="line">            .description(<span class="string">&quot;if class Type is `test`&quot;</span>)</span><br><span class="line">            .when(<span class="string">&quot;ruleResult.classType == &#x27;test&#x27;&quot;</span>)</span><br><span class="line">            .then(<span class="string">&quot;ruleResult.setResultType(&#x27;test&#x27;);&quot;</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆå§‹åŒ–<code>MVELRule</code>ï¼Œå®šä¹‰ruleçš„<code>name</code>ï¼Œ<code>description</code>ï¼Œè§¦å‘æ¡ä»¶<code>when</code>ï¼Œaction <code>then</code></li>
<li>tipsï¼Œå®šä¹‰Factsæ—¶éœ€è¦ä¿æŒkey valueå’Œè¡¨è¾¾å¼ä¸­æ“ä½œå¯¹è±¡çš„åç§°ä¸€è‡´<ul>
<li><code> facts.put(&quot;ruleResult&quot;, ruleResult);</code></li>
</ul>
</li>
</ul>
</li>
<li><font size=3><strong>fluent programmaticçš„å½¢å¼å®šä¹‰rule</strong></font><figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Rule</span> <span class="variable">rule</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RuleBuilder</span>()</span><br><span class="line">              .description(<span class="string">&quot;test&quot;</span>)</span><br><span class="line">              .name(<span class="string">&quot;checkAdult&quot;</span>)</span><br><span class="line">              .when(condition -&gt; &#123;</span><br><span class="line">                  <span class="type">RuleResult</span> <span class="variable">facts</span> <span class="operator">=</span> condition.get(<span class="string">&quot;facts&quot;</span>);</span><br><span class="line">                  <span class="keyword">return</span> facts.getClassType().equals(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">              &#125;)</span><br><span class="line">              .then(facts -&gt; &#123;</span><br><span class="line">                  <span class="type">RuleResult</span> <span class="variable">ruleResult</span> <span class="operator">=</span> facts.get(<span class="string">&quot;facts&quot;</span>);</span><br><span class="line">                  System.out.println(<span class="string">&quot;--------matches-------&quot;</span>);</span><br><span class="line">                  ruleResult.setResultType(<span class="string">&quot;test&quot;</span>);</span><br><span class="line">              &#125;)</span><br><span class="line">              .build();</span><br></pre></td></tr></table></figure>
<ul>
<li>åˆ›å»º<code>RuleBuilder</code>ï¼Œä»¥builderçš„å½¢å¼å®šä¹‰äº†Ruleçš„æè¿°<code>description</code>ï¼Œåç§°<code>name</code>ï¼Œæ¡ä»¶<code>when</code>ä»¥åŠæ»¡è¶³æ¡ä»¶ä¹‹åéœ€è¦æ‰§è¡Œçš„è¡Œä¸º<code>then</code></li>
</ul>
</li>
<li><font size=3><strong>rule ymlçš„å½¢å¼å®šä¹‰rule</strong></font><ul>
<li>å®šä¹‰ä¸€ä¸ªymlæ–‡ä»¶ï¼ŒåŒæ ·çš„ï¼Œ<code>MVELRuleFactory</code>ä¹Ÿæ”¯æŒ<code>json</code>æ ¼å¼çš„æ–‡ä»¶</li>
<li>åŠ å…¥ä¾èµ–<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="tag">&lt;<span class="name">dependency</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">groupId</span>&gt;</span>org.jeasy<span class="tag">&lt;/<span class="name">groupId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">artifactId</span>&gt;</span>easy-rules-mvel<span class="tag">&lt;/<span class="name">artifactId</span>&gt;</span></span><br><span class="line">   <span class="tag">&lt;<span class="name">version</span>&gt;</span>4.1.0<span class="tag">&lt;/<span class="name">version</span>&gt;</span></span><br><span class="line"><span class="tag">&lt;/<span class="name">dependency</span>&gt;</span></span><br></pre></td></tr></table></figure></li>
<li>ä½¿ç”¨fileReaderè¯»å–æ–‡ä»¶ï¼Œæ„é€ åˆ°<code>MVELRuleFactory</code>ä¸­<ul>
<li>é¦–å…ˆå…ˆå®šä¹‰ä¸€ä¸ªMVELRuleçš„Factoryï¼Œå…¥å‚æ˜¯ç”¨æ¥æ¥å—ruleæ–‡ä»¶çš„è§£ææ ¼å¼ï¼ŒeasyRuleæ”¯æŒ<code>yml</code>&amp;<code>json</code>ä¸¤ç§<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">private</span> <span class="type">MVELRuleFactory</span> <span class="variable">ruleFactory</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">MVELRuleFactory</span>(<span class="keyword">new</span> <span class="title class_">YamlRuleDefinitionReader</span>());</span><br><span class="line">```  </span><br><span class="line">* å¦‚æœåœ¨ä¸€ä¸ªymlæ–‡ä»¶ä¸­å®šä¹‰äº†å¤šä¸ªruleï¼Œä½¿ç”¨`createRules`ï¼Œå¦åˆ™ä½¿ç”¨`createRule`</span><br><span class="line">```java</span><br><span class="line"><span class="type">Rules</span> <span class="variable">multipleRules</span> <span class="operator">=</span> ruleFactory.createRules(<span class="keyword">new</span> <span class="title class_">InputStreamReader</span>(resourceAsStream));</span><br></pre></td></tr></table></figure></li>
<li><a target="_blank" rel="noopener" href="https://github.com/imona/tutorial/wiki/MVEL-Guide#foreach">MVELè¯­æ³•</a></li>
<li>å¦‚æœé‡åˆ°ä»¥ä¸‹çš„é”™è¯¯ <code>[Error: could not access field: org.zqf.easyruledemo.Person.age]</code><ul>
<li>æˆ‘çš„è§£å†³æ–¹æ³•æ˜¯å°†<code>Person</code>å˜æˆä¸€ä¸ªå…¬æœ‰çš„æ–¹æ³• <strong style="color:green">åŸå› æ˜¯æˆ‘å½“æ—¶ç¬¬ä¸€æ¬¡å†™çš„æ—¶å€™ï¼Œæ˜¯å°†<code>Person</code>å®šä¹‰åœ¨äº†å½“å‰çš„æµ‹è¯•ç±»ä¸­ï¼Œæ‰€ä»¥å½“å‰classçš„çº§åˆ«ä¸º<code>default</code>ï¼Œä½¿ç”¨çš„èŒƒå›´æ˜¯åœ¨å½“å‰åŒ…ä¸‹ã€‚ä½†æ˜¯å½“easy ruleçš„è¦ä½¿ç”¨personç±»ä¸­çš„æ–¹æ³•æ—¶ï¼Œå› ä¸ºæ²¡æœ‰åœ¨åŒä¸€ä¸ªåŒ…ä¸‹ï¼Œæ‰€ä»¥è®¿é—®ä¸äº†ã€‚</strong></li>
</ul>
</li>
</ul>
</li>
<li>ç¬¬ä¸€ä¸ªğŸŒ° æ˜¯åœ¨ä¸€ä¸ªymlæ–‡ä»¶ä¸­å®šä¹‰äº†å¤šä¸ªè§„åˆ™ï¼Œä½†æ˜¯æ¯ä¸€ä¸ªè§„åˆ™éƒ½æ˜¯ä¸€ä¸ªç®€å•è§„åˆ™ï¼Œä½¿ç”¨<code>---</code>åˆ†éš”<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">non</span> <span class="string">adult</span> <span class="string">rule</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">when</span> <span class="string">age</span> <span class="string">is</span> <span class="string">less</span> <span class="string">than</span> <span class="string">or</span> <span class="string">equal</span> <span class="number">18</span><span class="string">,</span> <span class="string">then</span> <span class="string">mark</span> <span class="string">as</span> <span class="string">non-adult</span></span><br><span class="line"><span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">condition:</span> <span class="string">&quot;person.age &lt;= 18&quot;</span></span><br><span class="line"><span class="attr">actions:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">&quot;person.setAdult(false);&quot;</span></span><br><span class="line"><span class="meta">---</span></span><br><span class="line"><span class="attr">name:</span> <span class="string">adult</span> <span class="string">rule</span></span><br><span class="line"><span class="attr">description:</span> <span class="string">when</span> <span class="string">age</span> <span class="string">is</span> <span class="string">greater</span> <span class="string">than</span> <span class="number">18</span><span class="string">,</span> <span class="string">then</span> <span class="string">mark</span> <span class="string">as</span> <span class="string">adult</span></span><br><span class="line"><span class="attr">priority:</span> <span class="number">2</span></span><br><span class="line"><span class="attr">condition:</span> <span class="string">&quot;person.age &gt; 18&quot;</span></span><br><span class="line"><span class="attr">actions:</span></span><br><span class="line"><span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><font size=2 color=red><strong>æ”¯æŒç»„åˆè§„åˆ™ï¼Œé€‚ç”¨äºè¾ƒä¸ºå¤æ‚çš„åœºæ™¯</strong></font><ul>
<li><code>UnitRuleGroup</code>ï¼Œåœ¨ymlä¸­å®šä¹‰<code>compositeRuleType</code>ä¸º<code>UnitRuleGroup</code>ï¼Œè¢«å®šä¹‰çš„è§„åˆ™éœ€è¦éƒ½è¢«åŒ¹é…ä¸Šæ‰èƒ½è¢«é€‰æ‹©ä¸Šï¼Œå¦‚æœæœ‰ä¸€ä¸ª<strong>å­è§„åˆ™</strong>æ²¡æœ‰åŒ¹é…ä¸Šï¼Œé‚£ä¹ˆç»“æœä»ç„¶ä¸ä¼šè¢«åŒ¹é…ï¼Œè¿™äº›è§„åˆ™å…·æœ‰<strong style="color:green">åŸå­æ€§</strong><figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">adult</span> <span class="string">check</span> <span class="string">composing</span> <span class="string">rule</span></span><br><span class="line"><span class="attr">ompositeRuleType:</span> <span class="string">UnitRuleGroup</span></span><br><span class="line"><span class="attr">riority:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">omposingRules:</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">adult</span></span><br><span class="line"> <span class="attr">description:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">age</span> <span class="string">is</span> <span class="string">more</span> <span class="string">than</span> <span class="number">18</span></span><br><span class="line"> <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">condition:</span> <span class="string">&quot;person.age &gt; 18&quot;</span></span><br><span class="line"> <span class="attr">actions:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br><span class="line"> <span class="attr">name:</span> <span class="string">foo-adult</span></span><br><span class="line"> <span class="attr">description:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">name</span> <span class="string">is</span> <span class="string">&#x27;foo&#x27;</span></span><br><span class="line"> <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">condition:</span> <span class="string">&quot;person.name == &#x27;foo&#x27;&quot;</span></span><br><span class="line"> <span class="attr">actions:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br></pre></td></tr></table></figure></li>
<li><code>ConditionalRuleGroup</code>ï¼Œä¸¾ä¸ªğŸŒ°ï¼šè¿™ç§groupç±»ä¼¼äºä¸€ç§ç»„åˆæ‹³ï¼Œæœ‰ä¸€ä¸ªè§„åˆ™å¿…é¡»å…ˆæ‰§è¡Œï¼Œç„¶åå†çœ‹æœ‰æ²¡æœ‰å…¶ä»–çš„è§„åˆ™èƒ½å¤ŸåŒ¹é…ä¸Šï¼Œå°±åƒç™»å½•ä¸€æ ·ï¼ŒéªŒè¯é€šè¿‡ä¹‹åï¼Œå†å»åšä¸€äº›å…¶ä»–çš„æ“ä½œ<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">adult</span> <span class="string">check</span> <span class="string">Condiftional</span> <span class="string">rule</span> <span class="string">Group</span></span><br><span class="line"><span class="attr">compositeRuleType:</span> <span class="string">ConditionalRuleGroup</span></span><br><span class="line"><span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line"><span class="attr">composingRules:</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adult</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">age</span> <span class="string">is</span> <span class="string">more</span> <span class="string">than</span> <span class="number">18</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">  <span class="attr">condition:</span> <span class="string">&quot;person.age &gt; 18&quot;</span></span><br><span class="line">  <span class="attr">actions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br><span class="line"><span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo-adult</span></span><br><span class="line">  <span class="attr">description:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">name</span> <span class="string">is</span> <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">  <span class="attr">priority:</span> <span class="number">2</span></span><br><span class="line">  <span class="attr">condition:</span> <span class="string">&quot;person.name == &#x27;foo&#x27;&quot;</span></span><br><span class="line">  <span class="attr">actions:</span></span><br><span class="line">  <span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br><span class="line"></span><br></pre></td></tr></table></figure>
<ul>
<li>tipsï¼Œ<code>ConditionalRuleGroup</code>å°†ä¼šæ£€æŸ¥<code>composingRules</code>ä¸­çš„ä¼˜å…ˆçº§ï¼Œå…¶ä¸­åªå…è®¸æœ‰ä¸€ä¸ª<code>priority=1</code>çš„<strong>å­è§„åˆ™</strong></li>
</ul>
</li>
<li><code>ActivationRuleGroup</code>ï¼Œåªä¼šæœ‰ä¸€ä¸ªå­è§„åˆ™åŒ¹é…ä¸Šï¼Œé‚£ä¹ˆå°±ä¼šå¿½ç•¥å…¶ä»–çš„è§„åˆ™ï¼Œç›´æ¥æ‰§è¡Œè¿™ä¸ªè¢«é€‰æ‹©ä¸Šçš„è§„åˆ™<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="attr">name:</span> <span class="string">adult</span> <span class="string">check</span> <span class="string">Condiftional</span> <span class="string">rule</span> <span class="string">Group</span></span><br><span class="line"> <span class="attr">compositeRuleType:</span> <span class="string">ActivationRuleGroup</span></span><br><span class="line"> <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line"> <span class="attr">composingRules:</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">adult</span></span><br><span class="line">   <span class="attr">description:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">age</span> <span class="string">is</span> <span class="string">more</span> <span class="string">than</span> <span class="number">18</span></span><br><span class="line">   <span class="attr">priority:</span> <span class="number">1</span></span><br><span class="line">   <span class="attr">condition:</span> <span class="string">&quot;person.age &gt; 18&quot;</span></span><br><span class="line">   <span class="attr">actions:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br><span class="line"> <span class="bullet">-</span> <span class="attr">name:</span> <span class="string">foo-adult</span></span><br><span class="line">   <span class="attr">description:</span> <span class="string">If</span> <span class="string">the</span> <span class="string">name</span> <span class="string">is</span> <span class="string">&#x27;foo&#x27;</span></span><br><span class="line">   <span class="attr">priority:</span> <span class="number">2</span></span><br><span class="line">   <span class="attr">condition:</span> <span class="string">&quot;person.name == &#x27;foo&#x27;&quot;</span></span><br><span class="line">   <span class="attr">actions:</span></span><br><span class="line">   <span class="bullet">-</span> <span class="string">&quot;person.setAdult(true);&quot;</span></span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li><font size=3><strong>å¯¹äº<code>spring boot</code>é¡¹ç›®ï¼Œå¯ä»¥ä½¿ç”¨æ³¨è§£çš„æ–¹å¼ï¼Œæ³¨å…¥Rules</strong></font><ul>
<li>å®šä¹‰ä¸€ä¸ªRuleçš„configuration classï¼Œå¯¹è¯¥ç±»ä½¿ç”¨æ³¨è§£<code>@Configuration</code>ï¼Œspring bootçš„beanå®¹å™¨å°±ä¼šåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œå°†å½“å‰çˆ¶ç±»<code>BasicVegetableRule</code>ä¸‹æ‰€æœ‰å­ç±»éƒ½åŠ è½½åˆ°å…¥å‚<code>basicVegetableRules</code>ä¸­ï¼Œå½“ç„¶å¦‚æœæƒ³è¦ä½¿ç”¨javaçš„beançš„ä¾¿åˆ©ï¼Œé‚£ä¹ˆå¯¹äºéœ€è¦åŠ è½½çš„å­ç±»ä¹Ÿéœ€è¦åŠ ä¸Šæ³¨è§£<code>@Component</code>ã€‚è¿™æ ·åœ¨spring booté¡¹ç›®å¯åŠ¨çš„æ—¶å€™å°±ä¼šå°†å…¶æ‰«æåˆ°è¿™ä¸ª<code>Set</code>ä¸­ã€‚<code>Rule</code>æ˜¯ä¸€ä¸ª<strong style='color:RED'>interface</strong>ï¼Œæ‰€ä»¥æ‰€æœ‰çš„å®ç°éƒ½å¯ä»¥è½¬æˆå…¶æœ¬èº«ã€‚<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Configuration</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">RuleBeans</span> &#123;</span><br><span class="line"><span class="meta">@Bean(&quot;BasicVegetableRule&quot;)</span></span><br><span class="line"><span class="keyword">public</span> Rules <span class="title function_">BasicVegetableRules</span><span class="params">(<span class="keyword">final</span> Set&lt;BasicVegetableRule&gt; basicVegetableRules)</span> &#123;</span><br><span class="line">   <span class="keyword">return</span> <span class="keyword">new</span> <span class="title class_">Rules</span>(basicVegetableRules.stream().map(Rule.class::cast).collect(Collectors.toSet()));</span><br><span class="line">  &#125;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="meta">@Component</span></span><br><span class="line"><span class="keyword">public</span> <span class="keyword">class</span> <span class="title class_">PotatoRule</span> <span class="keyword">extends</span> <span class="title class_">BasicVegetableRule</span> &#123;</span><br><span class="line">   xxxxx;</span><br><span class="line">&#125;</span><br></pre></td></tr></table></figure></li>
<li>åœ¨spring booté¡¹ç›®ä¸­ï¼Œæœ‰ä¸€äº›ä¸åŒçš„ä¸šåŠ¡åœºæ™¯ï¼Œå¯èƒ½éœ€è¦ç”¨åˆ°å¤§é‡çš„<code>if else</code>æ¥å®Œæˆä¸åŒçš„ä¸šåŠ¡åœºæ™¯ã€‚å°†è¿™äº›Componentåˆ©ç”¨Java beanåŠ è½½åˆ°Setå¯¹è±¡ä¸­ï¼Œå°†å…¶æ„é€ åˆ°<code>Rules</code>ï¼Œè¿›è€Œå¯ä»¥ç›´æ¥ä¼ å…¥ruleEngineä¸­å®Œæˆè§„åˆ™åŒ¹é…</li>
</ul>
</li>
</ul>
</li>
<li><font size=4><strong>å¦‚ä½•ä½¿ç”¨ruleEngine</strong></font><ul>
<li>å®šä¹‰RuleEngineï¼Œåˆå§‹åŒ–rule parameterå‚æ•°   <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">RulesEngineParameters</span> <span class="variable">parameters</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RulesEngineParameters</span>()</span><br><span class="line">                                 .skipOnFirstAppliedRule(<span class="literal">true</span>)</span><br><span class="line">                                 .skipOnFirstFailedRule(<span class="literal">false</span>)</span><br><span class="line">                                 .skipOnFirstNonTriggeredRule(<span class="literal">false</span>);</span><br></pre></td></tr></table></figure>
<ul>
<li><code>setSkipOnFirstAppliedRule</code>ï¼Œè¿™ä¸ªé…ç½®å†³å®šäº†æ˜¯å¦åŒ¹é…åˆ°ç¬¬ä¸€ä¸ªruleå°±ç›´æ¥è¿”å›äº†</li>
<li><code>isSkipOnFirstNonTriggeredRule</code>ï¼Œå½“ç¬¬ä¸€ä¸ªè§„åˆ™æ²¡æœ‰è¢«åŒ¹é…æˆåŠŸçš„æ—¶å€™ï¼Œå¦‚æœå½“å‰å€¼è®¾ç½®ä¸º<code>true</code>çš„æ—¶å€™ï¼Œå°†ä¸ä¼šæ‰§è¡Œå…¶ä»–çš„è§„åˆ™ï¼Œä¸€èˆ¬å¯ä»¥è®¾ç½®ä¸º<code>false</code>ï¼Œæˆ‘ç†è§£è¿™ä¸ªæ˜¯ç»™æœ€é«˜ä¼˜å…ˆçº§çš„è§„åˆ™åŒ¹é…ï¼Œå¦‚æœç¬¬ä¸€ä¸ªåŒ¹é…ä¸ä¸Šï¼Œä¸ç”¨å…³å¿ƒå…¶ä»–çš„è§„åˆ™</li>
<li><code>skipOnFirstFailedRule</code>ï¼Œå½“ç¬¬ä¸€ä¸ªåŒ¹é…åˆ°çš„è§„åˆ™å¤±è´¥çš„æ—¶å€™ï¼Œå°†ä¼šè¿”å›åŒ¹é…åˆ°çš„ä¸‹ä¸€ä¸ªè§„åˆ™</li>
</ul>
</li>
<li>åˆ›å»ºruleEngine <code>DefaultRulesEngine rulesEngine = new DefaultRulesEngine(parameters);</code></li>
<li>å®šä¹‰Ruleï¼Œå¹¶æ³¨å†Œrule<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Rules</span> <span class="variable">rules</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Rules</span>();</span><br><span class="line">rules.register(<span class="keyword">new</span> <span class="title class_">PersonTestRule</span>());</span><br></pre></td></tr></table></figure></li>
<li>å®šä¹‰Facts<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"><span class="type">Facts</span> <span class="variable">facts</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">Facts</span>();</span><br><span class="line"><span class="type">RuleResult</span> <span class="variable">ruleResult</span> <span class="operator">=</span> <span class="keyword">new</span> <span class="title class_">RuleResult</span>();</span><br><span class="line">ruleResult.setClassType(classType);</span><br><span class="line">facts.put(FACTS, ruleResult);</span><br></pre></td></tr></table></figure></li>
<li>æœ€åå®šä¹‰ä¸€ä¸ªé€šç”¨çš„æ–¹æ³•ï¼Œä½¿ç”¨RuleEngineçš„<code>fire</code>æ–¹æ³•ï¼Œæ¥è§¦å‘è§„åˆ™åŒ¹é…<br><code>rulesEngine.fire(rules, facts);</code></li>
</ul>
</li>
</ul>
<h2 id="ä¼˜ç¼ºç‚¹"><a href="#ä¼˜ç¼ºç‚¹" class="headerlink" title="ä¼˜ç¼ºç‚¹"></a>ä¼˜ç¼ºç‚¹</h2><ul>
<li>rule engineå¯ä»¥å°†å¤æ‚çš„ä¸šåŠ¡è§£è€¦ï¼Œä½¿æ¯ä¸ªç±»çš„èŒè´£æ›´å•ä¸€ï¼Œæ–¹ä¾¿ç»´æŠ¤ä¸åæœŸçš„æ‰©å±•</li>
<li>å¯¹äºè¾ƒä¸ºç®€å•çš„è§„åˆ™ï¼Œå› ä¸ºruleçš„ä¼˜å…ˆçº§ä¸åŒï¼Œä»¥åŠè¢«åˆ†æ•£åœ¨æ¯ä¸€ä¸ªç±»ä¸­ï¼Œè¿™æ ·å¯èƒ½ä¸å¦‚ä½¿ç”¨<code>if else</code>ç›´è§‚ï¼Œéœ€è¦æœ‰è¶³å¤Ÿçš„ä¸Šä¸‹æ–‡ï¼Œæ‰èƒ½å°†æ¯ä¸ªruleè”ç³»èµ·æ¥</li>
</ul>
<h2 id="Q-amp-A"><a href="#Q-amp-A" class="headerlink" title="Q&amp;A"></a>Q&amp;A</h2><ul>
<li>å¦‚æœä¸¤ä¸ªruleçš„ä¼˜å…ˆçº§ç›¸åŒï¼Œruleåœ¨Rulesçš„é¡ºåºæ˜¯ä»€ä¹ˆå‘¢ï¼Ÿ<ul>
<li><strong>answer</strong>ï¼šå½“ä¸¤ä¸ªruleçš„ä¼˜å…ˆçº§ç›¸åŒæ—¶ï¼ŒåŒ¹é…ruleçš„é¡ºåºä¼šä½¿ç”¨ruleçš„æ³¨å†Œé¡ºåºï¼Œåä¹‹ä½¿ç”¨ä¼˜å…ˆçº§(priority)æ’åº</li>
</ul>
</li>
</ul>
<h2 id="Demo"><a href="#Demo" class="headerlink" title="Demo"></a>Demo</h2><ul>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/tree/master/code/easyRule">éspring boot</a></li>
<li><a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/tree/master/code/easyruledemo">spring boot</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/easy-rule-demo/" data-id="cleuv5r3k00018whs1xtq3lp3" data-title="easy_rule_demo" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-design-pattern-easy-rule/" rel="tag">java, design-pattern, easy-rule</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-spring101" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/spring101/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:45:38.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/spring101/">spring101</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <ul>
<li>restful api</li>
<li>webflux<ul>
<li><strong><em>constructor injection to wire up dependencies and @ComponentScan to find beans</em></strong></li>
<li>using webflux router to build controller</li>
</ul>
</li>
<li>junit.jupiter<ul>
<li>webTestClient using as a test server client</li>
<li>clientAndServer mock dependent client</li>
</ul>
</li>
<li>maven<ul>
<li>mvn spring-boot:run compile and run my application by mvn</li>
</ul>
</li>
<li>@Value<ul>
<li>need to care about the injection sequence.<ul>
<li><a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/25764459/spring-boot-application-properties-value-not-populating">https://stackoverflow.com/questions/25764459/spring-boot-application-properties-value-not-populating</a></li>
</ul>
</li>
</ul>
</li>
<li>plantuml<ul>
<li>Archimate-PlantUML<ul>
<li><a target="_blank" rel="noopener" href="https://github.com/plantuml-stdlib/Archimate-PlantUML">https://github.com/plantuml-stdlib/Archimate-PlantUML</a></li>
</ul>
</li>
</ul>
</li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/spring101/" data-id="cleuv5r3s000b8whs1mf2a1qk" data-title="spring101" class="article-share-link">Share</a>
      
      
      
    </footer>
  </div>
  
</article>



  
    <article id="post-integration-auth0-in-spring-boot" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/integration-auth0-in-spring-boot/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:44:09.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/integration-auth0-in-spring-boot/">integration_auth0_in_spring-boot</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h1 id="Auth0-In-Spring-Boot"><a href="#Auth0-In-Spring-Boot" class="headerlink" title="Auth0 In Spring-Boot"></a>Auth0 In Spring-Boot</h1><h2 id="What-is-auth0"><a href="#What-is-auth0" class="headerlink" title="What is auth0?"></a>What is auth0?</h2><ul>
<li>Auth0 is a open-source service for providing authentication and authorization.</li>
<li>You can create a auth0 application on the auth0 server, then it will generate clientId and client secret to you.</li>
<li>Then you donâ€™t need to create any authentication or authorization business in your machine<br>which can cut the unnecessary cost.</li>
</ul>
<h2 id="How-to-use-auth0-in-spring-boot"><a href="#How-to-use-auth0-in-spring-boot" class="headerlink" title="How to use auth0 in spring-boot?"></a>How to use auth0 in spring-boot?</h2><ul>
<li>Firstly, you are supposed to create your auth0 application. <ul>
<li>applications-&gt;applications-&gt;choose the category -&gt; create application<br><img src="https://user-images.githubusercontent.com/6279298/164350380-e1c2fbb2-7e41-42c3-8ea4-0158c1b97f4b.png" alt="create new application"></li>
</ul>
</li>
<li>Secondly, you are supposed to create an application api to let your resource application can be protected<br><img src="https://user-images.githubusercontent.com/6279298/164351057-82118c2e-4e93-4287-8575-bd05b28e5d8d.png" alt="create new  api"></li>
<li>Thirdly, you can test the newly api for obtaining a token by curl cmd.<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">curl --request POST \</span><br><span class="line">--url â€˜&lt;DOMAIN&gt;/oauth/token&#x27; \</span><br><span class="line">--header &#x27;content-type: application/x-www-form-urlencoded&#x27; \</span><br><span class="line">--data grant_type=client_credentials \</span><br><span class="line">--data &#x27;client_id=YOUR_CLIENT_ID&#x27; \</span><br><span class="line">--data client_secret=YOUR_CLIENT_SECRET \</span><br><span class="line">--data audience=YOUR_API_IDENTIFIER</span><br></pre></td></tr></table></figure></li>
<li>Adding spring-boot dependency in your application<ul>
<li>add Oauth2 maven dependency</li>
<li>setup OAuth2 configuration<ul>
<li>set up the audience</li>
<li>set up the issuer-url</li>
</ul>
</li>
<li>add validator implements the OAuth2TokenValidator</li>
<li>configure api permission</li>
</ul>
</li>
</ul>
<h2 id="Tips"><a href="#Tips" class="headerlink" title="Tips:"></a>Tips:</h2><ul>
<li>If this occurs to you:<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line"><span class="punctuation">&#123;</span><span class="attr">&quot;error&quot;</span><span class="punctuation">:</span><span class="string">&quot;access_denied&quot;</span><span class="punctuation">,</span><span class="attr">&quot;error_description&quot;</span><span class="punctuation">:</span><span class="string">&quot;Client is not authorized to access \&quot;https://quickstarts/api\&quot;. You need to create a \&quot;client-grant\&quot; associated to this API. See: https://auth0.com/docs/api/v2#!/Client_Grants/post_client_grants&quot;</span><span class="punctuation">&#125;</span>%</span><br></pre></td></tr></table></figure></li>
<li>solution<ul>
<li>api should authorize the newly app.<br><img src="https://user-images.githubusercontent.com/6279298/164351811-db721670-2d43-4051-9b5f-429a3fc1be51.png"></li>
</ul>
</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/auth0-samples/auth0-spring-security5-api-sample/tree/master/01-Authorization-MVC/src">more details about how to use auth0 in spring-boot</a><br><a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/authbyzero">code source</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/integration-auth0-in-spring-boot/" data-id="cleuv5r3q00088whs94a49x5k" data-title="integration_auth0_in_spring-boot" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-spring-boot-auth0/" rel="tag">java, spring-boot, auth0</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-java-customer-starter" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/java-customer-starter/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T03:43:13.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/java-customer-starter/">java_customer_starter</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h2 id="ä¸ºä»€ä¹ˆè¦å¼€å‘-spring-starter"><a href="#ä¸ºä»€ä¹ˆè¦å¼€å‘-spring-starter" class="headerlink" title="ä¸ºä»€ä¹ˆè¦å¼€å‘ spring starter"></a>ä¸ºä»€ä¹ˆè¦å¼€å‘ spring starter</h2><ul>
<li><p>ä¸ºäº†ç†è§£ä¸ºä»€ä¹ˆæˆ‘ä»¬éœ€è¦å¼€å‘spring starterè¿™æ ·çš„ä¸€ä¸ªå·¥å…·ï¼Œä¸»è¦åŸå› è¿˜è¦ä»spring mvcå¼€å§‹è¯´èµ·ã€‚å› ä¸ºæ—©æœŸçš„MVCæ¡†æ¶ä¸­ï¼Œå¦‚æœè¦å¼•å…¥å…¶ä»–çš„ä¾èµ–ï¼Œéœ€è¦åœ¨é¡¹ç›®çš„xmlä¸­é…ç½®å¾ˆå¤šã€‚é‚£å¦‚æœä¾èµ–çš„çš„è¶Šå¤šï¼Œæˆ–è€…é¡¹ç›®çš„è¶Šå¤æ‚ï¼Œé‚£ä¹ˆåŠ å…¥çš„é…ç½®ä¹Ÿä¼šè¶Šå¤šï¼Œæœ€ç»ˆå¯¼è‡´æˆ‘ä»¬xmlæ–‡ä»¶ä¹Ÿä¼šéå¸¸çš„å¤æ‚ã€‚</p>
</li>
<li><p>å› ä¸ºæœ‰äº†ğŸ‘†ğŸ»çš„ç—›ç‚¹ä¹‹åï¼ŒspringåŠ å…¥äº†<strong>auto-configuration</strong>çš„æŠ€æœ¯</p>
<ul>
<li>ä»€ä¹ˆæ˜¯auto-configuration?<ul>
<li>å¯ä»¥æŠŠ<strong>classpath</strong>ä¸­çš„jaråŒ…è‡ªåŠ¨çš„å¯¼å…¥åœ¨JVMä¸­</li>
<li>éœ€è¦è¢«auto-configurationçš„ä¾èµ–éƒ½ä¼šè¢«åˆ—ä¸¾åœ¨<strong>spring.property</strong>æ–‡ä»¶ä¸­</li>
<li>ä½¿ç”¨æ³¨è§£<strong>AutoConfiguration</strong>æˆ–è€… <strong>SpringBootApplication</strong>åœ¨é¡¹ç›®ä¸­åŠ ä¸Šï¼Œå°±å¯ä»¥ä½¿ç”¨auto-configurationçš„ç‰¹æ€§</li>
<li>åœ¨pomæ–‡ä»¶ä¸­åŠ å…¥</li>
<li>&lt; dependency &gt;<br>&lt;groupId&gt;org.springframework.boot&lt;&#x2F;groupId&gt;<br>&lt;artifactId&gt;spring-boot-configuration-processor&lt;&#x2F;artifactId&gt;<br>&lt;optional&gt;true&lt;&#x2F;optional&gt;<br>&lt;&#x2F;dependency&gt;<ul>
<li><a target="_blank" rel="noopener" href="https://www.baeldung.com/intellij-resolve-spring-boot-configuration-properties">Cannot Resolve Spring Boot Configuration Properties Error</a></li>
<li>åŠ å…¥äº†ä¸Šè¿°ä¾èµ–ä¹‹åï¼Œæ²¡æœ‰é‡æ–°æ„å»ºçš„æ—¶å€™éƒ½ä¼šåœ¨target&#x2F;classes&#x2F;åˆ›å»ºâ€™META-INF&#x2F;â€˜</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h2 id="ä»€ä¹ˆæ˜¯spring-starter"><a href="#ä»€ä¹ˆæ˜¯spring-starter" class="headerlink" title="ä»€ä¹ˆæ˜¯spring starter"></a>ä»€ä¹ˆæ˜¯spring starter</h2><ul>
<li>starterå¯ä»¥åœ¨spring bootå¯åŠ¨çš„æ—¶å€™æŠŠä¸€äº›å¼€æºçš„èµ„æºæ–‡ä»¶æˆ–è€…ä¸€äº›é…ç½®æ–‡ä»¶æå‰åŠ è½½åˆ°java beanä¸­ï¼Œè¿™æ ·å°±å¯ä»¥é¿å…ä¸€äº›ä¾èµ–çš„é‡å¤å¼•å…¥</li>
<li>auto configuration class<ul>
<li>åœ¨resource&#x2F;META-INFæ–‡ä»¶ç›®å½•ä¸‹ï¼Œåˆ›å»ºä¸€ä¸ªæ–‡ä»¶<strong>spring.factories</strong>ï¼Œå½“spring bootå¯åŠ¨çš„æ—¶å€™ï¼ŒåŠ è½½spring.factoriesä¸­çš„åŒ…å«çš„å¯¹è±¡<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line"># Auto Configure</span><br><span class="line">org.springframework.boot.autoconfigure.EnableAutoConfiguration=\</span><br><span class="line">org.springframework.boot.autoconfigure.amqp.RabbitAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.cassandra.CassandraAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.mongo.MongoAutoConfiguration,\</span><br><span class="line">org.springframework.boot.autoconfigure.orm.jpa.HibernateJpaAutoConfiguration</span><br></pre></td></tr></table></figure></li>
<li>ä¸æ˜¯åŠ åˆ°äº†è¿™ä¸ªæ–‡ä»¶ä¸­ï¼Œå°±ä¼šéƒ½èƒ½å¤Ÿæ­£å¸¸ä½¿ç”¨ï¼Œåªæ˜¯spring bootåœ¨å¯åŠ¨çš„æ—¶å€™ï¼Œä¼šå°†è¿™äº›ç±»ï¼ˆä»¥åŠç›¸å…³çš„beansï¼‰åŠ è½½åˆ°java beanä¸­</li>
<li>è¿™äº›è¢«å¼•ç”¨çš„ç±»ï¼Œå°±å¯ä»¥è¢«å¼€ç®±å³ç”¨</li>
</ul>
</li>
<li>ä»application.propertyä¸­è£…è½½è‡ªå®šçš„å±æ€§<ul>
<li>ä½¿ç”¨æ³¨è§£**ConfigurationProperties(prefix &#x3D; â€œtimeoutâ€)**ï¼Œå…³è”javaç±»ä¸­çš„å±æ€§å’Œapplicationä¸­çš„å…³ç³»</li>
<li>ä½¿ç”¨æ³¨è§£<strong>Configuration</strong>å®šä¹‰java beanç±»å‹</li>
<li>åˆ›å»ºMATE-INFæ–‡ä»¶å¤¹ï¼Œå¹¶åœ¨åˆ›å»º<strong>additional-spring-configuration-metadata.json</strong>æ–‡ä»¶å®šä¹‰éœ€è¦è‡ªåŠ¨è£…è½½çš„propertyçš„åå­—</li>
</ul>
</li>
<li>å¦‚ä½•è‡ªå®šä¸€ä¸ªstarter<ul>
<li>å®šä¹‰è‡ªåŠ¨é…ç½®çš„æ¨¡å—</li>
<li>å°†éœ€è¦è‡ªåŠ¨åŒ–åŠ è½½çš„ç±»æ·»åŠ åœ¨configurationæ–‡ä»¶ä¸­ï¼Œå¹¶åŠ ä¸Šæ³¨è§£<strong>ConditionalOnClass</strong></li>
<li>pomæ–‡ä»¶ä¸­æ·»åŠ <strong>spring-boot-autoconfigure</strong></li>
<li>åœ¨srping.factoriesä¸­åŠ ä¸Šå¯¹åº”çš„configuration</li>
<li>startå‘½åè§„åˆ™<ul>
<li>ä¸èƒ½ä»¥<strong>spring boot</strong>å¼€å¤´</li>
<li>ä»¥<strong>name-spring-boot-starter</strong>çš„æ ¼å¼æ¥å‘½å</li>
</ul>
</li>
<li>è‡ªå®šä¸­çš„starterä¸èƒ½åœ¨pomæ–‡ä»¶ä¸­æ·»åŠ å…¶ä»–çš„starter</li>
</ul>
</li>
</ul>
<h3 id="å¦‚ä½•ä½¿ç”¨custom-starter"><a href="#å¦‚ä½•ä½¿ç”¨custom-starter" class="headerlink" title="å¦‚ä½•ä½¿ç”¨custom starter"></a>å¦‚ä½•ä½¿ç”¨custom starter</h3><ul>
<li>è¿è¡Œ<code>mvn package</code>ç”Ÿæˆjar</li>
<li>å¯¼å…¥jar<ul>
<li><code>mvn install:install-file</code></li>
<li>å°†jarå¤åˆ¶åˆ°å½“å‰ç›®å½•ä¸‹ï¼Œpomå¼•ç”¨æ—¶ï¼ŒåŠ å…¥<strong>system</strong>çš„æ ‡ç­¾ï¼Œè¯»å–æœ¬åœ°çš„jar</li>
</ul>
</li>
</ul>
<h2 id="å¦‚ä½•é…ç½®slf4jçš„æ—¥å¿—æ ¼å¼"><a href="#å¦‚ä½•é…ç½®slf4jçš„æ—¥å¿—æ ¼å¼" class="headerlink" title="å¦‚ä½•é…ç½®slf4jçš„æ—¥å¿—æ ¼å¼"></a>å¦‚ä½•é…ç½®slf4jçš„æ—¥å¿—æ ¼å¼</h2><ul>
<li>å¼•å…¥<strong>spring-boot-starter-log4j2</strong>çš„pomä¾èµ–</li>
<li>æ’é™¤å…¶ä»–å¼•å…¥äº†loggerçš„startedï¼Œè¿è¡Œå‘½ä»¤ <code>mvn dependency:tree</code>æ£€æŸ¥å¼•å…¥loggerçš„dependency</li>
<li>å¦‚æœé‡åˆ°é—®é¢˜ï¼Œå¯èƒ½éœ€è¦åˆ é™¤å¯¹åº”çš„external libraryï¼Œç„¶åå†ç”¨reload pomä¾èµ–</li>
<li>åŠ å…¥log4j2.xmlåœ¨resourceç›®å½•ä¸‹</li>
</ul>
<p><a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/customstarter">code source</a></p>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/java-customer-starter/" data-id="cleuv5r3r00098whs7z68077i" data-title="java_customer_starter" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/java-spring-customer-starter/" rel="tag">java, spring, customer-starter</a></li></ul>

    </footer>
  </div>
  
</article>



  
    <article id="post-streaming_protocol" class="h-entry article article-type-post" itemprop="blogPost" itemscope itemtype="https://schema.org/BlogPosting">
  <div class="article-meta">
    <a href="/2023/03/05/streaming_protocol/" class="article-date">
  <time class="dt-published" datetime="2023-03-05T02:21:03.000Z" itemprop="datePublished">2023-03-05</time>
</a>
    
  </div>
  <div class="article-inner">
    
    
      <header class="article-header">
        
  
    <h1 itemprop="name">
      <a class="p-name article-title" href="/2023/03/05/streaming_protocol/">Streaming protocol</a>
    </h1>
  

      </header>
    
    <div class="e-content article-entry" itemprop="articleBody">
      
        <h3 id="å‰è¨€"><a href="#å‰è¨€" class="headerlink" title="å‰è¨€"></a>å‰è¨€</h3><ul>
<li>ä¸Šä¸€ç¯‡ <a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/ffmpeg_demo/Blog.md">æ–‡ç« </a> ä¸­å†™åˆ°äº†ï¼Œæˆ‘æ˜¯å¦‚ä½•ä½¿ç”¨FFmpegå°†ä¸èƒ½ç›´æ¥æ’­æ”¾çš„è§†é¢‘å¼„æˆQuickTimeæ”¯æŒçš„æ ¼å¼ã€‚é‚£äº›ä¸ªæ“ä½œæ„Ÿè§‰å°±æ˜¯æœ‰äº›ä¸ªç¬¨æ‹™ï¼Œå……æ»¡äº†ç¨‹åºå‘˜å¼çš„æ‰§è‘—ã€‚éš¾é“æˆ‘è¦åœ¨ç”µè§†ä¸Šæ’­æ”¾ä¸€ä¸ªè§†é¢‘ï¼Œå°±éå¾—è½¬ç ï¼Œç„¶åå†æ‹·è´åˆ°ç”µè§†ä¸Šä¹ˆã€‚<font size=4 color=green><strong>éä¹Ÿ</strong></font>ï¼Œå…¶å®ä»»ä½•éŸ³è§†é¢‘éƒ½æ˜¯<font size=6>â€œ<strong>æµ</strong>â€œ</font>ã€‚é‚£ä¹ˆæµæ˜¯ä¸æ˜¯å°±å¯ä»¥ä¼ è¾“å‘¢ï¼Œæ°´å¯ä»¥é€šè¿‡æ°´ç®¡ä¼ è¾“åˆ°æˆ‘ä»¬æƒ³è¦çš„åœ°æ–¹ï¼Œé‚£éŸ³è§†é¢‘æ€ä¹ˆä¼ æ’­å‘¢ï¼Œé çš„æ˜¯ç½‘ç»œæ¶æ„ä¸­çš„ä¼ è¾“å±‚ä¼ é€’ã€‚é‚£ä¹ˆåœ¨æ¥ä¸‹æ¥çš„æ–‡ç« ä¸­ï¼Œæˆ‘å°†å’Œå¤§å®¶æ¥è°ˆè°ˆæˆ‘æ€ä¹ˆå®ç°çš„æµçš„ä¼ è¾“ã€‚</li>
</ul>
<h3 id="streamingå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ"><a href="#streamingå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ" class="headerlink" title="streamingå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ"></a>streamingå¯ä»¥ç”¨æ¥å¹²ä»€ä¹ˆï¼Ÿ</h3><ul>
<li>æµåè®®ä¸»è¦ç”¨äºè§„èŒƒæµåª’ä½“çš„deliveryå’Œingest</li>
</ul>
<h3 id="streamingåè®®æœ‰å“ªäº›ï¼Ÿ"><a href="#streamingåè®®æœ‰å“ªäº›ï¼Ÿ" class="headerlink" title="streamingåè®®æœ‰å“ªäº›ï¼Ÿ"></a>streamingåè®®æœ‰å“ªäº›ï¼Ÿ</h3><ul>
<li>æ™®é€šçš„<ul>
<li>RTMPï¼ˆreal-time message protocolï¼‰ <ul>
<li>RTMPä½¿ç”¨çš„æ˜¯TCPåè®®åšçš„åº•å±‚çš„ä¼ è¾“åè®®ï¼Œè¿™æ ·å°±å¯ä»¥ä¿è¯ä½å»¶è¿Ÿï¼Œä½†æ˜¯RMTPä¾èµ–äºflashçš„æ’­æ”¾å™¨ï¼Œ<font size=4 color=red><strong>But</strong></font>ç°åœ¨æµè§ˆå™¨ä¸­å·²ç»åœæ­¢äº†å¯¹<code>flash</code>çš„æ”¯æŒï¼Œæ‰€ä»¥å¦‚æœæƒ³è¦åœ¨æµè§ˆå™¨ä¸­ç›´æ¥æ’­æ”¾å°±éœ€è¦å®‰è£…flashç›¸å…³çš„æ’ä»¶</li>
</ul>
</li>
<li>SRTï¼ˆSecure Reliable Transportï¼‰ <ul>
<li>æ˜¯ä¸€ç§åŸºäºUDPçš„å¼€æºè§†é¢‘ä¼ è¾“åè®®ï¼ŒSRT ä¸“ä¸ºä½å»¶è¿Ÿå®æ—¶è§†é¢‘ä¼ è¾“è€Œè®¾è®¡</li>
</ul>
</li>
<li>WebRTCï¼ˆWowzaâ€™s Real-Time Streaming at Scale featureï¼‰<ul>
<li>ä½œä¸ºæœ€å¿«çš„å¯ç”¨æŠ€æœ¯ï¼ŒWebRTCå¯å‘ä»»ä½•ä¸»è¦æµè§ˆå™¨ä¼ é€è¿‘ä¹å³æ—¶çš„è¯­éŸ³å’Œè§†é¢‘æµ</li>
</ul>
</li>
<li>RTSP (real-time streaming protocol)<ul>
<li>RTSPç”¨äºæ§åˆ¶ä¸¤ä¸ªç«¯ç‚¹ä¹‹é—´çš„éŸ³é¢‘&#x2F;è§†é¢‘ä¼ è¾“ï¼Œå¹¶ä¿ƒè¿›ä½å»¶è¿Ÿæµåª’ä½“å†…å®¹åœ¨äº’è”ç½‘ä¸Šçš„ä¼ è¾“ï¼Œå®ƒçš„èµ·æºè¦æ—©äºRTMP</li>
</ul>
</li>
</ul>
</li>
<li>adaptive streaming protocol based on http<ul>
<li>HLS (http live streaming)<ul>
<li>åè®®ä½¿ç”¨åŒ…æ‹¬ä¸¤éƒ¨åˆ†ï¼Œç¬¬ä¸€éƒ¨åˆ†æ˜¯ï¼ˆmanifestï¼‰æè¿°æ–‡ä»¶<code>m3u8</code>ï¼Œ ç¬¬äºŒéƒ¨åˆ†æ˜¯å¯æ’­æ”¾çš„<code>ts</code>éŸ³è§†é¢‘æ–‡ä»¶ï¼ŒHLSæœ€åˆæºäºIOSç”Ÿæ€åœˆï¼Œéšç€æŠ€æœ¯çš„å‘å±•ï¼ŒHLSè¢«è¶Šæ¥è¶Šå¤šçš„å¹³å°æ‰€æ¥çº³ï¼Œä¾‹å¦‚ï¼ŒGoogle Chromeï¼ŒAndroidï¼Œlinuxç­‰ç­‰</li>
</ul>
</li>
<li>MPEG-DASH ï¼ˆDynamic Adaptive Streaming over HTTPï¼‰<ul>
<li>MPEG-DASH ç±»ä¼¼äºå¦ä¸€ç§æµåª’ä½“åè®® HLSï¼Œå› ä¸ºå®ƒå°†è§†é¢‘åˆ†è§£æˆæ›´å°çš„å—ï¼Œå¹¶ä»¥ä¸åŒçš„è´¨é‡çº§åˆ«å¯¹è¿™äº›å—è¿›è¡Œç¼–ç ã€‚ è¿™ä½¿å¾—å¯ä»¥æµå¼ä¼ è¾“ä¸åŒè´¨é‡çº§åˆ«çš„è§†é¢‘(ä¸¾ä¸ªğŸŒ°ï¼Œè¿™é‡Œçš„ä¸åŒè´¨é‡ï¼Œåªå¾—æ˜¯ä¸åŒçš„åˆ†è¾¨ç‡çš„è§†é¢‘)ï¼Œå¹¶åœ¨è§†é¢‘ä¸­é—´ä»ä¸€ä¸ªè´¨é‡çº§åˆ«åˆ‡æ¢åˆ°å¦ä¸€ä¸ªè´¨é‡çº§åˆ«ï¼Œä¸åŒäºHLSï¼ŒDASHçš„manifestæ˜¯ä½¿ç”¨<code>xml</code>ï¼Œå®¹å™¨ä½¿ç”¨çš„<code>m4s</code>ï¼Œä¸ªäººæ„Ÿè§‰m3u8ä½œä¸ºèµ„æºç®¡ç†æ–‡ä»¶ä½¿ç”¨èµ·æ¥æ›´åŠ çš„æ¸…æ™°ï¼Œå› ä¸ºDASHçš„æ‰€æœ‰é…ç½®éƒ½æ‚ç³…åœ¨ä¸€ä¸ªæ–‡ä»¶ä¸­</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="æµä¼ è¾“åœ¨ç°å®ä¸­çš„ä½¿ç”¨åœºæ™¯"><a href="#æµä¼ è¾“åœ¨ç°å®ä¸­çš„ä½¿ç”¨åœºæ™¯" class="headerlink" title="æµä¼ è¾“åœ¨ç°å®ä¸­çš„ä½¿ç”¨åœºæ™¯"></a>æµä¼ è¾“åœ¨ç°å®ä¸­çš„ä½¿ç”¨åœºæ™¯</h3><ul>
<li>æ¡Œé¢å…±äº«</li>
<li>æ‘„åƒå¤´å®æ—¶æ’­æ”¾<ul>
<li>å®‰å…¨ç›‘æ§</li>
<li>ç›´æ’­</li>
</ul>
</li>
<li>å®¶åº­å½±é™¢</li>
</ul>
<h3 id="ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ’­æ”¾æµ"><a href="#ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ’­æ”¾æµ" class="headerlink" title="ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ’­æ”¾æµ"></a>ä¸ºä»€ä¹ˆä¸èƒ½ç›´æ¥æ’­æ”¾æµ</h3><ul>
<li>å¯¹äºè¿™ä¸ªé—®é¢˜æˆ‘ä»¬å¯ä»¥æ¢ä¸ªæ–¹å¼æ¥é—®ï¼Œæˆ‘ä»¬å¯ä»¥è¿™æ ·é—®ï¼Œâ€æˆ‘ä»¬ä¸ºä»€ä¹ˆéœ€è¦ä¸€ä¸ªæµåª’ä½“æœåŠ¡å™¨ï¼Œå®ƒèƒ½å¸®æˆ‘ä»¬å¹²å˜›ï¼Ÿâ€ä¸¾ä¸ªğŸŒ°ï¼Œå‡ä½¿æˆ‘ä»¬çš„ç”Ÿæ´»ä¸­æ²¡æœ‰media serverï¼Œé‚£ä¹ˆæˆ‘ä»¬æ¶ˆè´¹æµåª’ä½“çš„æµç¨‹å¦‚ä¸‹ï¼Œç”¨æˆ·ä¸Šä¼ èµ„æºï¼ŒæŸä¸ªå¹³å°æä¾›è§†é¢‘èµ„æºä¸‹è½½ï¼Œç„¶ååœ¨æœ¬åœ°æ’­æ”¾ï¼Œoopsæ ¼å¼ä¸æ”¯æŒï¼Œä¸‹è½½æ”¯æŒçš„æ’­æ”¾å™¨ï¼Œæˆ–è€…ä¸‹è½½è½¬ç å·¥å…·ï¼Œä¸€ç•ªæŠ˜è…¾ä¹‹åå¼€å§‹çœ‹ç”µå½±ã€‚ä½†æ˜¯å¦‚æœæœ‰äº†media serverï¼Œè¿™ä¸ªè¿‡ç¨‹ä¼šå˜æˆä»€ä¹ˆæ ·å‘¢ï¼Ÿ<ul>
<li><img src="https://user-images.githubusercontent.com/6279298/221451549-7481868f-3318-4d3b-9dc3-29af52606f68.png" alt="image"></li>
<li>çœ‹å®Œä¸Šå›¾ï¼Œæˆ‘ä»¬å¯ä»¥æ¸…æ¥šçš„å‘ç°ï¼Œåœ¨åŸå§‹çš„æµåª’ä½“ç»è¿‡äº†media serverä¹‹åï¼Œæˆ‘ä»¬æ‰‹åŠ¨çš„è½¬ç ï¼Œæ ¼å¼è½¬æ¢ï¼Œä»¥åŠlocalå¸¦å®½çš„é™åˆ¶é—®é¢˜éƒ½æ‚„ç„¶æ¶ˆå¤±ã€‚å¯¹äºæ¶ˆè´¹è€…ï¼Œåªéœ€è¦æ‰“å¼€è§†é¢‘ä¾¿å¯ä»¥çœ‹åˆ°ç°æˆçš„è§†é¢‘</li>
</ul>
</li>
</ul>
<h3 id="å¦‚ä½•æ’­æ”¾ä¸åŒçš„streaming"><a href="#å¦‚ä½•æ’­æ”¾ä¸åŒçš„streaming" class="headerlink" title="å¦‚ä½•æ’­æ”¾ä¸åŒçš„streaming"></a>å¦‚ä½•æ’­æ”¾ä¸åŒçš„streaming</h3><ul>
<li>ç›´æ¥ä½¿ç”¨ffplayï¼Œåœ¨ä¹‹å‰çš„ä¸€ç¯‡æ–‡ç« ä¸­ï¼Œæˆ‘å·²ç»å¯¹<a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/ffmpeg_demo/Blog.md">ffplay</a> åšäº†ç®€å•çš„ä»‹ç»<ul>
<li><code>ffplay -v quiet -y 200 &lt;path of the playlist resource&gt;</code></li>
</ul>
</li>
<li>ä½¿ç”¨æµè§ˆå™¨ç›´æ¥æ’­æ”¾ï¼ˆhtml5çš„videoï¼‰ï¼Œä¸éœ€è¦å…¶ä»–çš„æµä¼ è¾“æœåŠ¡å™¨<ul>
<li>åœ¨æœ¬åœ°çš„playlistçš„manifestç”¨server hostèµ·æ¥ï¼Œè¿™é‡Œæˆ‘ä»¬å¯ä»¥ä½¿ç”¨nodeç¯å¢ƒçš„æ¥æŠŠæœ¬åœ°çš„æŸä¸ª<code>path</code>hostèµ·æ¥<ul>
<li>å®‰è£…node hostå·¥å…·<code>npm install http-server -g</code></li>
<li>hostæ–‡ä»¶å¤¹<ul>
<li>cdåˆ°éœ€è¦hostçš„pathä¸‹<ul>
<li><code>cd &lt;path&gt;</code></li>
<li><code>http-server</code></li>
</ul>
</li>
<li>ç›´æ¥hostéœ€è¦è®¿é—®çš„path<ul>
<li><code>http-server &lt;path&gt;</code></li>
</ul>
</li>
</ul>
</li>
<li><img src="https://user-images.githubusercontent.com/6279298/216209862-96b23edb-4a75-4137-8619-ac4976a1d195.png" alt="host successfully"></li>
<li>tips:<ul>
<li>å¿…é¡»ä½¿ç”¨http serverå°†éœ€è¦çš„manifestå’Œå¯¹åº”çš„éŸ³è§†é¢‘èµ„æºhostï¼Œå¦‚æœç›´æ¥ä½¿ç”¨æœ¬æœºçš„file serveræ˜¯æ— æ³•å·¥ä½œçš„</li>
</ul>
</li>
<li>æŠŠmanifeståµŒå…¥åˆ°<a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/ffmpeg_demo/src/main/resources/video..html">html</a> ä¸­ï¼Œä½¿ç”¨ç°æˆçš„jsåº“æ’­æ”¾ã€‚æˆ–è€…è¿˜å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/ffmpeg_demo/src/main/resources/adaptive-media-player.html">åŸç”Ÿçš„jsä»£ç </a> å¤„ç†çš„webï¼Œæ¥æ’­æ”¾manifest</li>
</ul>
</li>
</ul>
</li>
<li>æ­å»ºstreaming push server ï¼ˆæ­å»ºmedia serverï¼‰ï¼Œæœ¬æ–‡ä¸­å°†ä»‹ç»ä¸‰ç§æ¨æµæœåŠ¡å™¨çš„æ­å»ºæ–¹å¼<ul>
<li>æ–¹æ³•ä¸€<ul>
<li>æ­å»º<code>Ant Media server</code> (AMS)<ul>
<li>ä»€ä¹ˆæ˜¯ï¼Ÿ<ul>
<li>is one of the fastest-growing and most popular streaming engines. Ant Media Server supports WebRTC, CMAF, HLS, RTMP, RTSP, and more for your critical business streaming needs</li>
<li>å¦‚æœæ˜¯ä¸ªäººç”¨æˆ·å¯ä»¥å…è´¹ä½¿ç”¨ï¼Œä½†æ˜¯å¦‚æœæ˜¯ä¼ä¸šçº§ç”¨æˆ·åˆ™éœ€è¦ä»˜è´¹</li>
<li>æ›´å¤šçš„ç»†èŠ‚éƒ¨åˆ†ï¼Œå¤§å®¶å¯ä»¥å‚é˜…<a target="_blank" rel="noopener" href="https://resources.antmedia.io/docs">å®˜ç½‘</a></li>
</ul>
</li>
<li>how to<ul>
<li>ä¸‹è½½ <a target="_blank" rel="noopener" href="https://github.com/ant-media/Ant-Media-Server/releases/download/ams-v2.5.3/ant-media-server-community-2.5.3.zip">ant-media-server</a> å®‰è£…åŒ…</li>
<li>cd <code>zip</code> åŒ…çš„è·¯å¾„</li>
<li>ä¸‹è½½ <code>ant-media-server</code> å®‰è£…è„šæœ¬ <code>wget https://raw.githubusercontent.com/ant-media/Scripts/master/install_ant-media-server.sh &amp;&amp; chmod 755 install_ant-media-server.sh</code></li>
<li>ä½¿ç”¨è„šæœ¬ <code>sudo ./install_ant-media-server.sh -i &lt;ANT_MEDIA_SERVER_INSTALLATION_FILE&gt;</code><ul>
<li>tips<ul>
<li>å¦‚æœåœ¨<code>mac</code>ä¸Šï¼Œç›´æ¥è¿è¡Œ <code>unzip &lt;ANT_MEDIA_SERVER_INSTALLATION_FILE&gt;</code>ï¼Œå› ä¸ºä¸Šè¿°çš„å®‰è£…è„šæœ¬æ˜¯é’ˆå¯¹äº<code>Ubuntu</code>çš„linuxç³»ç»Ÿï¼Œå¯¹äºmacä¸é€‚ç”¨</li>
<li>æˆ–è€…è¿˜å¯ä»¥ä½¿ç”¨<a target="_blank" rel="noopener" href="https://github.com/Fdslk/javaLearning/blob/master/code/ffmpeg_demo/Dockerfile">docker</a> ï¼Œå¦‚æœç›´æ¥ä½¿ç”¨Javaçš„åŸºé•œåƒæ—¶ï¼Œè¿˜éœ€è¦è€ƒè™‘å½“å‰é•œåƒä¸­çš„ç³»ç»Ÿç‰ˆæœ¬æˆ–è€…javaç‰ˆæœ¬æ˜¯å¦è¢«AMSæ”¯æŒ</li>
</ul>
</li>
</ul>
</li>
<li>ä½¿ç”¨<ul>
<li>å¯åŠ¨ <code>sudo service antmedia stop</code></li>
<li>ç»ˆæ­¢ <code>sudo service antmedia start</code></li>
<li>æŸ¥çœ‹å½“å‰<code>ant media server</code>çš„çŠ¶æ€ <code>sudo service antmedia status</code></li>
<li>tips<ul>
<li>å¦‚æœåœ¨Macä¸Šï¼Œå¯ä»¥ç›´æ¥è¿›å…¥åˆ°å®‰è£…åŒ…ä¸­ï¼Œç„¶åè¿è¡Œ <code>./start.sh</code>ï¼Œéœ€è¦ä¿è¯å½“å‰ç³»ç»Ÿçš„javaç‰ˆæœ¬ä¸º<font size=3 color=blue><strong>java11</strong></font>ä»¥ä¸Š</li>
</ul>
</li>
</ul>
</li>
<li>åœ¨æµè§ˆå™¨ä¸­è¾“å…¥<code>http://SERVERHOST:5080/</code> ï¼Œç¬¬ä¸€æ¬¡è®¿é—®çš„æ—¶å€™èƒ½å¤Ÿåœ¨æµè§ˆå™¨ä¸­çœ‹åˆ°ä»¥ä¸‹çš„ç•Œé¢ï¼Œé‚£ä¹ˆæ­å–œä½ ï¼ŒAMSå·²ç»æˆåŠŸåœ°å®Œæˆæ­å»º<ul>
<li><img src="https://user-images.githubusercontent.com/6279298/217185934-1d2f733a-f230-42f0-b24b-90d851558267.png" alt="éƒ¨ç½²æˆåŠŸ"></li>
</ul>
</li>
<li>æ³¨å†Œä¹‹åï¼Œç™»å½•åˆ°ä¸»ç•Œé¢ï¼Œå‘å¸ƒç›´æ’­æµ<ul>
<li><img src="https://user-images.githubusercontent.com/6279298/219321664-d205b8d1-d19b-44bd-a5ca-e9853c9b4300.png" alt="ä¸»ç•Œé¢"></li>
</ul>
</li>
<li>è¿›å…¥åˆ°ä¸»ç•Œé¢ä¹‹å<ul>
<li>è½¬æ’­stream resource<ul>
<li><img src="https://user-images.githubusercontent.com/6279298/219325653-0d7b411d-6ec5-4191-968a-19ee0fff1914.gif" alt="live stream output"></li>
<li>tips: ä½¿ç”¨<strong>QuickTime Player</strong>å½•å±ï¼ŒåŒæ ·å¯ä»¥ä½¿ç”¨FFmpegå°†movæ–‡ä»¶è½¬æ¢æˆ.gifæ–‡ä»¶<ul>
<li>è¿è¡Œ  <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">ffmpeg  -i  &lt;input file&gt; \</span><br><span class="line">  -vf &quot;fps=10,scale=320:-1:flags=lanczos,split[s0][s1];[s0]palettegen[p];[s1][p]paletteuse&quot; \</span><br><span class="line">  -loop 0 output.gif</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>è½¬æ’­playlist<ul>
<li><img src="https://user-images.githubusercontent.com/6279298/219523963-2e42d6f5-3cfe-41c4-8b48-4666988da521.gif" alt="playlist output"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>æ–¹æ³•äºŒ<ul>
<li>æ­å»ºnginx+RTMP<ul>
<li>å®‰è£…nginx <code>brew install nginx</code></li>
<li>å®‰è£…nginx rtmp moduleï¼Œ<code>brew install nginx-full --with-rtmp-module</code><ul>
<li>tip<ul>
<li>å½“è¿è¡Œä¸Šè¿°å‘½ä»¤å¼æŠ¥å‡ºä»¥ä¸‹é”™è¯¯æ—¶ï¼Œ<a target="_blank" rel="noopener" href="https://stackoverflow.com/questions/61931028/installing-homebrew-nginx-rtmp-in-macos-movaje-10-14"><code>Error: invalid option: --with-rtmp-module</code></a> å¯ä»¥è¿è¡Œ <code>brew tap denji/nginx</code>ï¼Œç„¶åå†å®‰è£…rtmp module</li>
<li>å®‰è£…æˆåŠŸä¹‹åä¼šæœ‰ä»¥ä¸‹æç¤º <figure class="highlight text"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line">Docroot is: /usr/local/var/www</span><br><span class="line">The default port has been set in /usr/local/etc/nginx/nginx.conf to 8080 so that</span><br><span class="line">nginx can run without sudo.</span><br><span class="line">  </span><br><span class="line">nginx will load all files in /usr/local/etc/nginx/servers/.</span><br><span class="line">  </span><br><span class="line">- Tips -</span><br><span class="line">  Run port 80:</span><br><span class="line">  $ sudo chown root:wheel /usr/local/opt/nginx-full/bin/nginx</span><br><span class="line">  $ sudo chmod u+s /usr/local/opt/nginx-full/bin/nginx</span><br><span class="line">  Reload config:</span><br><span class="line">  $ nginx -s reload</span><br><span class="line">  Reopen Logfile:</span><br><span class="line">  $ nginx -s reopen</span><br><span class="line">  Stop process:</span><br><span class="line">  $ nginx -s stop</span><br><span class="line">  Waiting on exit process</span><br><span class="line">  $ nginx -s quit</span><br><span class="line">  </span><br><span class="line">To start denji/nginx/nginx-full now and restart at login:</span><br><span class="line">brew services start denji/nginx/nginx-full</span><br><span class="line">Or, if you don&#x27;t want/need a background service you can just run:</span><br><span class="line">nginx</span><br></pre></td></tr></table></figure></li>
</ul>
</li>
</ul>
</li>
<li>ä½¿ç”¨ffmpegæ¨æµï¼Œä½¿ç”¨nginxçš„RTMPæ¨¡å—æ—¶ï¼Œæˆ‘è¿™é‡Œä½¿ç”¨çš„æ˜¯live streamingçš„ä¸»åŠ¨æ¨æµæ¨¡å¼ï¼Œä¹Ÿå°±æ˜¯æºå¤´å°†streamingæ¨é€ç»™media serverï¼Œè€Œä¸æ˜¯media serverä¸»åŠ¨å»æ‹‰èµ„æº<ul>
<li><pre><code>ffmpeg -v quiet -i &quot;&lt;stream resource locatopm&gt;&quot; \
  -vf &quot;scale=-2:200,drawtext=fontfile=&#39;c\:/Windows/Fonts/courbd.ttf&#39;:text=RTMP:fontsize=30:x=10:y=20:fontcolor=#000000:box=1:boxborderw=5:boxcolor=#ff888888&quot; \
  -vcodec libx264 -f flv &lt;rtmp server url&gt;
</code></pre>
</li>
</ul>
</li>
<li>ä½¿ç”¨ffplayéªŒè¯æ¨æµæˆåŠŸ<ul>
<li><code>ffplay -v quiet &lt;rtmp server url&gt;</code></li>
<li><img src="https://user-images.githubusercontent.com/6279298/220020493-dc16cbc8-2a4a-4ae4-a442-5f4674266d2d.gif" alt="ffplay play pulling streaming successfully"></li>
</ul>
</li>
<li>ä½¿ç”¨VLCéªŒè¯æ¨æµæˆåŠŸ<ul>
<li>ä¸‹è½½<a target="_blank" rel="noopener" href="https://get.videolan.org/vlc/3.0.18/macosx/vlc-3.0.18-intel64.dmg">VLC</a></li>
<li><img src="https://user-images.githubusercontent.com/6279298/220246480-5f8027db-87e2-490d-8c7e-1acaa4a95dce.gif" alt="verify streaming by VLC"></li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>æ–¹æ³•ä¸‰<ul>
<li>æ­å»º<a target="_blank" rel="noopener" href="https://github.com/aler9/rtsp-simple-server">rtsp-simple-server</a> æœåŠ¡å™¨<ul>
<li>ä½¿ç”¨æ–¹å¼<ul>
<li>ä¸‹è½½<a target="_blank" rel="noopener" href="https://github.com/aler9/rtsp-simple-server/releases">server release package</a> ï¼Œunzipè¯¥æ–‡ä»¶åŒ…ï¼Œè¿è¡Œ<code>./rtsp-simple-server</code></li>
<li>ä½¿ç”¨dockeræ–¹å¼å¯åŠ¨</li>
<li>OpenWRT</li>
</ul>
</li>
<li>æ¨æµ<ul>
<li><code>ffmpeg -re -stream_loop -1 -i http://localhost:8080/nature.mp4  -c copy -f rtsp rtsp://localhost:8554/mystream</code></li>
</ul>
</li>
<li>éªŒè¯<ul>
<li>ffmpeg</li>
<li>vlc</li>
</ul>
</li>
</ul>
</li>
</ul>
</li>
<li>å„ç§æ¨æµæœåŠ¡å™¨ä¹‹é—´çš„æ¯”è¾ƒ<ul>
<li><table>
<thead>
<tr>
<th></th>
<th align="center">pulling supported protocol</th>
<th align="center">pushing supported protocol</th>
<th>supported OS</th>
<th align="center">freeium</th>
<th align="center">latency</th>
<th align="center">advantage</th>
<th align="center">disadvantage</th>
</tr>
</thead>
<tbody><tr>
<td>ant media server</td>
<td align="center">RTSP, RTMP &amp; HLS</td>
<td align="center">RTMP &amp; WebRTC</td>
<td>Linux&#x2F;MacOS&#x2F;Windows <br>(cloud:AWS&#x2F;Azure&#x2F;Alibaba&#x2F;Digital Ocean&#x2F;Linode)</td>
<td align="center">yes</td>
<td align="center">8s-12s for community version</td>
<td align="center">provide GUI, user-friendly,<br>open source, community support</td>
<td align="center">some features need payment</td>
</tr>
<tr>
<td>nginx-rtmp-module</td>
<td align="center">RTMP&#x2F;HLS&#x2F;MPEG-DASH</td>
<td align="center">RTMP, HLS &amp; MPEG-DASH</td>
<td>Linux&#x2F;FreeBSD&#x2F;MacOS&#x2F;Windows</td>
<td align="center">yes</td>
<td align="center">control by parameter</td>
<td align="center">more flexible, open source, <br>community support</td>
<td align="center">not support webRTC</td>
</tr>
<tr>
<td>rtsp-simple-server</td>
<td align="center">RTSP, RTMP, HLS &amp; WebRTC</td>
<td align="center">RTSP, RTMP, HLS &amp; Raspberry Pi Cameras</td>
<td>Linux&#x2F;MacOS&#x2F;Windows</td>
<td align="center">yes</td>
<td align="center">control by parameter</td>
<td align="center">open source, community support</td>
<td align="center"></td>
</tr>
</tbody></table>
</li>
</ul>
</li>
</ul>
</li>
</ul>
<h3 id="å±•æœ›"><a href="#å±•æœ›" class="headerlink" title="å±•æœ›"></a>å±•æœ›</h3><ul>
<li>å®ç°ä¸€ä¸ªå®¶åº­è§‚å½±ç³»ç»Ÿ</li>
<li>è€ƒè™‘ä¸€ä¸‹å¦‚ä½•ä¸Šäº‘</li>
</ul>
<h3 id="reference"><a href="#reference" class="headerlink" title="reference"></a>reference</h3><ul>
<li><a target="_blank" rel="noopener" href="https://www.wowza.com/blog/streaming-protocols">Streaming Protocols: Everything You Need to Know (Update)</a></li>
<li><a target="_blank" rel="noopener" href="https://www.cloudflare.com/learning/video/what-is-mpeg-dash/">What is MPEG-DASH? | HLS vs. DASH</a></li>
<li><a target="_blank" rel="noopener" href="https://antmedia.io/what-is-rtmp-server-how-to-set-up-a-free-rtmp-server/">RTMP server guide: How to set up a free RTMP server</a></li>
<li><a target="_blank" rel="noopener" href="https://www.wowza.com/blog/why-you-need-a-streaming-media-server#simulcasting">3 Reasons Why You Need a Streaming Media Server</a></li>
</ul>

      
    </div>
    <footer class="article-footer">
      <a data-url="http://fdslk.github.io/2023/03/05/streaming_protocol/" data-id="cleuv5r3t000d8whsg1213ycp" data-title="Streaming protocol" class="article-share-link">Share</a>
      
      
      
  <ul class="article-tag-list" itemprop="keywords"><li class="article-tag-list-item"><a class="article-tag-list-link" href="/tags/ffmpeg-media-server/" rel="tag">ffmpeg, media-server</a></li></ul>

    </footer>
  </div>
  
</article>



  


</section>
        
          <aside id="sidebar">
  
    

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tags</h3>
    <div class="widget">
      <ul class="tag-list" itemprop="keywords"><li class="tag-list-item"><a class="tag-list-link" href="/tags/elastic-search-java-test/" rel="tag">elastic search, java, test</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg/" rel="tag">ffmpeg</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg-coverting-format/" rel="tag">ffmpeg, coverting format</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/ffmpeg-media-server/" rel="tag">ffmpeg, media-server</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-design-pattern-easy-rule/" rel="tag">java, design-pattern, easy-rule</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-spring-customer-starter/" rel="tag">java, spring, customer-starter</a></li><li class="tag-list-item"><a class="tag-list-link" href="/tags/java-spring-boot-auth0/" rel="tag">java, spring-boot, auth0</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Tag Cloud</h3>
    <div class="widget tagcloud">
      <a href="/tags/elastic-search-java-test/" style="font-size: 10px;">elastic search, java, test</a> <a href="/tags/ffmpeg/" style="font-size: 10px;">ffmpeg</a> <a href="/tags/ffmpeg-coverting-format/" style="font-size: 10px;">ffmpeg, coverting format</a> <a href="/tags/ffmpeg-media-server/" style="font-size: 10px;">ffmpeg, media-server</a> <a href="/tags/java-design-pattern-easy-rule/" style="font-size: 10px;">java, design-pattern, easy-rule</a> <a href="/tags/java-spring-customer-starter/" style="font-size: 10px;">java, spring, customer-starter</a> <a href="/tags/java-spring-boot-auth0/" style="font-size: 10px;">java, spring-boot, auth0</a>
    </div>
  </div>

  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Archives</h3>
    <div class="widget">
      <ul class="archive-list"><li class="archive-list-item"><a class="archive-list-link" href="/archives/2023/03/">March 2023</a></li></ul>
    </div>
  </div>


  
    
  <div class="widget-wrap">
    <h3 class="widget-title">Recent Posts</h3>
    <div class="widget">
      <ul>
        
          <li>
            <a href="/2023/03/05/ffmpeg-simple-convert/">ffmpeg_simple_convert</a>
          </li>
        
          <li>
            <a href="/2023/03/05/ffmpeg_basic_concept/">ffmpeg_basic_concept</a>
          </li>
        
          <li>
            <a href="/2023/03/05/es-local-tests/">es_local_tests</a>
          </li>
        
          <li>
            <a href="/2023/03/05/easy-rule-demo/">easy_rule_demo</a>
          </li>
        
          <li>
            <a href="/2023/03/05/spring101/">spring101</a>
          </li>
        
      </ul>
    </div>
  </div>

  
</aside>
        
      </div>
      <footer id="footer">
  
  <div class="outer">
    <div id="footer-info" class="inner">
      
      &copy; 2023 Zengqiang Fang<br>
      Powered by <a href="https://hexo.io/" target="_blank">Hexo</a>
    </div>
  </div>
</footer>

    </div>
    <nav id="mobile-nav">
  
    <a href="/" class="mobile-nav-link">Home</a>
  
    <a href="/archives" class="mobile-nav-link">Archives</a>
  
</nav>
    


<script src="/js/jquery-3.4.1.min.js"></script>



  
<script src="/fancybox/jquery.fancybox.min.js"></script>




<script src="/js/script.js"></script>





  </div>
</body>
</html>